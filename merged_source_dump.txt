

===== FILE: ./src\App.tsx =====

import { useState, useEffect } from 'react';
import { NavigationSidebar } from './components/NavigationSidebar';
import { MiddlePanel } from './components/MiddlePanel';
import { MainPanel } from './components/MainPanel';
import { QuestsMiddlePanel } from './components/QuestsMiddlePanel';
import { QuestsMainPanel } from './components/QuestsMainPanel';
import { FocusSessionModal } from './components/FocusSessionModal';
import { 
  AuthService, 
  QuestService,
  NotificationService,
  SessionService,
  TaskService,
  QuestUIAdapter
} from './worker';
import type { Quest, Subtask, Quest as WorkerQuest } from './worker/models/Quest';
import type { GoalComment } from './worker/models/GoalComment';
import type { Notification as WorkerNotification } from './worker/models/Notification';

// Keep existing UI interfaces for Figma compatibility
export interface Task {
  id: string;
  title: string;
  questId: string; 
  questTag: string;
  levelReq: number;
  completed: boolean;
  questColor: string;
}

export interface FocusSession {
  questTitle: string;
  subtaskName: string;
  duration: number;
}

export default function App() {
  const [activeNav, setActiveNav] = useState('home');
  const [focusSession, setFocusSession] = useState<FocusSession | null>(null);
  const [selectedQuestId, setSelectedQuestId] = useState<string | null>(null);
  const [discoveryMode, setDiscoveryMode] = useState(false);
  const [userId, setUserId] = useState<string | null>(null);
  const [isLoading, setIsLoading] = useState(true);
  const [activeSessionId, setActiveSessionId] = useState<string | null>(null);
  
  // Worker data
  const [workerQuests, setWorkerQuests] = useState<WorkerQuest[]>([]);
  const [watchedQuests, setWatchedQuests] = useState<WorkerQuest[]>([]);
  const [publicQuests, setPublicQuests] = useState<WorkerQuest[]>([]);
  const [questComments, setQuestComments] = useState<Record<string, GoalComment[]>>({});
  
  // UI data (converted from worker data)
  const [tasks, setTasks] = useState<Task[]>([]);
  const [quests, setQuests] = useState<Quest[]>([]);
  const [notifications, setNotifications] = useState<WorkerNotification[]>([]);

  // Services
  const authService = new AuthService();
  const questService = new QuestService();
  const notificationService = new NotificationService();
  const sessionService = new SessionService();
  const taskService = new TaskService();

  // Initialize on mount
  useEffect(() => {
    initializeApp();
  }, []);

  // Load quest-specific data when quest is selected
  useEffect(() => {
    if (selectedQuestId) {
      loadQuestComments(selectedQuestId);
    }
  }, [selectedQuestId]);

  const initializeApp = async () => {
    try {
      const id = await authService.getCurrentUserId();
      setUserId(id);
      await loadAllData(id);
      setIsLoading(false);
      console.log('in initializeapp, loaded all data')
    } catch (error) {
      console.error('Failed to initialize:', error);
    } finally {
      setIsLoading(false);
    }
  };

  const loadAllData = async (uid: string) => {
    await Promise.all([
      loadTasks(uid),
      loadQuests(uid),
      loadNotifications(uid)
    ]);
  };

  const loadTasks = async (uid: string) => {
    const todaysQuests = await taskService.getTodaysTasks(uid);
    console.log("today's quests", todaysQuests);
    const uiTasks = QuestUIAdapter.questsToTasks(todaysQuests);
    console.log('leaving load tasks')
    setTasks(uiTasks);
  };

  const loadQuests = async (uid: string) => {
    const [myQuests, watched, discovered] = await Promise.all([
      questService.getUserQuests(uid),
      questService.getWatchedQuests(uid),
      questService.getPublicQuests(20)
    ]);

    setWorkerQuests(myQuests);
    setWatchedQuests(watched);
    setPublicQuests(discovered);

    // Convert to UI format
    const uiQuests = convertQuestsToUI(myQuests, watched);
    setQuests(uiQuests);
  };

  const loadNotifications = async (uid: string) => {
    const notifs = await notificationService.getUserNotifications(uid);
    setNotifications(notifs); // Store worker notifications directly
  };

  // const loadNotifications = async (uid: string) => {
  //   const notifs = await notificationService.getUserNotifications(uid);
    
  //   // Convert to UI format
  //   const uiNotifs: Notification[] = notifs.slice(0, 10).map(n => ({
  //     id: n.notificationId,
  //     text: n.message,
  //     questId: n.questId || '',
  //     timestamp: new Date(n.createdAt).toLocaleTimeString(),
  //     type: n.type === 'milestone' ? 'milestone' : 
  //           n.type === 'quest_default' ? 'level' : 'milestone'
  //   }));
    
  //   setNotifications(uiNotifs);
  // };

  const loadQuestComments = async (questId: string) => {
    console.log('in load quest comments')
    try {
      const comments = await questService.getQuestComments(questId);
      setQuestComments(prev => ({
        ...prev,
        [questId]: comments
      }));
      console.log('done loading quest comments')
    } catch (error) {
      console.error('Failed to load comments:', error);
    }
  };

  const handleAddComment = async (questId: string, text: string) => {
    if (!userId) return;

    try {
      const user = await authService.getCurrentUser();
      if (!user) return;

      await questService.addComment(
        questId,
        userId,
        user.username,
        text,
        'encouragement'
      );

      // Reload comments
      await loadQuestComments(questId);
    } catch (error) {
      console.error('Failed to add comment:', error);
    }
  };

  const convertQuestsToUI = (
    myQuests: WorkerQuest[],
    watched: WorkerQuest[]
  ): any[] => {
    const watchedIds = new Set(watched.map(q => q.questId));
    
    return myQuests.map(wq => ({
      id: wq.questId,
      title: wq.title,
      icon: '‚öîÔ∏è', // Default icon, could be enhanced
      type: wq.isDungeon ? 'dungeon' : 
            wq.members.length > 1 ? 'guild' : 'personal',
      level: wq.gamification.currentLevel,
      currentXP: wq.gamification.currentExp,
      totalXP: wq.gamification.expToNextLevel,
      description: wq.description,
      color: getColorForDifficulty(wq.difficulty.userAssigned),
      progress: Math.round((wq.gamification.currentExp / wq.gamification.expToNextLevel) * 100),
      milestones: [], // TODO: Map from progressHistory
      subtasks: wq.subtasks.map(st => ({
        id: st.id,
        title: st.title,
        completed: st.isComplete,
        xp: 50 // Default, could be calculated
      })),
      comments: questComments[wq.questId]?.map(c => ({
        id: c.commentId,
        user: c.username,
        avatar: 'üë§',
        text: c.text,
        timestamp: new Date(c.timestamp).toLocaleTimeString()
      })) || [],
      watching: watchedIds.has(wq.questId),
      unreadComments: 0, // TODO: Calculate
      warriors: wq.members.length || undefined,
      deadline: wq.dueDate || undefined
    }));
  };

  const getColorForDifficulty = (difficulty: string): string => {
    const colors: Record<string, string> = {
      'Trivial': '#72767d',
      'Easy': '#57F287',
      'Medium': '#5865F2',
      'Hard': '#FEE75C',
      'Epic': '#EB459E'
    };
    return colors[difficulty] || '#5865F2';
  };

  const startFocusSession = async (task: Task | Subtask, questTitle?: string) => {
    if (!userId) return;

    try {
      let workerQuest: WorkerQuest | undefined;
      let subtaskId: string;

      if ('questTag' in task) {
        // It's a Task from home view
        const found = await QuestUIAdapter.findQuestAndSubtask(task.id, workerQuests);
        if (!found) return;
        workerQuest = found.quest;
        subtaskId = found.subtask.id;
      } else {
        // It's a Subtask from quest detail view
        workerQuest = workerQuests.find(q =>
          q.subtasks.some(st => st.id === task.id)
        );
        if (!workerQuest) return;
        subtaskId = task.id;
      }

      const session = await sessionService.createSession(
        userId,
        workerQuest.questId,
        subtaskId,
        25
      );

      setActiveSessionId(session.sessionId); // ADD THIS LINE
      setFocusSession({
        questTitle: questTitle || workerQuest.title,
        subtaskName: task.title,
        duration: 25 * 60
      });
    } catch (error) {
      console.error('Failed to start session:', error);
    }
  };

  const endFocusSession = async () => {
    if (activeSessionId && userId) {
      try {
        // Complete the session in worker
        await sessionService.completeSession(
          activeSessionId,
          25, // actual duration
          undefined // no notes
        );
        
        // Reload tasks to reflect XP changes
        await loadTasks(userId);
      } catch (error) {
        console.error('Failed to end session:', error);
      }
    }
    
    setFocusSession(null);
    setActiveSessionId(null);
  };

  const toggleTaskComplete = async (taskId: string) => {
    if (!userId) return;

    // Optimistic UI update
    setTasks(tasks.map(task =>
      task.id === taskId ? { ...task, completed: !task.completed } : task
    ));

    try {
      const found = await QuestUIAdapter.findQuestAndSubtask(taskId, workerQuests);
      if (!found) return;

      await taskService.toggleSubtaskCompletion(
        userId,
        found.quest.questId,
        found.subtask.id
      );

      await loadAllData(userId);
    } catch (error) {
      console.error('Failed to toggle task:', error);
      await loadTasks(userId); // Revert on error
    }
  };

  const reorderTasks0 = async (startIndex: number, endIndex: number) => {
    // Optimistic UI update
    const result = Array.from(tasks);
    const [removed] = result.splice(startIndex, 1);
    result.splice(endIndex, 0, removed);
    setTasks(result);

    // Persist to worker (if needed - task order is per-quest)
    // For now, just update UI since drag-drop is visual only
    // TODO: Implement cross-quest task ordering if needed
  };

  const reorderTasks = async (startIndex: number, endIndex: number) => {
    const result: Task[] = Array.from(tasks);
    const [removed] = result.splice(startIndex, 1);
    result.splice(endIndex, 0, removed);

    setTasks(result);

    // persist order using TaskService per quest
    const questId = removed.questId;
    const newOrderForQuest = result
      .filter(t => t.questId === questId)
      .map(t => t.id);

    await taskService.updateTaskOrder(userId, questId, newOrderForQuest);
  };


  const handleQuestSelect = (questId: string) => {
    setSelectedQuestId(questId);
    setDiscoveryMode(false);
  };

  const handleDiscoverySelect = () => {
    setDiscoveryMode(true);
    setSelectedQuestId(null);
  };

  const handleNotificationClick = async (questId: string) => {
    setSelectedQuestId(questId);
    setDiscoveryMode(false);
    setActiveNav('quests');
    
    // Mark notification as read
    const notification = notifications.find(n => n.questId === questId);
    if (notification) {
      await notificationService.markAsRead(notification.id);
      await loadNotifications(userId!);
    }
  };

  const handleJoinQuest = async (questId: string) => {
    if (!userId) return;
    
    try {
      await questService.joinQuest(userId, questId);
      await loadQuests(userId);
      alert('Successfully joined quest!');
    } catch (error) {
      console.error('Failed to join quest:', error);
      alert('Failed to join quest');
    }
  };

  const handleWatchQuest = async (questId: string) => {
    if (!userId) return;

    try {
      await questService.toggleWatch(userId, questId);
      await loadQuests(userId);
    } catch (error) {
      console.error('Failed to toggle watch:', error);
    }
  };

  const toggleSubtaskComplete = async (questId: string, subtaskId: string) => {
    if (!userId) return;

    // Optimistic UI update
    setQuests(quests.map(quest => {
      if (quest.id === questId) {
        return {
          ...quest,
          subtasks: quest.subtasks.map(st =>
            st.id === subtaskId ? { ...st, isComplete: !st.isComplete } : st
          ),
        };
      }
      console.log('subtask toggled!');
      return quest;
    }));

    try {
      await taskService.toggleSubtaskCompletion(userId, questId, subtaskId);
      await loadQuests(userId);
    } catch (error) {
      console.error('Failed to toggle subtask:', error);
      await loadQuests(userId); // Revert
    }
  };

  if (isLoading) {
    return (
      <div className="flex items-center justify-center h-screen bg-[#36393f]">
        <div className="text-center">
          <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-[#5865F2] mx-auto mb-4"></div>
          <p className="text-[#dcddde]">Loading Ascend...</p>
        </div>
      </div>
    );
  }

  if (!userId) {
    return (
      <div className="flex items-center justify-center h-screen bg-[#36393f]">
        <div className="text-center text-[#ed4245]">
          <p>Failed to initialize. Please refresh.</p>
        </div>
      </div>
    );
  }

  return (
    <div className="flex h-screen bg-[#36393f] text-[#dcddde] overflow-hidden">
      <NavigationSidebar activeNav={activeNav} setActiveNav={setActiveNav} />
      
      {/* Conditional Middle Panel */}
      {activeNav === 'home' && <MiddlePanel userId={userId} />}
      {activeNav === 'quests' && (
        <QuestsMiddlePanel
          quests={workerQuests}
          notifications={notifications}
          onQuestSelect={handleQuestSelect}
          onDiscoverySelect={handleDiscoverySelect}
          onNotificationClick={handleNotificationClick}
          selectedQuestId={selectedQuestId}
          discoveryMode={discoveryMode}
        />
      )}

      {/* Conditional Main Panel */}
      {activeNav === 'home' && (
        <MainPanel
          userId={userId}
          tasks={tasks}
          workerQuests={workerQuests}
          onToggleTask={toggleTaskComplete}
          onReorderTasks={reorderTasks}
          onStartFocus={startFocusSession}
        />
      )}
      {activeNav === 'quests' && (
        <QuestsMainPanel
          quests={workerQuests}
          selectedQuestId={selectedQuestId}
          discoveryMode={discoveryMode}
          questComments={questComments}
          publicQuests={publicQuests}
          onStartFocus={startFocusSession}
          onJoinQuest={handleJoinQuest}
          onWatchQuest={handleWatchQuest}
          onToggleSubtask={toggleSubtaskComplete}
          onAddComment={handleAddComment}
        />
      )}

      {focusSession && (
        <FocusSessionModal
          session={focusSession}
          onEnd={endFocusSession}
          tasks={tasks}
          sessionService={sessionService}
        />
      )}
    </div>
  );
}

===== FILE: ./src\Attributions.md =====

This Figma Make file includes components from [shadcn/ui](https://ui.shadcn.com/) used under [MIT license](https://github.com/shadcn-ui/ui/blob/main/LICENSE.md).

This Figma Make file includes photos from [Unsplash](https://unsplash.com) used under [license](https://unsplash.com/license).

===== FILE: ./src\components\DiscoveryView.tsx =====

import { useState } from 'react';
import { Search, Filter, ChevronDown, ChevronRight, Users, Calendar, ListTodo, Eye, UserPlus } from 'lucide-react';
import { Input } from './ui/input';
import { Button } from './ui/button';
import type { Quest } from '../worker/models/Quest';

interface DiscoveryViewProps {
  quests: Quest[]; // User's quests (for checking watch status)
  publicQuests: Quest[]; // Discoverable public quests
  onJoinQuest: (questId: string) => void;
  onWatchQuest: (questId: string) => void;
}

export function DiscoveryView({ quests, publicQuests, onJoinQuest, onWatchQuest }: DiscoveryViewProps) {
  const [searchQuery, setSearchQuery] = useState('');
  const [expandedQuestId, setExpandedQuestId] = useState<string | null>(null);
  const [selectedTags, setSelectedTags] = useState<string[]>([]);

  // Extract unique tags from public quests
  const allTags = Array.from(new Set(publicQuests.flatMap(q => q.tags)));
  const tags = allTags.length > 0 ? allTags.slice(0, 10) : ['Programming', 'Fitness', 'Learning', 'Creative', 'Team'];

  const filteredQuests = publicQuests.filter(quest => {
    const matchesSearch = quest.title.toLowerCase().includes(searchQuery.toLowerCase()) ||
                          quest.description.toLowerCase().includes(searchQuery.toLowerCase());
    const matchesTags = selectedTags.length === 0 || 
                       selectedTags.some(tag => quest.tags.includes(tag));
    return matchesSearch && matchesTags;
  });

  const toggleQuestExpansion = (questId: string) => {
    setExpandedQuestId(expandedQuestId === questId ? null : questId);
  };

  const getQuestProgress = (quest: Quest): number => {
    return Math.round((quest.gamification.currentExp / quest.gamification.expToNextLevel) * 100);
  };

  const getQuestColor = (quest: Quest): string => {
    const colors: Record<string, string> = {
      'Trivial': '#72767d',
      'Easy': '#57F287',
      'Medium': '#5865F2',
      'Hard': '#FEE75C',
      'Epic': '#EB459E'
    };
    return colors[quest.difficulty.userAssigned] || '#5865F2';
  };

  const isWatching = (questId: string): boolean => {
    return quests.some(q => q.questId === questId && q.watchers.includes(questId));
  };

  return (
    <div className="flex-1 bg-[#36393f] flex flex-col">
      {/* Title Bar */}
      <div className="h-12 px-6 flex items-center justify-between border-b border-[#202225] shrink-0">
        <span className="text-white">Discover Quests</span>
      </div>

      {/* Search & Filters Bar */}
      <div className="px-6 py-4 border-b border-[#202225] shrink-0">
        <div className="flex gap-3 mb-3">
          <div className="flex-1 relative">
            <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-[#72767d]" />
            <Input
              placeholder="Search quests..."
              value={searchQuery}
              onChange={(e) => setSearchQuery(e.target.value)}
              className="bg-[#202225] border-[#202225] pl-10 h-10 placeholder:text-[#72767d] focus-visible:ring-1 focus-visible:ring-[#00b0f4]"
            />
          </div>
          <Button
            variant="outline"
            className="bg-transparent border-[#4f545c] hover:bg-[#4f545c] hover:text-white"
          >
            <Filter className="w-4 h-4 mr-2" />
            Filters
          </Button>
        </div>

        {/* Tags */}
        <div className="flex gap-2 flex-wrap">
          {tags.map(tag => (
            <button
              key={tag}
              onClick={() => {
                setSelectedTags(prev =>
                  prev.includes(tag) ? prev.filter(t => t !== tag) : [...prev, tag]
                );
              }}
              className={`
                px-3 py-1 rounded text-xs transition-colors
                ${selectedTags.includes(tag)
                  ? 'bg-[#5865F2] text-white'
                  : 'bg-[#2f3136] text-[#b9bbbe] hover:bg-[#4f545c]'
                }
              `}
            >
              {tag}
            </button>
          ))}
        </div>
      </div>

      {/* Scrollable Quest List */}
      <div className="flex-1 overflow-y-auto">
        <div className="p-6">
          {filteredQuests.length === 0 ? (
            <div className="text-center py-12">
              <div className="text-4xl mb-4">üîç</div>
              <p className="text-[#b9bbbe]">No quests found</p>
              <p className="text-sm text-[#72767d] mt-2">Try adjusting your search or filters</p>
            </div>
          ) : (
            <div className="space-y-3">
              {filteredQuests.map(quest => {
                const isExpanded = expandedQuestId === quest.questId;
                const watchingQuest = isWatching(quest.questId);
                const progress = getQuestProgress(quest);
                const color = getQuestColor(quest);

                return (
                  <div key={quest.questId} className="bg-[#2f3136] rounded-lg overflow-hidden">
                    {/* Quest Header */}
                    <div className="p-4">
                      <div className="flex items-start gap-4">
                        <div className="text-3xl shrink-0">
                          {quest.isDungeon ? '‚öîÔ∏è' : quest.members.length > 1 ? 'üë•' : 'üìã'}
                        </div>
                        <div className="flex-1 min-w-0">
                          <div className="flex items-start justify-between gap-3 mb-2">
                            <div className="flex-1 min-w-0">
                              <h3 className="text-white mb-1">{quest.title}</h3>
                              <p className="text-sm text-[#b9bbbe]">{quest.description}</p>
                            </div>
                          </div>

                          {/* Quest Stats */}
                          <div className="flex items-center gap-4 mb-3">
                            <div className="flex items-center gap-1 text-xs text-[#b9bbbe]">
                              <Users className="w-3 h-3" />
                              {quest.members.length || 0} warriors
                            </div>
                            {quest.dueDate && (
                              <div className="flex items-center gap-1 text-xs text-[#b9bbbe]">
                                <Calendar className="w-3 h-3" />
                                {new Date(quest.dueDate).toLocaleDateString()}
                              </div>
                            )}
                            <div className="flex items-center gap-1 text-xs text-[#b9bbbe]">
                              <ListTodo className="w-3 h-3" />
                              {quest.subtasks.length} subtasks
                            </div>
                          </div>

                          {/* Progress Bar */}
                          <div className="mb-3">
                            <div className="flex items-center justify-between mb-1">
                              <span className="text-xs text-[#b9bbbe]">Cumulative Progress</span>
                              <span className="text-xs text-[#b9bbbe]">{progress}%</span>
                            </div>
                            <div className="w-full h-2 bg-[#202225] rounded-full overflow-hidden">
                              <div
                                className="h-full rounded-full transition-all"
                                style={{
                                  width: `${progress}%`,
                                  backgroundColor: color,
                                }}
                              />
                            </div>
                          </div>

                          {/* Action Buttons */}
                          <div className="flex gap-2">
                            <Button
                              onClick={() => onJoinQuest(quest.questId)}
                              className="bg-[#57F287] hover:bg-[#3ba55d] text-white"
                            >
                              <UserPlus className="w-4 h-4 mr-2" />
                              Join Quest
                            </Button>
                            <Button
                              onClick={() => onWatchQuest(quest.questId)}
                              variant="outline"
                              className={`
                                ${watchingQuest
                                  ? 'bg-[#5865F2] border-[#5865F2] text-white hover:bg-[#4752C4]'
                                  : 'bg-transparent border-[#4f545c] hover:bg-[#4f545c] hover:text-white'
                                }
                              `}
                            >
                              <Eye className="w-4 h-4 mr-2" />
                              {watchingQuest ? 'Watching' : 'Watch'}
                            </Button>
                            <Button
                              onClick={() => toggleQuestExpansion(quest.questId)}
                              variant="ghost"
                              className="hover:bg-[#4f545c]"
                            >
                              {isExpanded ? (
                                <>
                                  <ChevronDown className="w-4 h-4 mr-2" />
                                  Hide Details
                                </>
                              ) : (
                                <>
                                  <ChevronRight className="w-4 h-4 mr-2" />
                                  Show Details
                                </>
                              )}
                            </Button>
                          </div>
                        </div>
                      </div>
                    </div>

                    {/* Expanded Quest Details */}
                    {isExpanded && (
                      <div className="px-4 pb-4 border-t border-[#202225] pt-4">
                        <h4 className="text-xs uppercase tracking-wide text-[#b9bbbe] mb-3">
                          Subtasks ({quest.subtasks.length})
                        </h4>
                        <div className="space-y-2">
                          {quest.subtasks.map((subtask, index) => (
                            <div
                              key={subtask.id}
                              className="bg-[#202225] rounded px-3 py-2 flex items-center gap-3"
                            >
                              <div className="w-6 h-6 rounded-full bg-[#4f545c] flex items-center justify-center shrink-0 text-xs text-[#b9bbbe]">
                                {index + 1}
                              </div>
                              <span className="text-sm text-[#dcddde] flex-1">{subtask.title}</span>
                              <span className="text-xs text-[#00b0f4]">
                                ~{subtask.estimatePomodoros}üçÖ
                              </span>
                            </div>
                          ))}
                        </div>
                        
                        {/* Additional Quest Info */}
                        <div className="mt-4 grid grid-cols-2 gap-3">
                          <div className="bg-[#202225] rounded p-3">
                            <div className="text-xs text-[#b9bbbe] mb-1">Difficulty</div>
                            <div className="text-sm text-white">
                              {quest.difficulty.gmValidated || quest.difficulty.userAssigned}
                            </div>
                          </div>
                          <div className="bg-[#202225] rounded p-3">
                            <div className="text-xs text-[#b9bbbe] mb-1">Frequency</div>
                            <div className="text-sm text-white">{quest.schedule.frequency}</div>
                          </div>
                        </div>
                      </div>
                    )}
                  </div>
                );
              })}
            </div>
          )}
        </div>
      </div>
    </div>
  );
}

===== FILE: ./src\components\FocusSessionModal.tsx =====

import { useState, useEffect } from 'react';
import { Pause, Play, Square } from 'lucide-react';
import { Button } from './ui/button';
import type { FocusSession, Task } from '../App';
import { SessionService } from '../worker';

interface FocusSessionModalProps {
  session: FocusSession;
  onEnd: () => void;
  tasks: Task[];
  sessionService: SessionService;
}

export function FocusSessionModal({ session, onEnd, tasks, sessionService }: FocusSessionModalProps) {
  const [timeRemaining, setTimeRemaining] = useState(session.duration);
  const [isPaused, setIsPaused] = useState(false);
  const [currentSessionId, setCurrentSessionId] = useState<string | null>(null);

  // Start session when modal opens
  useEffect(() => {
    const startSession = async () => {
      try {
        // Create session in worker
        const newSession = await sessionService.createSession(
          'test-user-001', // Replace with actual user ID
          'quest-001', // Replace with actual quest ID
          tasks.find(t => t.title === session.subtaskName)?.id || null,
          25 // duration in minutes
        );
        setCurrentSessionId(newSession.sessionId);
      } catch (error) {
        console.error('Failed to start session:', error);
      }
    };

    startSession();
  }, []);

  useEffect(() => {
    if (isPaused || !currentSessionId) return;

    const interval = setInterval(() => {
      setTimeRemaining((prev) => {
        if (prev <= 1) {
          clearInterval(interval);
          handleSessionComplete();
          return 0;
        }
        return prev - 1;
      });
    }, 1000);

    return () => clearInterval(interval);
  }, [isPaused, currentSessionId]);

  const handlePause = async () => {
    if (!currentSessionId) return;
    
    try {
      await sessionService.pauseSession(currentSessionId);
      setIsPaused(true);
    } catch (error) {
      console.error('Failed to pause session:', error);
    }
  };

  const handleResume = async () => {
    if (!currentSessionId) return;
    
    try {
      await sessionService.resumeSession(currentSessionId);
      setIsPaused(false);
    } catch (error) {
      console.error('Failed to resume session:', error);
    }
  };

  const handleSessionComplete = async () => {
    if (!currentSessionId) return;
    
    try {
      const actualMinutes = Math.ceil((session.duration - timeRemaining) / 60);
      const result = await sessionService.completeSession(
        currentSessionId,
        actualMinutes,
        'Session completed successfully'
      );
      
      // Show XP notification (you can implement this)
      console.log(`+${result.xpAwarded} XP earned! Quality: ${result.qualityScore}`);
      
      if (result.levelUp && typeof result.levelUp === 'object') {
        console.log(`Level Up! Now level ${result.levelUp.newLevel}`);
      }
    } catch (error) {
      console.error('Failed to complete session:', error);
    } finally {
      onEnd();
    }
  };

  const handleAbandon = async () => {
    if (!currentSessionId) return;
    
    try {
      await sessionService.abandonSession(currentSessionId);
    } catch (error) {
      console.error('Failed to abandon session:', error);
    } finally {
      onEnd();
    }
  };

  const formatTime = (seconds: number) => {
    const mins = Math.floor(seconds / 60);
    const secs = seconds % 60;
    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
  };

  const progress = ((session.duration - timeRemaining) / session.duration) * 100;

  return (
    <div className="fixed inset-0 flex items-center justify-center z-50">
      {/* Backdrop */}
      <div className="absolute inset-0 bg-black/70 backdrop-blur-sm" />

      {/* Modal */}
      <div className="relative bg-[#2f3136] rounded-lg p-8 w-full max-w-2xl mx-4 shadow-2xl">
        {/* Quest Tag */}
        <div className="text-center mb-4">
          <span className="inline-block px-4 py-1 rounded bg-[#5865F2] text-white text-sm">
            {session.questTitle}
          </span>
        </div>

        {/* Subtask Name */}
        <h2 className="text-center text-2xl text-white mb-8">
          {session.subtaskName}
        </h2>

        {/* Circular Progress Timer */}
        <div className="flex justify-center mb-8">
          <div className="relative w-64 h-64">
            {/* Background circle */}
            <svg className="w-full h-full transform -rotate-90">
              <circle
                cx="128"
                cy="128"
                r="112"
                stroke="#202225"
                strokeWidth="12"
                fill="none"
              />
              {/* Progress circle */}
              <circle
                cx="128"
                cy="128"
                r="112"
                stroke="#57F287"
                strokeWidth="12"
                fill="none"
                strokeDasharray={`${2 * Math.PI * 112}`}
                strokeDashoffset={`${2 * Math.PI * 112 * (1 - progress / 100)}`}
                strokeLinecap="round"
                className="transition-all duration-1000"
              />
            </svg>
            {/* Time display */}
            <div className="absolute inset-0 flex items-center justify-center">
              <div className="text-center">
                <div className="text-6xl text-white">{formatTime(timeRemaining)}</div>
                <div className="text-sm text-[#b9bbbe] mt-2">
                  {isPaused ? 'Paused' : 'Focus Time'}
                </div>
              </div>
            </div>
          </div>
        </div>

        {/* Control Buttons */}
        <div className="flex justify-center gap-4 mb-8">
          <Button
            onClick={isPaused ? handleResume : handlePause}
            className="bg-[#5865F2] hover:bg-[#4752C4] text-white px-6"
          >
            {isPaused ? (
              <>
                <Play className="w-4 h-4 mr-2" />
                Resume
              </>
            ) : (
              <>
                <Pause className="w-4 h-4 mr-2" />
                Pause
              </>
            )}
          </Button>
          <Button
            onClick={handleAbandon}
            variant="outline"
            className="bg-transparent border-[#ed4245] text-[#ed4245] hover:bg-[#ed4245] hover:text-white px-6"
          >
            <Square className="w-4 h-4 mr-2" />
            End Session
          </Button>
        </div>

        {/* Today's Mini Task List */}
        <div className="bg-[#202225] rounded-lg p-4">
          <h3 className="text-xs uppercase tracking-wide text-[#b9bbbe] mb-3">Today's Tasks</h3>
          <div className="space-y-2 max-h-32 overflow-y-auto">
            {tasks.slice(0, 5).map((task) => (
              <div
                key={task.id}
                className={`flex items-center gap-2 text-sm ${task.completed ? 'opacity-50' : ''}`}
              >
                <div className={`w-2 h-2 rounded-full shrink-0 ${task.completed ? 'bg-[#57F287]' : 'bg-[#4f545c]'}`} />
                <span className={`text-[#dcddde] ${task.completed ? 'line-through' : ''}`}>
                  {task.title}
                </span>
              </div>
            ))}
          </div>
        </div>
      </div>
    </div>
  );
}


===== FILE: ./src\components\MainPanel.tsx =====

import { useEffect, useState } from "react";
import { Filter, Plus, Play } from "lucide-react";
import { Input } from "./ui/input";
import { Button } from "./ui/button";
import { TaskList } from "./TaskList";
import { ProgressHeatmap } from "./ProgressHeatmap";
import { AnalyticsService, AuthService, QuestUIAdapter } from "../worker";
import type { Task } from "../App";
import type { TodayMetrics } from "../worker/services/analytics.service";
import type { UserProfile } from "../worker/models/UserProfile";
import { Quest, Subtask } from "../worker/models/Quest";

interface MainPanelProps {
  userId: string;
  tasks: Task[];
  workerQuests: Quest[];
  onToggleTask: (taskId: string) => void;
  onReorderTasks: (startIndex: number, endIndex: number) => void;
  onStartFocus: (task: Task | Subtask, questTitle?: string) => void;
}

export function MainPanel({
  userId,
  tasks,
  workerQuests,
  onToggleTask,
  onReorderTasks,
  onStartFocus
}: MainPanelProps) {
  const [filter, setFilter] = useState<"all" | "scheduled" | "pomodoro">("all");
  const [stats, setStats] = useState<TodayMetrics | null>(null);
  const [userProfile, setUserProfile] = useState<UserProfile | null>(null);

  const analyticsService = new AnalyticsService();
  const authService = new AuthService();

  useEffect(() => {
    loadStats();
  }, [userId]);

  const loadStats = async () => {
    try {
      const [metrics, profile] = await Promise.all([
        analyticsService.getTodayMetrics(userId),
        authService.getCurrentUser(),
      ]);
      setStats(metrics);
      setUserProfile(profile || null);
    } catch (error) {
      console.error("Failed to load stats:", error);
    }
  };

  // const uiTasks = QuestUIAdapter.questsToTasks(workerQuests);
  // const uiTasks = tasks;


  return (
    <div className="flex-1 bg-[#36393f] flex flex-col">
      {/* Title Bar */}
      <div className="h-12 px-6 flex items-center justify-between border-b border-[#202225] shrink-0">
        <span className="text-white">Today</span>
        <div className="flex gap-2">
          <Button
            variant={filter === "all" ? "default" : "ghost"}
            size="sm"
            onClick={() => setFilter("all")}
            className={`h-7 text-xs ${
              filter === "all"
                ? "bg-[#5865F2] hover:bg-[#4752C4]"
                : "hover:bg-[#4f545c]"
            }`}
          >
            All Tasks
          </Button>
          <Button
            variant={filter === "scheduled" ? "default" : "ghost"}
            size="sm"
            onClick={() => setFilter("scheduled")}
            className={`h-7 text-xs ${
              filter === "scheduled"
                ? "bg-[#5865F2] hover:bg-[#4752C4]"
                : "hover:bg-[#4f545c]"
            }`}
          >
            Scheduled
          </Button>
          <Button
            variant={filter === "pomodoro" ? "default" : "ghost"}
            size="sm"
            onClick={() => setFilter("pomodoro")}
            className={`h-7 text-xs ${
              filter === "pomodoro"
                ? "bg-[#5865F2] hover:bg-[#4752C4]"
                : "hover:bg-[#4f545c]"
            }`}
          >
            <Filter className="w-3 h-3 mr-1" />
            Pomodoro-Ready
          </Button>
        </div>
      </div>

      {/* Scrollable Content */}
      <div className="flex-1 overflow-y-auto">
        <div className="p-6">
          {/* Top Summary Section */}
          <div className="bg-[#2f3136] rounded-lg p-4 mb-6 flex items-center justify-between">
            <div className="flex items-center gap-8">
              <div>
                <div className="text-xs text-[#b9bbbe] mb-1">Level</div>
                <div className="text-2xl text-white">
                  {userProfile?.totalLevel || 0}
                </div>
              </div>
              <div>
                <div className="text-xs text-[#b9bbbe] mb-1">XP</div>
                <div className="flex items-baseline gap-1">
                  <span className="text-2xl text-[#57F287]">
                    {userProfile?.experiencePoints || 0}
                  </span>
                  <span className="text-sm text-[#72767d]">/ 4000</span>
                </div>
                <div className="w-32 h-1 bg-[#202225] rounded-full mt-1 overflow-hidden">
                  <div
                    className="h-full bg-[#57F287] rounded-full transition-all"
                    style={{
                      width: `${
                        ((userProfile?.experiencePoints || 0) / 4000) * 100
                      }%`,
                    }}
                  />
                </div>
              </div>
              <div>
                <div className="text-xs text-[#b9bbbe] mb-1">
                  Today's Sessions
                </div>
                <div className="text-2xl text-white">
                  {stats?.sessionsCompleted || 0}
                </div>
              </div>
              <div>
                <div className="text-xs text-[#b9bbbe] mb-1">
                  Total Sessions
                </div>
                <div className="text-2xl text-white">
                  {/* TODO: Add total sessions to UserProfile */}
                  142
                </div>
              </div>
              <div>
                <div className="text-xs text-[#b9bbbe] mb-1">Active Quests</div>
                <div className="text-2xl text-[#5865F2]">
                  {/* TODO: Calculate from quests */}4
                </div>
              </div>
            </div>
          </div>

          {/* Add Subtask Bar */}
          <div className="mb-6">
            <div className="relative">
              <Plus className="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-[#72767d]" />
              <Input
                placeholder="Add a quick subtask to any quest..."
                className="bg-[#202225] border-[#202225] pl-10 h-10 placeholder:text-[#72767d] focus-visible:ring-1 focus-visible:ring-[#00b0f4]"
              />
            </div>
          </div>

          {/* Today's Task List */}
          <div className="mb-6">
            <h3 className="text-xs uppercase tracking-wide text-[#b9bbbe] mb-3">
              Today's Tasks
            </h3>
            <TaskList
              tasks={tasks}
              onToggleTask={onToggleTask}
              onReorderTasks={onReorderTasks}
              onStartFocus={onStartFocus}
            />
          </div>

          {/* Progress Heatmap */}
          <div>
            <h3 className="text-xs uppercase tracking-wide text-[#b9bbbe] mb-3">
              Monthly Progress
            </h3>
            <ProgressHeatmap userId={userId} />
          </div>
        </div>
      </div>

      {/* Floating Action Button */}
      <button
        onClick={() => {
          const firstIncompleteTask = tasks.find((t) => !t.completed);
          if (firstIncompleteTask) onStartFocus(firstIncompleteTask, firstIncompleteTask.questId);
        }}
        className="fixed bottom-8 right-8 w-14 h-14 bg-[#57F287] hover:bg-[#3ba55d] rounded-full flex items-center justify-center shadow-lg transition-all hover:scale-110 group"
      >
        <Play className="w-6 h-6 text-white ml-0.5" fill="white" />
      </button>
    </div>
  );
}


===== FILE: ./src\components\MiddlePanel.tsx =====

import { useEffect, useState } from "react";
import { Search, Sparkles, MessageCircle, Activity } from "lucide-react";
import { Input } from "./ui/input";
import { SearchService, ActivityFeedService } from "../worker";
import type { Quest } from "../worker/models/Quest";
import type { ActivityItem } from "../worker/models/ActivityItem";

interface MiddlePanelProps {
  userId: string;
}

export function MiddlePanel({ userId }: MiddlePanelProps) {
  const [searchQuery, setSearchQuery] = useState("");
  const [searchResults, setSearchResults] = useState<Quest[]>([]);
  const [activityFeed, setActivityFeed] = useState<ActivityItem[]>([]);

  const searchService = new SearchService();
  const activityService = new ActivityFeedService();

  useEffect(() => {
    loadActivityFeed();
  }, [userId]);

  useEffect(() => {
    handleSearch();
  }, [searchQuery]);

  const loadActivityFeed = async () => {
    try {
      const activities = await activityService.getActivityFeed(userId, {
        limit: 10,
      });
      setActivityFeed(activities);
    } catch (error) {
      console.error("Failed to load activity feed:", error);
    }
  };

  const handleSearch = async () => {
    if (searchQuery.length < 2) {
      setSearchResults([]);
      return;
    }

    try {
      const results = await searchService.searchQuestsOnly(
        userId,
        searchQuery,
        {
          limit: 10,
        }
      );
      setSearchResults(results);
    } catch (error) {
      console.error("Search failed:", error);
    }
  };

  const gmSuggestions = [
    {
      id: 1,
      text: "Complete 3 focus sessions to level up!",
      type: "challenge",
    },
    { id: 2, text: "Your streak is at 7 days. Keep it up!", type: "milestone" },
  ];

  const watcherComments = [
    {
      id: 1,
      user: "TaskMaster",
      avatar: "üéØ",
      comment: "Great progress today!",
      time: "2h ago",
    },
    {
      id: 2,
      user: "FocusBot",
      avatar: "ü§ñ",
      comment: "You've earned 250 XP",
      time: "4h ago",
    },
  ];

  // const activityFeed = [
  //   { id: 1, text: 'Completed "Morning meditation"', time: '1h ago' },
  //   { id: 2, text: 'Started Work Sprint quest', time: '3h ago' },
  //   { id: 3, text: 'Reached Level 15', time: '5h ago' },
  // ];

  return (
    <div className="w-60 bg-[#2f3136] flex flex-col border-r border-[#202225]">
      {/* Title Bar */}
      <div className="h-12 px-4 flex items-center border-b border-[#202225] shrink-0">
        <span className="text-white uppercase tracking-wide text-xs">
          Activity Feed
        </span>
      </div>

      {/* Scrollable Content */}
      <div className="flex-1 overflow-y-auto">
        {/* Search Bar */}
        <div className="p-2 border-b border-[#202225]">
          <div className="relative">
            <Search className="absolute left-2 top-1/2 -translate-y-1/2 w-4 h-4 text-[#72767d]" />
            <Input
              placeholder="Search tasks, quests..."
              value={searchQuery}
              onChange={(e) => setSearchQuery(e.target.value)}
              className="bg-[#202225] border-0 pl-8 h-8 text-sm placeholder:text-[#72767d] focus-visible:ring-1 focus-visible:ring-[#00b0f4]"
            />
          </div>
          {/* Search Results */}
          {searchResults.length > 0 && (
            <div className="mt-2 space-y-1">
              {searchResults.map((quest) => (
                <div
                  key={quest.questId}
                  className="bg-[#202225] rounded px-2 py-1 text-xs text-[#dcddde] hover:bg-[#34373c] cursor-pointer"
                >
                  {quest.title}
                </div>
              ))}
            </div>
          )}
        </div>

        {/* GM Suggestions */}
        <div className="p-3 border-b border-[#202225]">
          <div className="flex items-center gap-2 mb-2">
            <Sparkles className="w-4 h-4 text-[#faa61a]" />
            <span className="text-xs uppercase tracking-wide text-[#b9bbbe]">
              GM Suggestions
            </span>
          </div>
          {gmSuggestions.map((suggestion) => (
            <div
              key={suggestion.id}
              className="bg-[#202225] rounded px-3 py-2 mb-2 text-sm"
            >
              <p className="text-[#dcddde]">{suggestion.text}</p>
            </div>
          ))}
        </div>

        {/* Watchers Comments */}
        <div className="p-3 border-b border-[#202225]">
          <div className="flex items-center gap-2 mb-2">
            <MessageCircle className="w-4 h-4 text-[#57F287]" />
            <span className="text-xs uppercase tracking-wide text-[#b9bbbe]">
              Watchers
            </span>
          </div>
          {watcherComments.map((comment) => (
            <div key={comment.id} className="flex gap-2 mb-3">
              <div className="w-8 h-8 rounded-full bg-[#5865F2] flex items-center justify-center shrink-0">
                <span>{comment.avatar}</span>
              </div>
              <div className="flex-1 min-w-0">
                <div className="flex items-center gap-2">
                  <span className="text-sm text-[#dcddde]">{comment.user}</span>
                  <span className="text-xs text-[#72767d]">{comment.time}</span>
                </div>
                <p className="text-xs text-[#b9bbbe]">{comment.comment}</p>
              </div>
            </div>
          ))}
        </div>

        {/* Activity Feed */}
        <div className="p-3">
          <div className="flex items-center gap-2 mb-2">
            <Activity className="w-4 h-4 text-[#00b0f4]" />
            <span className="text-xs uppercase tracking-wide text-[#b9bbbe]">
              Recent Activity
            </span>
          </div>
          {activityFeed.length > 0 ? (
            activityFeed.slice(0, 5).map((activity) => (
              <div
                key={activity.activityId}
                className="mb-2 pl-3 border-l-2 border-[#202225] hover:border-[#00b0f4] transition-colors"
              >
                <p className="text-sm text-[#dcddde]">
                  {activity.type === "level_up" &&
                    `Reached Level ${activity.data.level}`}
                  {activity.type === "quest_complete" &&
                    `Completed "${activity.data.questTitle}"`}
                  {activity.type === "streak_milestone" &&
                    `${activity.data.streakDays}-day streak!`}
                </p>
                <span className="text-xs text-[#72767d]">
                  {new Date(activity.timestamp).toLocaleTimeString()}
                </span>
              </div>
            ))
          ) : (
            <p className="text-xs text-[#72767d]">No recent activity</p>
          )}
        </div>
      </div>
    </div>
  );
}


===== FILE: ./src\components\NavigationSidebar.tsx =====

import { Home, Sword, Package, TrendingUp, Users, Settings } from 'lucide-react';
import { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from './ui/tooltip';

interface NavigationSidebarProps {
  activeNav: string;
  setActiveNav: (nav: string) => void;
}

const navItems = [
  { id: 'home', icon: Home, label: 'Home' },
  { id: 'quests', icon: Sword, label: 'Quests' },
  { id: 'inventory', icon: Package, label: 'Inventory' },
  { id: 'progress', icon: TrendingUp, label: 'Progress' },
  { id: 'guilds', icon: Users, label: 'Guilds' },
  { id: 'settings', icon: Settings, label: 'Settings' },
];

export function NavigationSidebar({ activeNav, setActiveNav }: NavigationSidebarProps) {
  return (
    <div className="w-[72px] bg-[#202225] flex flex-col items-center py-3 gap-2">
      {/* App Icon/Logo */}
      <div className="w-12 h-12 bg-[#5865F2] rounded-[24px] hover:rounded-[16px] transition-all duration-200 flex items-center justify-center mb-2 cursor-pointer">
        <Sword className="w-6 h-6 text-white" />
      </div>
      
      <div className="w-8 h-[2px] bg-[#36393f] rounded-full mb-1" />
      
      {/* Navigation Items */}
      <TooltipProvider delayDuration={100}>
        {navItems.map((item) => {
          const Icon = item.icon;
          const isActive = activeNav === item.id;
          
          return (
            <Tooltip key={item.id}>
              <TooltipTrigger asChild>
                <button
                  onClick={() => setActiveNav(item.id)}
                  className={`
                    w-12 h-12 rounded-[24px] hover:rounded-[16px] transition-all duration-200
                    flex items-center justify-center relative group
                    ${isActive ? 'bg-[#5865F2] rounded-[16px]' : 'bg-[#36393f] hover:bg-[#5865F2]'}
                  `}
                >
                  <Icon className={`w-5 h-5 ${isActive ? 'text-white' : 'text-[#dcddde]'}`} />
                  {isActive && (
                    <div className="absolute -left-1 w-2 h-10 bg-white rounded-r-full" />
                  )}
                </button>
              </TooltipTrigger>
              <TooltipContent side="right" className="bg-[#18191c] border-0 text-[#dcddde]">
                {item.label}
              </TooltipContent>
            </Tooltip>
          );
        })}
      </TooltipProvider>
    </div>
  );
}


===== FILE: ./src\components\ProgressHeatmap.tsx =====

import { useEffect, useState } from 'react';
import { AnalyticsService } from '../worker';
import type { HeatmapDay } from '../worker/services/analytics.service';

interface ProgressHeatmapProps {
  userId: string;
}

export function ProgressHeatmap({ userId }: ProgressHeatmapProps) {
  const [heatmapData, setHeatmapData] = useState<HeatmapDay[]>([]);
  const analyticsService = new AnalyticsService();

  useEffect(() => {
    loadHeatmap();
  }, [userId]);

  const loadHeatmap = async () => {
    try {
      // Get current month data
      const today = new Date();
      const startOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
      const endOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0);

      const data = await analyticsService.getHeatmapData(
        userId,
        startOfMonth.toISOString().split('T')[0],
        endOfMonth.toISOString().split('T')[0]
      );

      setHeatmapData(data);
    } catch (error) {
      console.error('Failed to load heatmap:', error);
    }
  };

  // Get intensity color from heatmap data
  const getIntensityColor = (intensity: number) => {
    const colors = ['#202225', '#0e2544ff', '#00366dff', '#2657a6ff', '#399dd3ff'];
    return colors[intensity] || colors[0];
  };

  // Generate calendar grid including empty cells
  const generateCalendarGrid = () => {
    const today = new Date();
    const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
    const daysInMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0).getDate();
    const startDayOfWeek = firstDay.getDay();

    const grid: (HeatmapDay | null)[] = [];

    // Empty cells before month starts
    for (let i = 0; i < startDayOfWeek; i++) {
      grid.push(null);
    }

    // Days of the month
    for (let day = 1; day <= daysInMonth; day++) {
      const dateStr = new Date(today.getFullYear(), today.getMonth(), day)
        .toISOString()
        .split('T')[0];
      
      const dayData = heatmapData.find(d => d.date === dateStr);
      grid.push(dayData || { date: dateStr, count: 0, intensity: 0 });
    }

    return grid;
  };

  const calendarGrid = generateCalendarGrid();
  const weekDays = ['S', 'M', 'T', 'W', 'T', 'F', 'S'];

  return (
    <div className="bg-[#2f3136] rounded-lg p-4">
      {/* Weekday labels */}
      <div className="grid grid-cols-7 gap-1 mb-1">
        {weekDays.map((day, i) => (
          <div key={i} className="text-xs text-[#72767d] text-center">
            {day}
          </div>
        ))}
      </div>

      {/* Calendar grid */}
      <div className="grid grid-cols-7 gap-1">
        {calendarGrid.map((data, index) => (
          <div
            key={index}
            className="aspect-square rounded-sm relative group cursor-pointer"
            style={{ 
              backgroundColor: data ? getIntensityColor(data.intensity) : '#202225' 
            }}
          >
            {data && (
              <>
                <div className="absolute inset-0 flex items-center justify-center text-xs text-white opacity-70">
                  {new Date(data.date).getDate()}
                </div>
                {/* Tooltip on hover */}
                <div className="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1 bg-[#18191c] rounded text-xs whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10">
                  {data.count} sessions
                </div>
              </>
            )}
          </div>
        ))}
      </div>

      {/* Legend */}
      <div className="flex items-center gap-2 mt-3 justify-end">
        <span className="text-xs text-[#72767d]">Less</span>
        <div className="flex gap-1">
          {[0, 1, 2, 3, 4].map((intensity) => (
            <div
              key={intensity}
              className="w-3 h-3 rounded-sm"
              style={{ backgroundColor: getIntensityColor(intensity) }}
            />
          ))}
        </div>
        <span className="text-xs text-[#72767d]">More</span>
      </div>
    </div>
  );
}

===== FILE: ./src\components\QuestDetails.tsx =====

import { useState } from 'react';
import { Play, ChevronDown, ChevronRight, Check, MessageSquare, History, Shield, Users, Calendar } from 'lucide-react';
import { Checkbox } from './ui/checkbox';
import { Button } from './ui/button';
import { Textarea } from './ui/textarea';
import type { Quest, Subtask } from '../worker/models/Quest';
import type { GoalComment } from '../worker/models/GoalComment';
import { Task } from '../App';

interface QuestDetailsProps {
  quest: Quest;
  comments: GoalComment[];
  onStartFocus: (task: Task | Subtask, questTitle: string) => void;
  onToggleSubtask: (questId: string, subtaskId: string) => void;
  onAddComment?: (questId: string, text: string) => void;
}

export function QuestDetails({ 
  quest, 
  comments,
  onStartFocus, 
  onToggleSubtask,
  onAddComment 
}: QuestDetailsProps) {
  const [expandedSections, setExpandedSections] = useState({
    milestones: true,
    subtasks: true,
    comments: true,
    history: false,
  });
  const [commentText, setCommentText] = useState('');

  const toggleSection = (section: keyof typeof expandedSections) => {
    setExpandedSections(prev => ({ ...prev, [section]: !prev[section] }));
  };

  const getTypeIcon = () => {
    if (quest.isDungeon) return <Users className="w-4 h-4" />;
    if (quest.members && quest.members.length > 1) return <Users className="w-4 h-4" />;
    return <Shield className="w-4 h-4" />;
  };

  const getTypeColor = () => {
    if (quest.isDungeon) return '#ED4245';
    if (quest.members && quest.members.length > 1) return '#FEE75C';
    return '#5865F2';
  };

  const getTypeLabel = () => {
    if (quest.isDungeon) return 'dungeon';
    if (quest.members && quest.members.length > 1) return 'guild';
    return 'personal';
  };

  const handlePostComment = () => {
    if (commentText.trim() && onAddComment) {
      onAddComment(quest.questId, commentText);
      setCommentText('');
    }
  };

  const progress = Math.round((quest.gamification.currentExp / quest.gamification.expToNextLevel) * 100);
  const color = getColorForDifficulty(quest.difficulty.userAssigned);

  // Convert progressHistory to milestones format
  const milestones = quest.progressHistory
    .filter(h => h.isMilestone)
    .map(h => ({
      id: h.date,
      title: `Milestone on ${new Date(h.date).toLocaleDateString()}`,
      completed: true,
      xp: h.expEarned
    }));

  return (
    <div className="flex-1 bg-[#36393f] flex flex-col">
      {/* Title Bar */}
      <div className="h-12 px-6 flex items-center border-b border-[#202225] shrink-0">
        <span className="text-xl mr-2">{getIconForQuest(quest)}</span>
        <span className="text-white">{quest.title}</span>
        <div
          className="ml-3 px-2 py-1 rounded text-xs uppercase tracking-wide flex items-center gap-1"
          style={{ backgroundColor: `${getTypeColor()}20`, color: getTypeColor() }}
        >
          {getTypeIcon()}
          {getTypeLabel()}
        </div>
        {quest.members && quest.members.length > 0 && (
          <div className="ml-3 flex items-center gap-1 text-xs text-[#b9bbbe]">
            <Users className="w-3 h-3" />
            {quest.members.length} warriors
          </div>
        )}
        {quest.dueDate && (
          <div className="ml-3 flex items-center gap-1 text-xs text-[#b9bbbe]">
            <Calendar className="w-3 h-3" />
            {new Date(quest.dueDate).toLocaleDateString()}
          </div>
        )}
      </div>

      {/* Scrollable Content */}
      <div className="flex-1 overflow-y-auto">
        <div className="p-6">
          {/* Level & XP Section */}
          <div className="bg-[#2f3136] rounded-lg p-4 mb-6">
            <div className="flex items-center justify-between mb-3">
              <div>
                <div className="text-xs text-[#b9bbbe] mb-1">Quest Level</div>
                <div className="text-2xl text-white">{quest.gamification.currentLevel}</div>
              </div>
              <div className="flex-1 max-w-md mx-8">
                <div className="flex items-baseline justify-between mb-1">
                  <span className="text-xs text-[#b9bbbe]">XP Progress</span>
                  <span className="text-xs text-[#b9bbbe]">
                    {quest.gamification.currentExp} / {quest.gamification.expToNextLevel}
                  </span>
                </div>
                <div className="w-full h-2 bg-[#202225] rounded-full overflow-hidden">
                  <div
                    className="h-full rounded-full transition-all"
                    style={{
                      width: `${progress}%`,
                      backgroundColor: color,
                    }}
                  />
                </div>
              </div>
            </div>
          </div>

          {/* Description */}
          <div className="mb-6">
            <h3 className="text-xs uppercase tracking-wide text-[#b9bbbe] mb-2">Description</h3>
            <p className="text-sm text-[#dcddde]">{quest.description}</p>
          </div>

          {/* Difficulty & Schedule Info */}
          <div className="mb-6 grid grid-cols-2 gap-4">
            <div className="bg-[#2f3136] rounded-lg p-3">
              <div className="text-xs text-[#b9bbbe] mb-1">Difficulty</div>
              <div className="text-sm text-white font-medium">
                {quest.difficulty.gmValidated || quest.difficulty.userAssigned}
                {quest.difficulty.isLocked && ' ‚úì'}
              </div>
              <div className="text-xs text-[#00b0f4] mt-1">
                {quest.difficulty.xpPerPomodoro} XP/pomodoro
              </div>
            </div>
            <div className="bg-[#2f3136] rounded-lg p-3">
              <div className="text-xs text-[#b9bbbe] mb-1">Frequency</div>
              <div className="text-sm text-white font-medium">{quest.schedule.frequency}</div>
              <div className="text-xs text-[#72767d] mt-1">
                Target: {quest.schedule.targetCompletionsPerCycle} / cycle
              </div>
            </div>
          </div>

          {/* Milestones */}
          {milestones.length > 0 && (
            <div className="mb-6">
              <button
                onClick={() => toggleSection('milestones')}
                className="flex items-center gap-2 mb-2 hover:text-white transition-colors"
              >
                {expandedSections.milestones ? (
                  <ChevronDown className="w-4 h-4 text-[#b9bbbe]" />
                ) : (
                  <ChevronRight className="w-4 h-4 text-[#b9bbbe]" />
                )}
                <h3 className="text-xs uppercase tracking-wide text-[#b9bbbe]">
                  Milestones ({milestones.length})
                </h3>
              </button>

              {expandedSections.milestones && (
                <div className="space-y-2">
                  {milestones.map(milestone => (
                    <div
                      key={milestone.id}
                      className="bg-[#2f3136] rounded px-3 py-3 flex items-center gap-3"
                    >
                      <div className="w-6 h-6 rounded-full flex items-center justify-center shrink-0 bg-[#57F287]">
                        <Check className="w-4 h-4 text-white" />
                      </div>
                      <div className="flex-1">
                        <span className="text-sm text-[#dcddde]">{milestone.title}</span>
                      </div>
                      <span className="text-xs text-[#faa61a]">+{milestone.xp} XP</span>
                    </div>
                  ))}
                </div>
              )}
            </div>
          )}

          {/* Subtasks */}
          <div className="mb-6">
            <button
              onClick={() => toggleSection('subtasks')}
              className="flex items-center gap-2 mb-2 hover:text-white transition-colors"
            >
              {expandedSections.subtasks ? (
                <ChevronDown className="w-4 h-4 text-[#b9bbbe]" />
              ) : (
                <ChevronRight className="w-4 h-4 text-[#b9bbbe]" />
              )}
              <h3 className="text-xs uppercase tracking-wide text-[#b9bbbe]">
                Subtasks ({quest.subtasks.filter(s => s.isComplete).length}/{quest.subtasks.length})
              </h3>
            </button>

            {expandedSections.subtasks && (
              <div className="space-y-2">
                {quest.subtasks.map(subtask => (
                  <div
                    key={subtask.id}
                    className={`
                      group bg-[#2f3136] rounded px-3 py-3 flex items-center gap-3
                      hover:bg-[#34373c] transition-colors
                      ${subtask.isComplete ? 'opacity-60' : ''}
                    `}
                  >
                    <Checkbox
                      checked={subtask.isComplete}
                      onCheckedChange={() => onToggleSubtask(quest.questId, subtask.id)}
                      className="border-[#4f545c] data-[state=checked]:bg-[#57F287] data-[state=checked]:border-[#57F287]"
                    />
                    <div className="flex-1">
                      <span className={`text-sm ${subtask.isComplete ? 'line-through text-[#72767d]' : 'text-[#dcddde]'}`}>
                        {subtask.title}
                      </span>
                      {subtask.revisionCount > 0 && (
                        <span className="text-xs text-[#72767d] ml-2">
                          (rev: {subtask.revisionCount})
                        </span>
                      )}
                    </div>
                    <span className="text-xs text-[#00b0f4]">
                      ~{subtask.estimatePomodoros}üçÖ
                    </span>
                    {!subtask.isComplete && (
                      <button
                        onClick={() => onStartFocus(subtask, quest.title)}
                        className="w-8 h-8 rounded-full bg-[#5865F2] hover:bg-[#4752C4] flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity shrink-0"
                      >
                        <Play className="w-4 h-4 text-white ml-0.5" fill="white" />
                      </button>
                    )}
                  </div>
                ))}
              </div>
            )}
          </div>

          {/* Comments Section */}
          <div className="mb-6">
            <button
              onClick={() => toggleSection('comments')}
              className="flex items-center gap-2 mb-2 hover:text-white transition-colors"
            >
              {expandedSections.comments ? (
                <ChevronDown className="w-4 h-4 text-[#b9bbbe]" />
              ) : (
                <ChevronRight className="w-4 h-4 text-[#b9bbbe]" />
              )}
              <MessageSquare className="w-4 h-4 text-[#b9bbbe]" />
              <h3 className="text-xs uppercase tracking-wide text-[#b9bbbe]">
                Comments ({comments.length})
              </h3>
            </button>

            {expandedSections.comments && (
              <div className="space-y-3">
                {comments.map(comment => (
                  <div key={comment.commentId} className="bg-[#2f3136] rounded p-3">
                    <div className="flex items-center gap-2 mb-2">
                      <div className="w-8 h-8 rounded-full bg-[#5865F2] flex items-center justify-center">
                        <span>üë§</span>
                      </div>
                      <div>
                        <div className="text-sm text-white">{comment.username}</div>
                        <div className="text-xs text-[#72767d]">
                          {new Date(comment.timestamp).toLocaleString()}
                        </div>
                      </div>
                      <span className={`
                        ml-auto text-xs px-2 py-1 rounded
                        ${comment.type === 'encouragement' ? 'bg-[#57F287]20 text-[#57F287]' : ''}
                        ${comment.type === 'question' ? 'bg-[#00b0f4]20 text-[#00b0f4]' : ''}
                        ${comment.type === 'suggestion' ? 'bg-[#faa61a]20 text-[#faa61a]' : ''}
                      `}>
                        {comment.type}
                      </span>
                    </div>
                    <p className="text-sm text-[#dcddde]">{comment.text}</p>
                  </div>
                ))}
                {onAddComment && (
                  <div className="space-y-2">
                    <Textarea
                      placeholder="Add a comment..."
                      value={commentText}
                      onChange={(e) => setCommentText(e.target.value)}
                      className="bg-[#202225] border-[#202225] min-h-[80px] placeholder:text-[#72767d] focus-visible:ring-1 focus-visible:ring-[#00b0f4]"
                    />
                    <Button 
                      onClick={handlePostComment}
                      disabled={!commentText.trim()}
                      className="bg-[#5865F2] hover:bg-[#4752C4]"
                    >
                      Post Comment
                    </Button>
                  </div>
                )}
              </div>
            )}
          </div>

          {/* History / Log */}
          <div className="mb-6">
            <button
              onClick={() => toggleSection('history')}
              className="flex items-center gap-2 mb-2 hover:text-white transition-colors"
            >
              {expandedSections.history ? (
                <ChevronDown className="w-4 h-4 text-[#b9bbbe]" />
              ) : (
                <ChevronRight className="w-4 h-4 text-[#b9bbbe]" />
              )}
              <History className="w-4 h-4 text-[#b9bbbe]" />
              <h3 className="text-xs uppercase tracking-wide text-[#b9bbbe]">Activity History</h3>
            </button>

            {expandedSections.history && (
              <div className="space-y-2">
                {quest.progressHistory.slice().reverse().map((item, index) => (
                  <div key={index} className="pl-3 border-l-2 border-[#202225] hover:border-[#5865F2] transition-colors py-1">
                    <p className="text-sm text-[#dcddde]">
                      {item.sessionsCompleted} sessions completed ‚Ä¢ {item.expEarned} XP earned
                    </p>
                    <span className="text-xs text-[#72767d]">
                      {new Date(item.date).toLocaleDateString()}
                    </span>
                  </div>
                ))}
                {quest.progressHistory.length === 0 && (
                  <div className="text-sm text-[#72767d] text-center py-4">
                    No activity yet
                  </div>
                )}
              </div>
            )}
          </div>
        </div>
      </div>

      {/* Floating Action Button */}
      <button
        onClick={() => {
          const firstIncompleteSubtask = quest.subtasks.find(s => !s.isComplete);
          if (firstIncompleteSubtask) onStartFocus(firstIncompleteSubtask, quest.title);
        }}
        className="fixed bottom-8 right-8 w-14 h-14 bg-[#57F287] hover:bg-[#3ba55d] rounded-full flex items-center justify-center shadow-lg transition-all hover:scale-110"
      >
        <Play className="w-6 h-6 text-white ml-0.5" fill="white" />
      </button>
    </div>

    );
}

function getIconForQuest(quest: Quest) {
  if (quest.isDungeon) return <Users className="w-6 h-6 text-[#ED4245]" />;
  if (quest.members && quest.members.length > 1) return <Users className="w-6 h-6 text-[#FEE75C]" />;
  return <Shield className="w-6 h-6 text-[#5865F2]" />;
}
function getColorForDifficulty(difficulty: string): string {
  const colors: Record<string, string> = {
    'Trivial': '#72767d',
    'Easy': '#57F287',
    'Medium': '#faa61a',
    'Hard': '#ED4245',
    'Extreme': '#8B0000',
  };
  return colors[difficulty] || '#72767d';
}



===== FILE: ./src\components\QuestsMainPanel.tsx =====

import { QuestDetails } from './QuestDetails';
import { DiscoveryView } from './DiscoveryView';
import type { Quest, Subtask } from '../worker/models/Quest';
import type { GoalComment } from '../worker/models/GoalComment';
import { Task } from '../App';

interface QuestsMainPanelProps {
  quests: Quest[];
  selectedQuestId: string | null;
  discoveryMode: boolean;
  questComments: Record<string, GoalComment[]>;
  onStartFocus: (subtask: Task | Subtask, questTitle: string) => void;
  onJoinQuest: (questId: string) => void;
  onWatchQuest: (questId: string) => void;
  onToggleSubtask: (questId: string, subtaskId: string) => void;
  onAddComment?: (questId: string, text: string) => void;
  publicQuests?: Quest[];
}

export function QuestsMainPanel({
  quests,
  selectedQuestId,
  discoveryMode,
  questComments,
  onStartFocus,
  onJoinQuest,
  onWatchQuest,
  onToggleSubtask,
  onAddComment,
  publicQuests = [],
}: QuestsMainPanelProps) {
  const selectedQuest = selectedQuestId ? quests.find(q => q.questId === selectedQuestId) : null;

  if (discoveryMode) {
    return (
      <DiscoveryView
        quests={quests}
        publicQuests={publicQuests}
        onJoinQuest={onJoinQuest}
        onWatchQuest={onWatchQuest}
      />
    );
  }

  if (selectedQuest) {
    const comments = questComments[selectedQuest.questId] || [];
    return (
      <QuestDetails
        quest={selectedQuest}
        comments={comments}
        onStartFocus={onStartFocus}
        onToggleSubtask={onToggleSubtask}
        onAddComment={onAddComment}
      />
    );
  }

  // Default empty state
  return (
    <div className="flex-1 bg-[#36393f] flex items-center justify-center">
      <div className="text-center">
        <div className="text-6xl mb-4">‚öîÔ∏è</div>
        <h2 className="text-xl text-white mb-2">Select a Quest</h2>
        <p className="text-sm text-[#72767d]">Choose a quest from the sidebar to get started</p>
      </div>
    </div>
  );
}


===== FILE: ./src\components\QuestsMiddlePanel.tsx =====

import { useState } from 'react';
import { ChevronDown, ChevronRight, Search, MessageCircle, Bell, Compass } from 'lucide-react';
import { Input } from './ui/input';
import type { Quest } from '../worker/models/Quest';
import type { Notification as WorkerNotification } from '../worker/models/Notification';
import { QuestService } from '../worker';
import { GoalComment } from '../worker/models/GoalComment';

interface QuestsMiddlePanelProps {
  quests: Quest[];
  notifications: WorkerNotification[];
  onQuestSelect: (questId: string) => void;
  onDiscoverySelect: () => void;
  onNotificationClick: (questId: string) => void;
  selectedQuestId: string | null;
  discoveryMode: boolean;
}

export function QuestsMiddlePanel({
  quests,
  notifications,
  onQuestSelect,
  onDiscoverySelect,
  onNotificationClick,
  selectedQuestId,
  discoveryMode,
}: QuestsMiddlePanelProps) {
  const [expandedSections, setExpandedSections] = useState<{
    myQuests: boolean;
    watching: boolean;
  }>({
    myQuests: true,
    watching: true,
  });
  const [searchQuery, setSearchQuery] = useState('');
  // const [questComments, setQuestComments] = useState<Record<string, GoalComment[]>>({});
  // const questService = new QuestService();

  const toggleSection = (section: 'myQuests' | 'watching') => {
    setExpandedSections((prev) => ({
      ...prev,
      [section]: !prev[section],
    }));
  };

// const loadQuestComments = async (questId: string) => {
//     try {
//       const comments = await questService.getQuestComments(questId);
//       setQuestComments(prev => ({
//         ...prev,
//         [questId]: comments
//       }));
//     } catch (error) {
//       console.error('Failed to load comments:', error);
//     }
//   };
  // Filter quests based on watchers array (using worker Quest model)
  const myQuests = quests.filter(q => q.ownerId); // Quests I own
  const watchingQuests = quests.filter(q => q.watchers && q.watchers.length > 0);

  // Categorize my quests
  const personalQuests = myQuests.filter(q => !q.isDungeon && (!q.members || q.members.length <= 1));
  const dungeonQuests = myQuests.filter(q => q.isDungeon);
  const guildQuests = myQuests.filter(q => !q.isDungeon && q.members && q.members.length > 1);

  // Search filter
  const filteredMyQuests = myQuests.filter(q =>
    q.title.toLowerCase().includes(searchQuery.toLowerCase())
  );
  const filteredWatching = watchingQuests.filter(q =>
    q.title.toLowerCase().includes(searchQuery.toLowerCase())
  );


  const QuestItem = ({ quest, isWatching = false }: { quest: Quest; isWatching?: boolean }) => {
    const progress = Math.round((quest.gamification.currentExp / quest.gamification.expToNextLevel) * 100);
    const color = getColorForQuest(quest);
    
    return (
      <button
        onClick={() => onQuestSelect(quest.questId)}
        className={`
          w-full text-left px-2 py-2 rounded hover:bg-[#34373c] transition-colors
          ${selectedQuestId === quest.questId && !discoveryMode ? 'bg-[#404449]' : ''}
        `}
      >
        <div className="flex items-center gap-2 mb-1">
          <span className="text-base">{getIconForQuest(quest)}</span>
          <span className="text-sm text-[#dcddde] flex-1 truncate">{quest.title}</span>
          {isWatching && quest.watchers.length > 0 && (
            <div className="w-5 h-5 rounded-full bg-[#ed4245] flex items-center justify-center shrink-0">
              <span className="text-xs text-white">{quest.watchers.length}</span>
            </div>
          )}
        </div>
        {/* Progress bar */}
        <div className="w-[40%] h-1 bg-[#202225] rounded-full overflow-hidden">
          <div
            className="h-full rounded-full transition-all"
            style={{
              width: `${progress}%`,
              backgroundColor: color,
            }}
          />
        </div>
      </button>
    );
  };

  return (
    <div className="w-60 bg-[#2f3136] flex flex-col border-r border-[#202225]">
      {/* Title Bar */}
      <div className="h-12 px-4 flex items-center border-b border-[#202225] shrink-0">
        <span className="text-white uppercase tracking-wide text-xs">Quests</span>
      </div>

      {/* Scrollable Content */}
      <div className="flex-1 overflow-y-auto">
        {/* Search Bar */}
        <div className="p-2 border-b border-[#202225]">
          <div className="relative">
            <Search className="absolute left-2 top-1/2 -translate-y-1/2 w-4 h-4 text-[#72767d]" />
            <Input
              placeholder="Search quests..."
              value={searchQuery}
              onChange={(e) => setSearchQuery(e.target.value)}
              className="bg-[#202225] border-0 pl-8 h-8 text-sm placeholder:text-[#72767d] focus-visible:ring-1 focus-visible:ring-[#00b0f4]"
            />
          </div>
        </div>

        {/* My Quests (Collapsible) */}
        <div className="border-b border-[#202225]">
          <button
            onClick={() => toggleSection('myQuests')}
            className="w-full px-3 py-2 flex items-center gap-2 hover:bg-[#34373c] transition-colors"
          >
            {expandedSections.myQuests ? (
              <ChevronDown className="w-4 h-4 text-[#b9bbbe]" />
            ) : (
              <ChevronRight className="w-4 h-4 text-[#b9bbbe]" />
            )}
            <span className="text-xs uppercase tracking-wide text-[#b9bbbe]">My Quests</span>
            <span className="text-xs text-[#72767d] ml-auto">{filteredMyQuests.length}</span>
          </button>

          {expandedSections.myQuests && (
            <div className="px-2 pb-2 space-y-1">
              {/* Personal Quests */}
              {personalQuests.length > 0 && (
                <div className="mb-2">
                  <div className="px-2 py-1">
                    <span className="text-xs text-[#72767d] uppercase">Personal</span>
                  </div>
                  {personalQuests.filter(q =>
                    q.title.toLowerCase().includes(searchQuery.toLowerCase())
                  ).map(quest => (
                    <QuestItem key={quest.questId} quest={quest} />
                  ))}
                </div>
              )}

              {/* Dungeon Quests */}
              {dungeonQuests.length > 0 && (
                <div className="mb-2">
                  <div className="px-2 py-1">
                    <span className="text-xs text-[#72767d] uppercase">Dungeon</span>
                  </div>
                  {dungeonQuests.filter(q =>
                    q.title.toLowerCase().includes(searchQuery.toLowerCase())
                  ).map(quest => (
                    <QuestItem key={quest.questId} quest={quest} />
                  ))}
                </div>
              )}

              {/* Guild Quests */}
              {guildQuests.length > 0 && (
                <div>
                  <div className="px-2 py-1">
                    <span className="text-xs text-[#72767d] uppercase">Guild</span>
                  </div>
                  {guildQuests.filter(q =>
                    q.title.toLowerCase().includes(searchQuery.toLowerCase())
                  ).map(quest => (
                    <QuestItem key={quest.questId} quest={quest} />
                  ))}
                </div>
              )}

              {filteredMyQuests.length === 0 && (
                <div className="px-2 py-3 text-xs text-[#72767d] text-center">
                  No quests found
                </div>
              )}
            </div>
          )}
        </div>

        {/* Watching (Collapsible) */}
        <div className="border-b border-[#202225]">
          <button
            onClick={() => toggleSection('watching')}
            className="w-full px-3 py-2 flex items-center gap-2 hover:bg-[#34373c] transition-colors"
          >
            {expandedSections.watching ? (
              <ChevronDown className="w-4 h-4 text-[#b9bbbe]" />
            ) : (
              <ChevronRight className="w-4 h-4 text-[#b9bbbe]" />
            )}
            <MessageCircle className="w-4 h-4 text-[#57F287]" />
            <span className="text-xs uppercase tracking-wide text-[#b9bbbe]">Watching</span>
            <span className="text-xs text-[#72767d] ml-auto">{filteredWatching.length}</span>
          </button>

          {expandedSections.watching && (
            <div className="px-2 pb-2 space-y-1">
              {filteredWatching.map(quest => (
                <QuestItem key={quest.questId} quest={quest} isWatching />
              ))}
              {filteredWatching.length === 0 && (
                <div className="px-2 py-3 text-xs text-[#72767d] text-center">
                  No quests being watched
                </div>
              )}
            </div>
          )}
        </div>

        {/* Discover (Link-like, not collapsible) */}
        <div className="border-b border-[#202225]">
          <button
            onClick={onDiscoverySelect}
            className={`
              w-full px-3 py-3 flex items-center gap-2 hover:bg-[#34373c] transition-colors
              ${discoveryMode ? 'bg-[#404449]' : ''}
            `}
          >
            <Compass className="w-4 h-4 text-[#00b0f4]" />
            <span className="text-sm text-[#00b0f4]">Discover Quests</span>
          </button>
        </div>

        {/* Notifications */}
        <div className="p-3">
          <div className="flex items-center gap-2 mb-2">
            <Bell className="w-4 h-4 text-[#faa61a]" />
            <span className="text-xs uppercase tracking-wide text-[#b9bbbe]">Notifications</span>
          </div>
          <div className="space-y-2">
            {notifications.slice(0, 5).map((notification) => (
              <button
                key={notification.notificationId}
                onClick={() => notification.questId && onNotificationClick(notification.questId)}
                className="w-full text-left p-2 rounded bg-[#202225] hover:bg-[#34373c] transition-colors"
              >
                <div className="flex items-start gap-2">
                  <div className={`
                    w-2 h-2 rounded-full shrink-0 mt-1
                    ${notification.type === 'milestone' ? 'bg-[#57F287]' : ''}
                    ${notification.type === 'quest_default' ? 'bg-[#ed4245]' : ''}
                    ${notification.type === 'comment' ? 'bg-[#faa61a]' : ''}
                  `} />
                  <div className="flex-1 min-w-0">
                    <p className="text-xs text-[#dcddde]">{notification.message}</p>
                    <span className="text-xs text-[#72767d]">
                      {new Date(notification.createdAt).toLocaleTimeString()}
                    </span>
                  </div>
                </div>
              </button>
            ))}
            {notifications.length === 0 && (
              <div className="px-2 py-3 text-xs text-[#72767d] text-center">
                No notifications
              </div>
            )}
          </div>
        </div>
      </div>
    </div>
  );
}

// Helper functions
function getIconForQuest(quest: Quest): string {
  if (quest.isDungeon) return '‚öîÔ∏è';
  if (quest.members && quest.members.length > 1) return 'üë•';
  return 'üìã';
}

function getColorForQuest(quest: Quest): string {
  const colors: Record<string, string> = {
    'Trivial': '#72767d',
    'Easy': '#57F287',
    'Medium': '#5865F2',
    'Hard': '#FEE75C',
    'Epic': '#EB459E'
  };
  return colors[quest.difficulty.userAssigned] || '#5865F2';
}

===== FILE: ./src\components\TaskList.tsx =====

import React from 'react';
import { useMemo, useState } from 'react';
import { GripVertical, Play, Check } from 'lucide-react';
import { Checkbox } from './ui/checkbox';
import type { Task } from '../App';

interface TaskListProps {
  tasks: Task[];
  onToggleTask: (taskId: string) => void;
  onReorderTasks: (startIndex: number, endIndex: number) => void;
  onStartFocus: (task: Task) => void;
}

export function TaskList({ tasks, onToggleTask, onReorderTasks, onStartFocus }: TaskListProps) {
  const [draggedIndex, setDraggedIndex] = useState<number | null>(null);
  const [dragOverIndex, setDragOverIndex] = useState<number | null>(null);

  const handleDragStart = (index: number) => {
    setDraggedIndex(index);
  };

  const handleDragOver = (e: React.DragEvent, index: number) => {
    e.preventDefault();
    setDragOverIndex(index);
  };

  const handleDrop = (e: React.DragEvent, dropIndex: number) => {
    e.preventDefault();
    if (draggedIndex !== null && draggedIndex !== dropIndex) {
      onReorderTasks(draggedIndex, dropIndex);
    }
    setDraggedIndex(null);
    setDragOverIndex(null);
  };

  const handleDragEnd = () => {
    setDraggedIndex(null);
    setDragOverIndex(null);
  };

  return (
    <div className="space-y-2">
      {tasks.map((task, index) => (
        <div
          key={task.id}
          draggable
          onDragStart={() => handleDragStart(index)}
          onDragOver={(e) => handleDragOver(e, index)}
          onDrop={(e) => handleDrop(e, index)}
          onDragEnd={handleDragEnd}
          className={`
            group bg-[#2f3136] rounded px-3 py-3 flex items-center gap-3 cursor-move
            hover:bg-[#34373c] transition-colors
            ${draggedIndex === index ? 'opacity-50' : ''}
            ${dragOverIndex === index && draggedIndex !== index ? 'border-t-2 border-[#5865F2]' : ''}
            ${task.completed ? 'opacity-60' : ''}
          `}
        >
          {/* Drag Handle */}
          <GripVertical className="w-4 h-4 text-[#4f545c] group-hover:text-[#72767d] shrink-0" />

          {/* Checkbox */}
          <Checkbox 
            checked={task.completed}
            onCheckedChange={() => onToggleTask(task.id)}
            className="border-[#4f545c] data-[state=checked]:bg-[#57F287] data-[state=checked]:border-[#57F287]"
          />

          {/* Task Content */}
          <div className="flex-1 min-w-0">
            <div className="flex items-center gap-2">
              <span className={`text-sm ${task.completed ? 'line-through text-[#72767d]' : 'text-[#dcddde]'}`}>
                {task.title}
              </span>
            </div>
            <div className="flex items-center gap-2 mt-1">
              <span 
                className="text-xs px-2 py-0.5 rounded"
                style={{ backgroundColor: `${task.questColor}20`, color: task.questColor }}
              >
                {task.questTag}
              </span>
              <span className="text-xs text-[#72767d]">Lvl {task.levelReq}</span>
            </div>
          </div>

          {/* Play Button */}
          {!task.completed && (
            <button
              onClick={(e) => {
                e.stopPropagation();
                onStartFocus(task);
              }}
              className="w-8 h-8 rounded-full bg-[#5865F2] hover:bg-[#4752C4] flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity shrink-0"
            >
              <Play className="w-4 h-4 text-white ml-0.5" fill="white" />
            </button>
          )}

          {task.completed && (
            <div className="w-8 h-8 rounded-full bg-[#57F287] flex items-center justify-center shrink-0">
              <Check className="w-4 h-4 text-white" />
            </div>
          )}
        </div>
      ))}
    </div>
  );
}



===== FILE: ./src\components\figma\ImageWithFallback.tsx =====

import React, { useState } from 'react'

const ERROR_IMG_SRC =
  'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODgiIGhlaWdodD0iODgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjMDAwIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBvcGFjaXR5PSIuMyIgZmlsbD0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIzLjciPjxyZWN0IHg9IjE2IiB5PSIxNiIgd2lkdGg9IjU2IiBoZWlnaHQ9IjU2IiByeD0iNiIvPjxwYXRoIGQ9Im0xNiA1OCAxNi0xOCAzMiAzMiIvPjxjaXJjbGUgY3g9IjUzIiBjeT0iMzUiIHI9IjciLz48L3N2Zz4KCg=='

export function ImageWithFallback(props: React.ImgHTMLAttributes<HTMLImageElement>) {
  const [didError, setDidError] = useState(false)

  const handleError = () => {
    setDidError(true)
  }

  const { src, alt, style, className, ...rest } = props

  return didError ? (
    <div
      className={`inline-block bg-gray-100 text-center align-middle ${className ?? ''}`}
      style={style}
    >
      <div className="flex items-center justify-center w-full h-full">
        <img src={ERROR_IMG_SRC} alt="Error loading image" {...rest} data-original-url={src} />
      </div>
    </div>
  ) : (
    <img src={src} alt={alt} className={className} style={style} {...rest} onError={handleError} />
  )
}


===== FILE: ./src\components\ui\accordion.tsx =====

"use client";

import * as React from "react";
import * as AccordionPrimitive from "@radix-ui/react-accordion@1.2.3";
import { ChevronDownIcon } from "lucide-react@0.487.0";

import { cn } from "./utils";

function Accordion({
  ...props
}: React.ComponentProps<typeof AccordionPrimitive.Root>) {
  return <AccordionPrimitive.Root data-slot="accordion" {...props} />;
}

function AccordionItem({
  className,
  ...props
}: React.ComponentProps<typeof AccordionPrimitive.Item>) {
  return (
    <AccordionPrimitive.Item
      data-slot="accordion-item"
      className={cn("border-b last:border-b-0", className)}
      {...props}
    />
  );
}

function AccordionTrigger({
  className,
  children,
  ...props
}: React.ComponentProps<typeof AccordionPrimitive.Trigger>) {
  return (
    <AccordionPrimitive.Header className="flex">
      <AccordionPrimitive.Trigger
        data-slot="accordion-trigger"
        className={cn(
          "focus-visible:border-ring focus-visible:ring-ring/50 flex flex-1 items-start justify-between gap-4 rounded-md py-4 text-left text-sm font-medium transition-all outline-none hover:underline focus-visible:ring-[3px] disabled:pointer-events-none disabled:opacity-50 [&[data-state=open]>svg]:rotate-180",
          className,
        )}
        {...props}
      >
        {children}
        <ChevronDownIcon className="text-muted-foreground pointer-events-none size-4 shrink-0 translate-y-0.5 transition-transform duration-200" />
      </AccordionPrimitive.Trigger>
    </AccordionPrimitive.Header>
  );
}

function AccordionContent({
  className,
  children,
  ...props
}: React.ComponentProps<typeof AccordionPrimitive.Content>) {
  return (
    <AccordionPrimitive.Content
      data-slot="accordion-content"
      className="data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down overflow-hidden text-sm"
      {...props}
    >
      <div className={cn("pt-0 pb-4", className)}>{children}</div>
    </AccordionPrimitive.Content>
  );
}

export { Accordion, AccordionItem, AccordionTrigger, AccordionContent };


===== FILE: ./src\components\ui\alert-dialog.tsx =====

"use client";

import * as React from "react";
import * as AlertDialogPrimitive from "@radix-ui/react-alert-dialog@1.1.6";

import { cn } from "./utils";
import { buttonVariants } from "./button";

function AlertDialog({
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Root>) {
  return <AlertDialogPrimitive.Root data-slot="alert-dialog" {...props} />;
}

function AlertDialogTrigger({
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Trigger>) {
  return (
    <AlertDialogPrimitive.Trigger data-slot="alert-dialog-trigger" {...props} />
  );
}

function AlertDialogPortal({
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Portal>) {
  return (
    <AlertDialogPrimitive.Portal data-slot="alert-dialog-portal" {...props} />
  );
}

function AlertDialogOverlay({
  className,
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Overlay>) {
  return (
    <AlertDialogPrimitive.Overlay
      data-slot="alert-dialog-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className,
      )}
      {...props}
    />
  );
}

function AlertDialogContent({
  className,
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Content>) {
  return (
    <AlertDialogPortal>
      <AlertDialogOverlay />
      <AlertDialogPrimitive.Content
        data-slot="alert-dialog-content"
        className={cn(
          "bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",
          className,
        )}
        {...props}
      />
    </AlertDialogPortal>
  );
}

function AlertDialogHeader({
  className,
  ...props
}: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="alert-dialog-header"
      className={cn("flex flex-col gap-2 text-center sm:text-left", className)}
      {...props}
    />
  );
}

function AlertDialogFooter({
  className,
  ...props
}: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="alert-dialog-footer"
      className={cn(
        "flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",
        className,
      )}
      {...props}
    />
  );
}

function AlertDialogTitle({
  className,
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Title>) {
  return (
    <AlertDialogPrimitive.Title
      data-slot="alert-dialog-title"
      className={cn("text-lg font-semibold", className)}
      {...props}
    />
  );
}

function AlertDialogDescription({
  className,
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Description>) {
  return (
    <AlertDialogPrimitive.Description
      data-slot="alert-dialog-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  );
}

function AlertDialogAction({
  className,
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Action>) {
  return (
    <AlertDialogPrimitive.Action
      className={cn(buttonVariants(), className)}
      {...props}
    />
  );
}

function AlertDialogCancel({
  className,
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Cancel>) {
  return (
    <AlertDialogPrimitive.Cancel
      className={cn(buttonVariants({ variant: "outline" }), className)}
      {...props}
    />
  );
}

export {
  AlertDialog,
  AlertDialogPortal,
  AlertDialogOverlay,
  AlertDialogTrigger,
  AlertDialogContent,
  AlertDialogHeader,
  AlertDialogFooter,
  AlertDialogTitle,
  AlertDialogDescription,
  AlertDialogAction,
  AlertDialogCancel,
};


===== FILE: ./src\components\ui\alert.tsx =====

import * as React from "react";
import { cva, type VariantProps } from "class-variance-authority@0.7.1";

import { cn } from "./utils";

const alertVariants = cva(
  "relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",
  {
    variants: {
      variant: {
        default: "bg-card text-card-foreground",
        destructive:
          "text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  },
);

function Alert({
  className,
  variant,
  ...props
}: React.ComponentProps<"div"> & VariantProps<typeof alertVariants>) {
  return (
    <div
      data-slot="alert"
      role="alert"
      className={cn(alertVariants({ variant }), className)}
      {...props}
    />
  );
}

function AlertTitle({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="alert-title"
      className={cn(
        "col-start-2 line-clamp-1 min-h-4 font-medium tracking-tight",
        className,
      )}
      {...props}
    />
  );
}

function AlertDescription({
  className,
  ...props
}: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="alert-description"
      className={cn(
        "text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",
        className,
      )}
      {...props}
    />
  );
}

export { Alert, AlertTitle, AlertDescription };


===== FILE: ./src\components\ui\aspect-ratio.tsx =====

"use client";

import * as AspectRatioPrimitive from "@radix-ui/react-aspect-ratio@1.1.2";

function AspectRatio({
  ...props
}: React.ComponentProps<typeof AspectRatioPrimitive.Root>) {
  return <AspectRatioPrimitive.Root data-slot="aspect-ratio" {...props} />;
}

export { AspectRatio };


===== FILE: ./src\components\ui\avatar.tsx =====

"use client";

import * as React from "react";
import * as AvatarPrimitive from "@radix-ui/react-avatar@1.1.3";

import { cn } from "./utils";

function Avatar({
  className,
  ...props
}: React.ComponentProps<typeof AvatarPrimitive.Root>) {
  return (
    <AvatarPrimitive.Root
      data-slot="avatar"
      className={cn(
        "relative flex size-10 shrink-0 overflow-hidden rounded-full",
        className,
      )}
      {...props}
    />
  );
}

function AvatarImage({
  className,
  ...props
}: React.ComponentProps<typeof AvatarPrimitive.Image>) {
  return (
    <AvatarPrimitive.Image
      data-slot="avatar-image"
      className={cn("aspect-square size-full", className)}
      {...props}
    />
  );
}

function AvatarFallback({
  className,
  ...props
}: React.ComponentProps<typeof AvatarPrimitive.Fallback>) {
  return (
    <AvatarPrimitive.Fallback
      data-slot="avatar-fallback"
      className={cn(
        "bg-muted flex size-full items-center justify-center rounded-full",
        className,
      )}
      {...props}
    />
  );
}

export { Avatar, AvatarImage, AvatarFallback };


===== FILE: ./src\components\ui\badge.tsx =====

import * as React from "react";
import { Slot } from "@radix-ui/react-slot@1.1.2";
import { cva, type VariantProps } from "class-variance-authority@0.7.1";

import { cn } from "./utils";

const badgeVariants = cva(
  "inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",
  {
    variants: {
      variant: {
        default:
          "border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",
        secondary:
          "border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",
        destructive:
          "border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",
        outline:
          "text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  },
);

function Badge({
  className,
  variant,
  asChild = false,
  ...props
}: React.ComponentProps<"span"> &
  VariantProps<typeof badgeVariants> & { asChild?: boolean }) {
  const Comp = asChild ? Slot : "span";

  return (
    <Comp
      data-slot="badge"
      className={cn(badgeVariants({ variant }), className)}
      {...props}
    />
  );
}

export { Badge, badgeVariants };


===== FILE: ./src\components\ui\breadcrumb.tsx =====

import * as React from "react";
import { Slot } from "@radix-ui/react-slot@1.1.2";
import { ChevronRight, MoreHorizontal } from "lucide-react@0.487.0";

import { cn } from "./utils";

function Breadcrumb({ ...props }: React.ComponentProps<"nav">) {
  return <nav aria-label="breadcrumb" data-slot="breadcrumb" {...props} />;
}

function BreadcrumbList({ className, ...props }: React.ComponentProps<"ol">) {
  return (
    <ol
      data-slot="breadcrumb-list"
      className={cn(
        "text-muted-foreground flex flex-wrap items-center gap-1.5 text-sm break-words sm:gap-2.5",
        className,
      )}
      {...props}
    />
  );
}

function BreadcrumbItem({ className, ...props }: React.ComponentProps<"li">) {
  return (
    <li
      data-slot="breadcrumb-item"
      className={cn("inline-flex items-center gap-1.5", className)}
      {...props}
    />
  );
}

function BreadcrumbLink({
  asChild,
  className,
  ...props
}: React.ComponentProps<"a"> & {
  asChild?: boolean;
}) {
  const Comp = asChild ? Slot : "a";

  return (
    <Comp
      data-slot="breadcrumb-link"
      className={cn("hover:text-foreground transition-colors", className)}
      {...props}
    />
  );
}

function BreadcrumbPage({ className, ...props }: React.ComponentProps<"span">) {
  return (
    <span
      data-slot="breadcrumb-page"
      role="link"
      aria-disabled="true"
      aria-current="page"
      className={cn("text-foreground font-normal", className)}
      {...props}
    />
  );
}

function BreadcrumbSeparator({
  children,
  className,
  ...props
}: React.ComponentProps<"li">) {
  return (
    <li
      data-slot="breadcrumb-separator"
      role="presentation"
      aria-hidden="true"
      className={cn("[&>svg]:size-3.5", className)}
      {...props}
    >
      {children ?? <ChevronRight />}
    </li>
  );
}

function BreadcrumbEllipsis({
  className,
  ...props
}: React.ComponentProps<"span">) {
  return (
    <span
      data-slot="breadcrumb-ellipsis"
      role="presentation"
      aria-hidden="true"
      className={cn("flex size-9 items-center justify-center", className)}
      {...props}
    >
      <MoreHorizontal className="size-4" />
      <span className="sr-only">More</span>
    </span>
  );
}

export {
  Breadcrumb,
  BreadcrumbList,
  BreadcrumbItem,
  BreadcrumbLink,
  BreadcrumbPage,
  BreadcrumbSeparator,
  BreadcrumbEllipsis,
};


===== FILE: ./src\components\ui\button.tsx =====

import * as React from "react";
import { Slot } from "@radix-ui/react-slot@1.1.2";
import { cva, type VariantProps } from "class-variance-authority@0.7.1";

import { cn } from "./utils";

const buttonVariants = cva(
  "inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",
  {
    variants: {
      variant: {
        default: "bg-primary text-primary-foreground hover:bg-primary/90",
        destructive:
          "bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",
        outline:
          "border bg-background text-foreground hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",
        secondary:
          "bg-secondary text-secondary-foreground hover:bg-secondary/80",
        ghost:
          "hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",
        link: "text-primary underline-offset-4 hover:underline",
      },
      size: {
        default: "h-9 px-4 py-2 has-[>svg]:px-3",
        sm: "h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",
        lg: "h-10 rounded-md px-6 has-[>svg]:px-4",
        icon: "size-9 rounded-md",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  },
);

function Button({
  className,
  variant,
  size,
  asChild = false,
  ...props
}: React.ComponentProps<"button"> &
  VariantProps<typeof buttonVariants> & {
    asChild?: boolean;
  }) {
  const Comp = asChild ? Slot : "button";

  return (
    <Comp
      data-slot="button"
      className={cn(buttonVariants({ variant, size, className }))}
      {...props}
    />
  );
}

export { Button, buttonVariants };


===== FILE: ./src\components\ui\calendar.tsx =====

"use client";

import * as React from "react";
import { ChevronLeft, ChevronRight } from "lucide-react@0.487.0";
import { DayPicker } from "react-day-picker@8.10.1";

import { cn } from "./utils";
import { buttonVariants } from "./button";

function Calendar({
  className,
  classNames,
  showOutsideDays = true,
  ...props
}: React.ComponentProps<typeof DayPicker>) {
  return (
    <DayPicker
      showOutsideDays={showOutsideDays}
      className={cn("p-3", className)}
      classNames={{
        months: "flex flex-col sm:flex-row gap-2",
        month: "flex flex-col gap-4",
        caption: "flex justify-center pt-1 relative items-center w-full",
        caption_label: "text-sm font-medium",
        nav: "flex items-center gap-1",
        nav_button: cn(
          buttonVariants({ variant: "outline" }),
          "size-7 bg-transparent p-0 opacity-50 hover:opacity-100",
        ),
        nav_button_previous: "absolute left-1",
        nav_button_next: "absolute right-1",
        table: "w-full border-collapse space-x-1",
        head_row: "flex",
        head_cell:
          "text-muted-foreground rounded-md w-8 font-normal text-[0.8rem]",
        row: "flex w-full mt-2",
        cell: cn(
          "relative p-0 text-center text-sm focus-within:relative focus-within:z-20 [&:has([aria-selected])]:bg-accent [&:has([aria-selected].day-range-end)]:rounded-r-md",
          props.mode === "range"
            ? "[&:has(>.day-range-end)]:rounded-r-md [&:has(>.day-range-start)]:rounded-l-md first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md"
            : "[&:has([aria-selected])]:rounded-md",
        ),
        day: cn(
          buttonVariants({ variant: "ghost" }),
          "size-8 p-0 font-normal aria-selected:opacity-100",
        ),
        day_range_start:
          "day-range-start aria-selected:bg-primary aria-selected:text-primary-foreground",
        day_range_end:
          "day-range-end aria-selected:bg-primary aria-selected:text-primary-foreground",
        day_selected:
          "bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",
        day_today: "bg-accent text-accent-foreground",
        day_outside:
          "day-outside text-muted-foreground aria-selected:text-muted-foreground",
        day_disabled: "text-muted-foreground opacity-50",
        day_range_middle:
          "aria-selected:bg-accent aria-selected:text-accent-foreground",
        day_hidden: "invisible",
        ...classNames,
      }}
      components={{
        IconLeft: ({ className, ...props }) => (
          <ChevronLeft className={cn("size-4", className)} {...props} />
        ),
        IconRight: ({ className, ...props }) => (
          <ChevronRight className={cn("size-4", className)} {...props} />
        ),
      }}
      {...props}
    />
  );
}

export { Calendar };


===== FILE: ./src\components\ui\card.tsx =====

import * as React from "react";

import { cn } from "./utils";

function Card({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card"
      className={cn(
        "bg-card text-card-foreground flex flex-col gap-6 rounded-xl border",
        className,
      )}
      {...props}
    />
  );
}

function CardHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-header"
      className={cn(
        "@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 pt-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",
        className,
      )}
      {...props}
    />
  );
}

function CardTitle({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <h4
      data-slot="card-title"
      className={cn("leading-none", className)}
      {...props}
    />
  );
}

function CardDescription({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <p
      data-slot="card-description"
      className={cn("text-muted-foreground", className)}
      {...props}
    />
  );
}

function CardAction({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-action"
      className={cn(
        "col-start-2 row-span-2 row-start-1 self-start justify-self-end",
        className,
      )}
      {...props}
    />
  );
}

function CardContent({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-content"
      className={cn("px-6 [&:last-child]:pb-6", className)}
      {...props}
    />
  );
}

function CardFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-footer"
      className={cn("flex items-center px-6 pb-6 [.border-t]:pt-6", className)}
      {...props}
    />
  );
}

export {
  Card,
  CardHeader,
  CardFooter,
  CardTitle,
  CardAction,
  CardDescription,
  CardContent,
};


===== FILE: ./src\components\ui\carousel.tsx =====

"use client";

import * as React from "react";
import useEmblaCarousel, {
  type UseEmblaCarouselType,
} from "embla-carousel-react@8.6.0";
import { ArrowLeft, ArrowRight } from "lucide-react@0.487.0";

import { cn } from "./utils";
import { Button } from "./button";

type CarouselApi = UseEmblaCarouselType[1];
type UseCarouselParameters = Parameters<typeof useEmblaCarousel>;
type CarouselOptions = UseCarouselParameters[0];
type CarouselPlugin = UseCarouselParameters[1];

type CarouselProps = {
  opts?: CarouselOptions;
  plugins?: CarouselPlugin;
  orientation?: "horizontal" | "vertical";
  setApi?: (api: CarouselApi) => void;
};

type CarouselContextProps = {
  carouselRef: ReturnType<typeof useEmblaCarousel>[0];
  api: ReturnType<typeof useEmblaCarousel>[1];
  scrollPrev: () => void;
  scrollNext: () => void;
  canScrollPrev: boolean;
  canScrollNext: boolean;
} & CarouselProps;

const CarouselContext = React.createContext<CarouselContextProps | null>(null);

function useCarousel() {
  const context = React.useContext(CarouselContext);

  if (!context) {
    throw new Error("useCarousel must be used within a <Carousel />");
  }

  return context;
}

function Carousel({
  orientation = "horizontal",
  opts,
  setApi,
  plugins,
  className,
  children,
  ...props
}: React.ComponentProps<"div"> & CarouselProps) {
  const [carouselRef, api] = useEmblaCarousel(
    {
      ...opts,
      axis: orientation === "horizontal" ? "x" : "y",
    },
    plugins,
  );
  const [canScrollPrev, setCanScrollPrev] = React.useState(false);
  const [canScrollNext, setCanScrollNext] = React.useState(false);

  const onSelect = React.useCallback((api: CarouselApi) => {
    if (!api) return;
    setCanScrollPrev(api.canScrollPrev());
    setCanScrollNext(api.canScrollNext());
  }, []);

  const scrollPrev = React.useCallback(() => {
    api?.scrollPrev();
  }, [api]);

  const scrollNext = React.useCallback(() => {
    api?.scrollNext();
  }, [api]);

  const handleKeyDown = React.useCallback(
    (event: React.KeyboardEvent<HTMLDivElement>) => {
      if (event.key === "ArrowLeft") {
        event.preventDefault();
        scrollPrev();
      } else if (event.key === "ArrowRight") {
        event.preventDefault();
        scrollNext();
      }
    },
    [scrollPrev, scrollNext],
  );

  React.useEffect(() => {
    if (!api || !setApi) return;
    setApi(api);
  }, [api, setApi]);

  React.useEffect(() => {
    if (!api) return;
    onSelect(api);
    api.on("reInit", onSelect);
    api.on("select", onSelect);

    return () => {
      api?.off("select", onSelect);
    };
  }, [api, onSelect]);

  return (
    <CarouselContext.Provider
      value={{
        carouselRef,
        api: api,
        opts,
        orientation:
          orientation || (opts?.axis === "y" ? "vertical" : "horizontal"),
        scrollPrev,
        scrollNext,
        canScrollPrev,
        canScrollNext,
      }}
    >
      <div
        onKeyDownCapture={handleKeyDown}
        className={cn("relative", className)}
        role="region"
        aria-roledescription="carousel"
        data-slot="carousel"
        {...props}
      >
        {children}
      </div>
    </CarouselContext.Provider>
  );
}

function CarouselContent({ className, ...props }: React.ComponentProps<"div">) {
  const { carouselRef, orientation } = useCarousel();

  return (
    <div
      ref={carouselRef}
      className="overflow-hidden"
      data-slot="carousel-content"
    >
      <div
        className={cn(
          "flex",
          orientation === "horizontal" ? "-ml-4" : "-mt-4 flex-col",
          className,
        )}
        {...props}
      />
    </div>
  );
}

function CarouselItem({ className, ...props }: React.ComponentProps<"div">) {
  const { orientation } = useCarousel();

  return (
    <div
      role="group"
      aria-roledescription="slide"
      data-slot="carousel-item"
      className={cn(
        "min-w-0 shrink-0 grow-0 basis-full",
        orientation === "horizontal" ? "pl-4" : "pt-4",
        className,
      )}
      {...props}
    />
  );
}

function CarouselPrevious({
  className,
  variant = "outline",
  size = "icon",
  ...props
}: React.ComponentProps<typeof Button>) {
  const { orientation, scrollPrev, canScrollPrev } = useCarousel();

  return (
    <Button
      data-slot="carousel-previous"
      variant={variant}
      size={size}
      className={cn(
        "absolute size-8 rounded-full",
        orientation === "horizontal"
          ? "top-1/2 -left-12 -translate-y-1/2"
          : "-top-12 left-1/2 -translate-x-1/2 rotate-90",
        className,
      )}
      disabled={!canScrollPrev}
      onClick={scrollPrev}
      {...props}
    >
      <ArrowLeft />
      <span className="sr-only">Previous slide</span>
    </Button>
  );
}

function CarouselNext({
  className,
  variant = "outline",
  size = "icon",
  ...props
}: React.ComponentProps<typeof Button>) {
  const { orientation, scrollNext, canScrollNext } = useCarousel();

  return (
    <Button
      data-slot="carousel-next"
      variant={variant}
      size={size}
      className={cn(
        "absolute size-8 rounded-full",
        orientation === "horizontal"
          ? "top-1/2 -right-12 -translate-y-1/2"
          : "-bottom-12 left-1/2 -translate-x-1/2 rotate-90",
        className,
      )}
      disabled={!canScrollNext}
      onClick={scrollNext}
      {...props}
    >
      <ArrowRight />
      <span className="sr-only">Next slide</span>
    </Button>
  );
}

export {
  type CarouselApi,
  Carousel,
  CarouselContent,
  CarouselItem,
  CarouselPrevious,
  CarouselNext,
};


===== FILE: ./src\components\ui\chart.tsx =====

"use client";

import * as React from "react";
import * as RechartsPrimitive from "recharts@2.15.2";

import { cn } from "./utils";

// Format: { THEME_NAME: CSS_SELECTOR }
const THEMES = { light: "", dark: ".dark" } as const;

export type ChartConfig = {
  [k in string]: {
    label?: React.ReactNode;
    icon?: React.ComponentType;
  } & (
    | { color?: string; theme?: never }
    | { color?: never; theme: Record<keyof typeof THEMES, string> }
  );
};

type ChartContextProps = {
  config: ChartConfig;
};

const ChartContext = React.createContext<ChartContextProps | null>(null);

function useChart() {
  const context = React.useContext(ChartContext);

  if (!context) {
    throw new Error("useChart must be used within a <ChartContainer />");
  }

  return context;
}

function ChartContainer({
  id,
  className,
  children,
  config,
  ...props
}: React.ComponentProps<"div"> & {
  config: ChartConfig;
  children: React.ComponentProps<
    typeof RechartsPrimitive.ResponsiveContainer
  >["children"];
}) {
  const uniqueId = React.useId();
  const chartId = `chart-${id || uniqueId.replace(/:/g, "")}`;

  return (
    <ChartContext.Provider value={{ config }}>
      <div
        data-slot="chart"
        data-chart={chartId}
        className={cn(
          "[&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border flex aspect-video justify-center text-xs [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-hidden [&_.recharts-sector]:outline-hidden [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-surface]:outline-hidden",
          className,
        )}
        {...props}
      >
        <ChartStyle id={chartId} config={config} />
        <RechartsPrimitive.ResponsiveContainer>
          {children}
        </RechartsPrimitive.ResponsiveContainer>
      </div>
    </ChartContext.Provider>
  );
}

const ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {
  const colorConfig = Object.entries(config).filter(
    ([, config]) => config.theme || config.color,
  );

  if (!colorConfig.length) {
    return null;
  }

  return (
    <style
      dangerouslySetInnerHTML={{
        __html: Object.entries(THEMES)
          .map(
            ([theme, prefix]) => `
${prefix} [data-chart=${id}] {
${colorConfig
  .map(([key, itemConfig]) => {
    const color =
      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||
      itemConfig.color;
    return color ? `  --color-${key}: ${color};` : null;
  })
  .join("\n")}
}
`,
          )
          .join("\n"),
      }}
    />
  );
};

const ChartTooltip = RechartsPrimitive.Tooltip;

function ChartTooltipContent({
  active,
  payload,
  className,
  indicator = "dot",
  hideLabel = false,
  hideIndicator = false,
  label,
  labelFormatter,
  labelClassName,
  formatter,
  color,
  nameKey,
  labelKey,
}: React.ComponentProps<typeof RechartsPrimitive.Tooltip> &
  React.ComponentProps<"div"> & {
    hideLabel?: boolean;
    hideIndicator?: boolean;
    indicator?: "line" | "dot" | "dashed";
    nameKey?: string;
    labelKey?: string;
  }) {
  const { config } = useChart();

  const tooltipLabel = React.useMemo(() => {
    if (hideLabel || !payload?.length) {
      return null;
    }

    const [item] = payload;
    const key = `${labelKey || item?.dataKey || item?.name || "value"}`;
    const itemConfig = getPayloadConfigFromPayload(config, item, key);
    const value =
      !labelKey && typeof label === "string"
        ? config[label as keyof typeof config]?.label || label
        : itemConfig?.label;

    if (labelFormatter) {
      return (
        <div className={cn("font-medium", labelClassName)}>
          {labelFormatter(value, payload)}
        </div>
      );
    }

    if (!value) {
      return null;
    }

    return <div className={cn("font-medium", labelClassName)}>{value}</div>;
  }, [
    label,
    labelFormatter,
    payload,
    hideLabel,
    labelClassName,
    config,
    labelKey,
  ]);

  if (!active || !payload?.length) {
    return null;
  }

  const nestLabel = payload.length === 1 && indicator !== "dot";

  return (
    <div
      className={cn(
        "border-border/50 bg-background grid min-w-[8rem] items-start gap-1.5 rounded-lg border px-2.5 py-1.5 text-xs shadow-xl",
        className,
      )}
    >
      {!nestLabel ? tooltipLabel : null}
      <div className="grid gap-1.5">
        {payload.map((item, index) => {
          const key = `${nameKey || item.name || item.dataKey || "value"}`;
          const itemConfig = getPayloadConfigFromPayload(config, item, key);
          const indicatorColor = color || item.payload.fill || item.color;

          return (
            <div
              key={item.dataKey}
              className={cn(
                "[&>svg]:text-muted-foreground flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5",
                indicator === "dot" && "items-center",
              )}
            >
              {formatter && item?.value !== undefined && item.name ? (
                formatter(item.value, item.name, item, index, item.payload)
              ) : (
                <>
                  {itemConfig?.icon ? (
                    <itemConfig.icon />
                  ) : (
                    !hideIndicator && (
                      <div
                        className={cn(
                          "shrink-0 rounded-[2px] border-(--color-border) bg-(--color-bg)",
                          {
                            "h-2.5 w-2.5": indicator === "dot",
                            "w-1": indicator === "line",
                            "w-0 border-[1.5px] border-dashed bg-transparent":
                              indicator === "dashed",
                            "my-0.5": nestLabel && indicator === "dashed",
                          },
                        )}
                        style={
                          {
                            "--color-bg": indicatorColor,
                            "--color-border": indicatorColor,
                          } as React.CSSProperties
                        }
                      />
                    )
                  )}
                  <div
                    className={cn(
                      "flex flex-1 justify-between leading-none",
                      nestLabel ? "items-end" : "items-center",
                    )}
                  >
                    <div className="grid gap-1.5">
                      {nestLabel ? tooltipLabel : null}
                      <span className="text-muted-foreground">
                        {itemConfig?.label || item.name}
                      </span>
                    </div>
                    {item.value && (
                      <span className="text-foreground font-mono font-medium tabular-nums">
                        {item.value.toLocaleString()}
                      </span>
                    )}
                  </div>
                </>
              )}
            </div>
          );
        })}
      </div>
    </div>
  );
}

const ChartLegend = RechartsPrimitive.Legend;

function ChartLegendContent({
  className,
  hideIcon = false,
  payload,
  verticalAlign = "bottom",
  nameKey,
}: React.ComponentProps<"div"> &
  Pick<RechartsPrimitive.LegendProps, "payload" | "verticalAlign"> & {
    hideIcon?: boolean;
    nameKey?: string;
  }) {
  const { config } = useChart();

  if (!payload?.length) {
    return null;
  }

  return (
    <div
      className={cn(
        "flex items-center justify-center gap-4",
        verticalAlign === "top" ? "pb-3" : "pt-3",
        className,
      )}
    >
      {payload.map((item) => {
        const key = `${nameKey || item.dataKey || "value"}`;
        const itemConfig = getPayloadConfigFromPayload(config, item, key);

        return (
          <div
            key={item.value}
            className={cn(
              "[&>svg]:text-muted-foreground flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3",
            )}
          >
            {itemConfig?.icon && !hideIcon ? (
              <itemConfig.icon />
            ) : (
              <div
                className="h-2 w-2 shrink-0 rounded-[2px]"
                style={{
                  backgroundColor: item.color,
                }}
              />
            )}
            {itemConfig?.label}
          </div>
        );
      })}
    </div>
  );
}

// Helper to extract item config from a payload.
function getPayloadConfigFromPayload(
  config: ChartConfig,
  payload: unknown,
  key: string,
) {
  if (typeof payload !== "object" || payload === null) {
    return undefined;
  }

  const payloadPayload =
    "payload" in payload &&
    typeof payload.payload === "object" &&
    payload.payload !== null
      ? payload.payload
      : undefined;

  let configLabelKey: string = key;

  if (
    key in payload &&
    typeof payload[key as keyof typeof payload] === "string"
  ) {
    configLabelKey = payload[key as keyof typeof payload] as string;
  } else if (
    payloadPayload &&
    key in payloadPayload &&
    typeof payloadPayload[key as keyof typeof payloadPayload] === "string"
  ) {
    configLabelKey = payloadPayload[
      key as keyof typeof payloadPayload
    ] as string;
  }

  return configLabelKey in config
    ? config[configLabelKey]
    : config[key as keyof typeof config];
}

export {
  ChartContainer,
  ChartTooltip,
  ChartTooltipContent,
  ChartLegend,
  ChartLegendContent,
  ChartStyle,
};


===== FILE: ./src\components\ui\checkbox.tsx =====

"use client";

import * as React from "react";
import * as CheckboxPrimitive from "@radix-ui/react-checkbox@1.1.4";
import { CheckIcon } from "lucide-react@0.487.0";

import { cn } from "./utils";

function Checkbox({
  className,
  ...props
}: React.ComponentProps<typeof CheckboxPrimitive.Root>) {
  return (
    <CheckboxPrimitive.Root
      data-slot="checkbox"
      className={cn(
        "peer border bg-input-background dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",
        className,
      )}
      {...props}
    >
      <CheckboxPrimitive.Indicator
        data-slot="checkbox-indicator"
        className="flex items-center justify-center text-current transition-none"
      >
        <CheckIcon className="size-3.5" />
      </CheckboxPrimitive.Indicator>
    </CheckboxPrimitive.Root>
  );
}

export { Checkbox };


===== FILE: ./src\components\ui\collapsible.tsx =====

"use client";

import * as CollapsiblePrimitive from "@radix-ui/react-collapsible@1.1.3";

function Collapsible({
  ...props
}: React.ComponentProps<typeof CollapsiblePrimitive.Root>) {
  return <CollapsiblePrimitive.Root data-slot="collapsible" {...props} />;
}

function CollapsibleTrigger({
  ...props
}: React.ComponentProps<typeof CollapsiblePrimitive.CollapsibleTrigger>) {
  return (
    <CollapsiblePrimitive.CollapsibleTrigger
      data-slot="collapsible-trigger"
      {...props}
    />
  );
}

function CollapsibleContent({
  ...props
}: React.ComponentProps<typeof CollapsiblePrimitive.CollapsibleContent>) {
  return (
    <CollapsiblePrimitive.CollapsibleContent
      data-slot="collapsible-content"
      {...props}
    />
  );
}

export { Collapsible, CollapsibleTrigger, CollapsibleContent };


===== FILE: ./src\components\ui\command.tsx =====

"use client";

import * as React from "react";
import { Command as CommandPrimitive } from "cmdk@1.1.1";
import { SearchIcon } from "lucide-react@0.487.0";

import { cn } from "./utils";
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogHeader,
  DialogTitle,
} from "./dialog";

function Command({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive>) {
  return (
    <CommandPrimitive
      data-slot="command"
      className={cn(
        "bg-popover text-popover-foreground flex h-full w-full flex-col overflow-hidden rounded-md",
        className,
      )}
      {...props}
    />
  );
}

function CommandDialog({
  title = "Command Palette",
  description = "Search for a command to run...",
  children,
  ...props
}: React.ComponentProps<typeof Dialog> & {
  title?: string;
  description?: string;
}) {
  return (
    <Dialog {...props}>
      <DialogHeader className="sr-only">
        <DialogTitle>{title}</DialogTitle>
        <DialogDescription>{description}</DialogDescription>
      </DialogHeader>
      <DialogContent className="overflow-hidden p-0">
        <Command className="[&_[cmdk-group-heading]]:text-muted-foreground **:data-[slot=command-input-wrapper]:h-12 [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group]]:px-2 [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5">
          {children}
        </Command>
      </DialogContent>
    </Dialog>
  );
}

function CommandInput({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive.Input>) {
  return (
    <div
      data-slot="command-input-wrapper"
      className="flex h-9 items-center gap-2 border-b px-3"
    >
      <SearchIcon className="size-4 shrink-0 opacity-50" />
      <CommandPrimitive.Input
        data-slot="command-input"
        className={cn(
          "placeholder:text-muted-foreground flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-hidden disabled:cursor-not-allowed disabled:opacity-50",
          className,
        )}
        {...props}
      />
    </div>
  );
}

function CommandList({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive.List>) {
  return (
    <CommandPrimitive.List
      data-slot="command-list"
      className={cn(
        "max-h-[300px] scroll-py-1 overflow-x-hidden overflow-y-auto",
        className,
      )}
      {...props}
    />
  );
}

function CommandEmpty({
  ...props
}: React.ComponentProps<typeof CommandPrimitive.Empty>) {
  return (
    <CommandPrimitive.Empty
      data-slot="command-empty"
      className="py-6 text-center text-sm"
      {...props}
    />
  );
}

function CommandGroup({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive.Group>) {
  return (
    <CommandPrimitive.Group
      data-slot="command-group"
      className={cn(
        "text-foreground [&_[cmdk-group-heading]]:text-muted-foreground overflow-hidden p-1 [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium",
        className,
      )}
      {...props}
    />
  );
}

function CommandSeparator({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive.Separator>) {
  return (
    <CommandPrimitive.Separator
      data-slot="command-separator"
      className={cn("bg-border -mx-1 h-px", className)}
      {...props}
    />
  );
}

function CommandItem({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive.Item>) {
  return (
    <CommandPrimitive.Item
      data-slot="command-item"
      className={cn(
        "data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled=true]:pointer-events-none data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    />
  );
}

function CommandShortcut({
  className,
  ...props
}: React.ComponentProps<"span">) {
  return (
    <span
      data-slot="command-shortcut"
      className={cn(
        "text-muted-foreground ml-auto text-xs tracking-widest",
        className,
      )}
      {...props}
    />
  );
}

export {
  Command,
  CommandDialog,
  CommandInput,
  CommandList,
  CommandEmpty,
  CommandGroup,
  CommandItem,
  CommandShortcut,
  CommandSeparator,
};


===== FILE: ./src\components\ui\context-menu.tsx =====

"use client";

import * as React from "react";
import * as ContextMenuPrimitive from "@radix-ui/react-context-menu@2.2.6";
import { CheckIcon, ChevronRightIcon, CircleIcon } from "lucide-react@0.487.0";

import { cn } from "./utils";

function ContextMenu({
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Root>) {
  return <ContextMenuPrimitive.Root data-slot="context-menu" {...props} />;
}

function ContextMenuTrigger({
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Trigger>) {
  return (
    <ContextMenuPrimitive.Trigger data-slot="context-menu-trigger" {...props} />
  );
}

function ContextMenuGroup({
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Group>) {
  return (
    <ContextMenuPrimitive.Group data-slot="context-menu-group" {...props} />
  );
}

function ContextMenuPortal({
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Portal>) {
  return (
    <ContextMenuPrimitive.Portal data-slot="context-menu-portal" {...props} />
  );
}

function ContextMenuSub({
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Sub>) {
  return <ContextMenuPrimitive.Sub data-slot="context-menu-sub" {...props} />;
}

function ContextMenuRadioGroup({
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.RadioGroup>) {
  return (
    <ContextMenuPrimitive.RadioGroup
      data-slot="context-menu-radio-group"
      {...props}
    />
  );
}

function ContextMenuSubTrigger({
  className,
  inset,
  children,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.SubTrigger> & {
  inset?: boolean;
}) {
  return (
    <ContextMenuPrimitive.SubTrigger
      data-slot="context-menu-sub-trigger"
      data-inset={inset}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground flex cursor-default items-center rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    >
      {children}
      <ChevronRightIcon className="ml-auto" />
    </ContextMenuPrimitive.SubTrigger>
  );
}

function ContextMenuSubContent({
  className,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.SubContent>) {
  return (
    <ContextMenuPrimitive.SubContent
      data-slot="context-menu-sub-content"
      className={cn(
        "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 min-w-[8rem] origin-(--radix-context-menu-content-transform-origin) overflow-hidden rounded-md border p-1 shadow-lg",
        className,
      )}
      {...props}
    />
  );
}

function ContextMenuContent({
  className,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Content>) {
  return (
    <ContextMenuPrimitive.Portal>
      <ContextMenuPrimitive.Content
        data-slot="context-menu-content"
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-context-menu-content-available-height) min-w-[8rem] origin-(--radix-context-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",
          className,
        )}
        {...props}
      />
    </ContextMenuPrimitive.Portal>
  );
}

function ContextMenuItem({
  className,
  inset,
  variant = "default",
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Item> & {
  inset?: boolean;
  variant?: "default" | "destructive";
}) {
  return (
    <ContextMenuPrimitive.Item
      data-slot="context-menu-item"
      data-inset={inset}
      data-variant={variant}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    />
  );
}

function ContextMenuCheckboxItem({
  className,
  children,
  checked,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.CheckboxItem>) {
  return (
    <ContextMenuPrimitive.CheckboxItem
      data-slot="context-menu-checkbox-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-sm py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      checked={checked}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <ContextMenuPrimitive.ItemIndicator>
          <CheckIcon className="size-4" />
        </ContextMenuPrimitive.ItemIndicator>
      </span>
      {children}
    </ContextMenuPrimitive.CheckboxItem>
  );
}

function ContextMenuRadioItem({
  className,
  children,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.RadioItem>) {
  return (
    <ContextMenuPrimitive.RadioItem
      data-slot="context-menu-radio-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-sm py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <ContextMenuPrimitive.ItemIndicator>
          <CircleIcon className="size-2 fill-current" />
        </ContextMenuPrimitive.ItemIndicator>
      </span>
      {children}
    </ContextMenuPrimitive.RadioItem>
  );
}

function ContextMenuLabel({
  className,
  inset,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Label> & {
  inset?: boolean;
}) {
  return (
    <ContextMenuPrimitive.Label
      data-slot="context-menu-label"
      data-inset={inset}
      className={cn(
        "text-foreground px-2 py-1.5 text-sm font-medium data-[inset]:pl-8",
        className,
      )}
      {...props}
    />
  );
}

function ContextMenuSeparator({
  className,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Separator>) {
  return (
    <ContextMenuPrimitive.Separator
      data-slot="context-menu-separator"
      className={cn("bg-border -mx-1 my-1 h-px", className)}
      {...props}
    />
  );
}

function ContextMenuShortcut({
  className,
  ...props
}: React.ComponentProps<"span">) {
  return (
    <span
      data-slot="context-menu-shortcut"
      className={cn(
        "text-muted-foreground ml-auto text-xs tracking-widest",
        className,
      )}
      {...props}
    />
  );
}

export {
  ContextMenu,
  ContextMenuTrigger,
  ContextMenuContent,
  ContextMenuItem,
  ContextMenuCheckboxItem,
  ContextMenuRadioItem,
  ContextMenuLabel,
  ContextMenuSeparator,
  ContextMenuShortcut,
  ContextMenuGroup,
  ContextMenuPortal,
  ContextMenuSub,
  ContextMenuSubContent,
  ContextMenuSubTrigger,
  ContextMenuRadioGroup,
};


===== FILE: ./src\components\ui\dialog.tsx =====

"use client";

import * as React from "react";
import * as DialogPrimitive from "@radix-ui/react-dialog@1.1.6";
import { XIcon } from "lucide-react@0.487.0";

import { cn } from "./utils";

function Dialog({
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Root>) {
  return <DialogPrimitive.Root data-slot="dialog" {...props} />;
}

function DialogTrigger({
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Trigger>) {
  return <DialogPrimitive.Trigger data-slot="dialog-trigger" {...props} />;
}

function DialogPortal({
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Portal>) {
  return <DialogPrimitive.Portal data-slot="dialog-portal" {...props} />;
}

function DialogClose({
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Close>) {
  return <DialogPrimitive.Close data-slot="dialog-close" {...props} />;
}

function DialogOverlay({
  className,
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Overlay>) {
  return (
    <DialogPrimitive.Overlay
      data-slot="dialog-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className,
      )}
      {...props}
    />
  );
}

function DialogContent({
  className,
  children,
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Content>) {
  return (
    <DialogPortal data-slot="dialog-portal">
      <DialogOverlay />
      <DialogPrimitive.Content
        data-slot="dialog-content"
        className={cn(
          "bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",
          className,
        )}
        {...props}
      >
        {children}
        <DialogPrimitive.Close className="ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4">
          <XIcon />
          <span className="sr-only">Close</span>
        </DialogPrimitive.Close>
      </DialogPrimitive.Content>
    </DialogPortal>
  );
}

function DialogHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-header"
      className={cn("flex flex-col gap-2 text-center sm:text-left", className)}
      {...props}
    />
  );
}

function DialogFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-footer"
      className={cn(
        "flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",
        className,
      )}
      {...props}
    />
  );
}

function DialogTitle({
  className,
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Title>) {
  return (
    <DialogPrimitive.Title
      data-slot="dialog-title"
      className={cn("text-lg leading-none font-semibold", className)}
      {...props}
    />
  );
}

function DialogDescription({
  className,
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Description>) {
  return (
    <DialogPrimitive.Description
      data-slot="dialog-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  );
}

export {
  Dialog,
  DialogClose,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogOverlay,
  DialogPortal,
  DialogTitle,
  DialogTrigger,
};


===== FILE: ./src\components\ui\drawer.tsx =====

"use client";

import * as React from "react";
import { Drawer as DrawerPrimitive } from "vaul@1.1.2";

import { cn } from "./utils";

function Drawer({
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Root>) {
  return <DrawerPrimitive.Root data-slot="drawer" {...props} />;
}

function DrawerTrigger({
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Trigger>) {
  return <DrawerPrimitive.Trigger data-slot="drawer-trigger" {...props} />;
}

function DrawerPortal({
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Portal>) {
  return <DrawerPrimitive.Portal data-slot="drawer-portal" {...props} />;
}

function DrawerClose({
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Close>) {
  return <DrawerPrimitive.Close data-slot="drawer-close" {...props} />;
}

function DrawerOverlay({
  className,
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Overlay>) {
  return (
    <DrawerPrimitive.Overlay
      data-slot="drawer-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className,
      )}
      {...props}
    />
  );
}

function DrawerContent({
  className,
  children,
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Content>) {
  return (
    <DrawerPortal data-slot="drawer-portal">
      <DrawerOverlay />
      <DrawerPrimitive.Content
        data-slot="drawer-content"
        className={cn(
          "group/drawer-content bg-background fixed z-50 flex h-auto flex-col",
          "data-[vaul-drawer-direction=top]:inset-x-0 data-[vaul-drawer-direction=top]:top-0 data-[vaul-drawer-direction=top]:mb-24 data-[vaul-drawer-direction=top]:max-h-[80vh] data-[vaul-drawer-direction=top]:rounded-b-lg data-[vaul-drawer-direction=top]:border-b",
          "data-[vaul-drawer-direction=bottom]:inset-x-0 data-[vaul-drawer-direction=bottom]:bottom-0 data-[vaul-drawer-direction=bottom]:mt-24 data-[vaul-drawer-direction=bottom]:max-h-[80vh] data-[vaul-drawer-direction=bottom]:rounded-t-lg data-[vaul-drawer-direction=bottom]:border-t",
          "data-[vaul-drawer-direction=right]:inset-y-0 data-[vaul-drawer-direction=right]:right-0 data-[vaul-drawer-direction=right]:w-3/4 data-[vaul-drawer-direction=right]:border-l data-[vaul-drawer-direction=right]:sm:max-w-sm",
          "data-[vaul-drawer-direction=left]:inset-y-0 data-[vaul-drawer-direction=left]:left-0 data-[vaul-drawer-direction=left]:w-3/4 data-[vaul-drawer-direction=left]:border-r data-[vaul-drawer-direction=left]:sm:max-w-sm",
          className,
        )}
        {...props}
      >
        <div className="bg-muted mx-auto mt-4 hidden h-2 w-[100px] shrink-0 rounded-full group-data-[vaul-drawer-direction=bottom]/drawer-content:block" />
        {children}
      </DrawerPrimitive.Content>
    </DrawerPortal>
  );
}

function DrawerHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="drawer-header"
      className={cn("flex flex-col gap-1.5 p-4", className)}
      {...props}
    />
  );
}

function DrawerFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="drawer-footer"
      className={cn("mt-auto flex flex-col gap-2 p-4", className)}
      {...props}
    />
  );
}

function DrawerTitle({
  className,
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Title>) {
  return (
    <DrawerPrimitive.Title
      data-slot="drawer-title"
      className={cn("text-foreground font-semibold", className)}
      {...props}
    />
  );
}

function DrawerDescription({
  className,
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Description>) {
  return (
    <DrawerPrimitive.Description
      data-slot="drawer-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  );
}

export {
  Drawer,
  DrawerPortal,
  DrawerOverlay,
  DrawerTrigger,
  DrawerClose,
  DrawerContent,
  DrawerHeader,
  DrawerFooter,
  DrawerTitle,
  DrawerDescription,
};


===== FILE: ./src\components\ui\dropdown-menu.tsx =====

"use client";

import * as React from "react";
import * as DropdownMenuPrimitive from "@radix-ui/react-dropdown-menu@2.1.6";
import { CheckIcon, ChevronRightIcon, CircleIcon } from "lucide-react@0.487.0";

import { cn } from "./utils";

function DropdownMenu({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Root>) {
  return <DropdownMenuPrimitive.Root data-slot="dropdown-menu" {...props} />;
}

function DropdownMenuPortal({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Portal>) {
  return (
    <DropdownMenuPrimitive.Portal data-slot="dropdown-menu-portal" {...props} />
  );
}

function DropdownMenuTrigger({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Trigger>) {
  return (
    <DropdownMenuPrimitive.Trigger
      data-slot="dropdown-menu-trigger"
      {...props}
    />
  );
}

function DropdownMenuContent({
  className,
  sideOffset = 4,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Content>) {
  return (
    <DropdownMenuPrimitive.Portal>
      <DropdownMenuPrimitive.Content
        data-slot="dropdown-menu-content"
        sideOffset={sideOffset}
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",
          className,
        )}
        {...props}
      />
    </DropdownMenuPrimitive.Portal>
  );
}

function DropdownMenuGroup({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Group>) {
  return (
    <DropdownMenuPrimitive.Group data-slot="dropdown-menu-group" {...props} />
  );
}

function DropdownMenuItem({
  className,
  inset,
  variant = "default",
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Item> & {
  inset?: boolean;
  variant?: "default" | "destructive";
}) {
  return (
    <DropdownMenuPrimitive.Item
      data-slot="dropdown-menu-item"
      data-inset={inset}
      data-variant={variant}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    />
  );
}

function DropdownMenuCheckboxItem({
  className,
  children,
  checked,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.CheckboxItem>) {
  return (
    <DropdownMenuPrimitive.CheckboxItem
      data-slot="dropdown-menu-checkbox-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-sm py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      checked={checked}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <DropdownMenuPrimitive.ItemIndicator>
          <CheckIcon className="size-4" />
        </DropdownMenuPrimitive.ItemIndicator>
      </span>
      {children}
    </DropdownMenuPrimitive.CheckboxItem>
  );
}

function DropdownMenuRadioGroup({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.RadioGroup>) {
  return (
    <DropdownMenuPrimitive.RadioGroup
      data-slot="dropdown-menu-radio-group"
      {...props}
    />
  );
}

function DropdownMenuRadioItem({
  className,
  children,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.RadioItem>) {
  return (
    <DropdownMenuPrimitive.RadioItem
      data-slot="dropdown-menu-radio-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-sm py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <DropdownMenuPrimitive.ItemIndicator>
          <CircleIcon className="size-2 fill-current" />
        </DropdownMenuPrimitive.ItemIndicator>
      </span>
      {children}
    </DropdownMenuPrimitive.RadioItem>
  );
}

function DropdownMenuLabel({
  className,
  inset,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Label> & {
  inset?: boolean;
}) {
  return (
    <DropdownMenuPrimitive.Label
      data-slot="dropdown-menu-label"
      data-inset={inset}
      className={cn(
        "px-2 py-1.5 text-sm font-medium data-[inset]:pl-8",
        className,
      )}
      {...props}
    />
  );
}

function DropdownMenuSeparator({
  className,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Separator>) {
  return (
    <DropdownMenuPrimitive.Separator
      data-slot="dropdown-menu-separator"
      className={cn("bg-border -mx-1 my-1 h-px", className)}
      {...props}
    />
  );
}

function DropdownMenuShortcut({
  className,
  ...props
}: React.ComponentProps<"span">) {
  return (
    <span
      data-slot="dropdown-menu-shortcut"
      className={cn(
        "text-muted-foreground ml-auto text-xs tracking-widest",
        className,
      )}
      {...props}
    />
  );
}

function DropdownMenuSub({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Sub>) {
  return <DropdownMenuPrimitive.Sub data-slot="dropdown-menu-sub" {...props} />;
}

function DropdownMenuSubTrigger({
  className,
  inset,
  children,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.SubTrigger> & {
  inset?: boolean;
}) {
  return (
    <DropdownMenuPrimitive.SubTrigger
      data-slot="dropdown-menu-sub-trigger"
      data-inset={inset}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground flex cursor-default items-center rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[inset]:pl-8",
        className,
      )}
      {...props}
    >
      {children}
      <ChevronRightIcon className="ml-auto size-4" />
    </DropdownMenuPrimitive.SubTrigger>
  );
}

function DropdownMenuSubContent({
  className,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.SubContent>) {
  return (
    <DropdownMenuPrimitive.SubContent
      data-slot="dropdown-menu-sub-content"
      className={cn(
        "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-hidden rounded-md border p-1 shadow-lg",
        className,
      )}
      {...props}
    />
  );
}

export {
  DropdownMenu,
  DropdownMenuPortal,
  DropdownMenuTrigger,
  DropdownMenuContent,
  DropdownMenuGroup,
  DropdownMenuLabel,
  DropdownMenuItem,
  DropdownMenuCheckboxItem,
  DropdownMenuRadioGroup,
  DropdownMenuRadioItem,
  DropdownMenuSeparator,
  DropdownMenuShortcut,
  DropdownMenuSub,
  DropdownMenuSubTrigger,
  DropdownMenuSubContent,
};


===== FILE: ./src\components\ui\form.tsx =====

"use client";

import * as React from "react";
import * as LabelPrimitive from "@radix-ui/react-label@2.1.2";
import { Slot } from "@radix-ui/react-slot@1.1.2";
import {
  Controller,
  FormProvider,
  useFormContext,
  useFormState,
  type ControllerProps,
  type FieldPath,
  type FieldValues,
} from "react-hook-form@7.55.0";

import { cn } from "./utils";
import { Label } from "./label";

const Form = FormProvider;

type FormFieldContextValue<
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>,
> = {
  name: TName;
};

const FormFieldContext = React.createContext<FormFieldContextValue>(
  {} as FormFieldContextValue,
);

const FormField = <
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>,
>({
  ...props
}: ControllerProps<TFieldValues, TName>) => {
  return (
    <FormFieldContext.Provider value={{ name: props.name }}>
      <Controller {...props} />
    </FormFieldContext.Provider>
  );
};

const useFormField = () => {
  const fieldContext = React.useContext(FormFieldContext);
  const itemContext = React.useContext(FormItemContext);
  const { getFieldState } = useFormContext();
  const formState = useFormState({ name: fieldContext.name });
  const fieldState = getFieldState(fieldContext.name, formState);

  if (!fieldContext) {
    throw new Error("useFormField should be used within <FormField>");
  }

  const { id } = itemContext;

  return {
    id,
    name: fieldContext.name,
    formItemId: `${id}-form-item`,
    formDescriptionId: `${id}-form-item-description`,
    formMessageId: `${id}-form-item-message`,
    ...fieldState,
  };
};

type FormItemContextValue = {
  id: string;
};

const FormItemContext = React.createContext<FormItemContextValue>(
  {} as FormItemContextValue,
);

function FormItem({ className, ...props }: React.ComponentProps<"div">) {
  const id = React.useId();

  return (
    <FormItemContext.Provider value={{ id }}>
      <div
        data-slot="form-item"
        className={cn("grid gap-2", className)}
        {...props}
      />
    </FormItemContext.Provider>
  );
}

function FormLabel({
  className,
  ...props
}: React.ComponentProps<typeof LabelPrimitive.Root>) {
  const { error, formItemId } = useFormField();

  return (
    <Label
      data-slot="form-label"
      data-error={!!error}
      className={cn("data-[error=true]:text-destructive", className)}
      htmlFor={formItemId}
      {...props}
    />
  );
}

function FormControl({ ...props }: React.ComponentProps<typeof Slot>) {
  const { error, formItemId, formDescriptionId, formMessageId } =
    useFormField();

  return (
    <Slot
      data-slot="form-control"
      id={formItemId}
      aria-describedby={
        !error
          ? `${formDescriptionId}`
          : `${formDescriptionId} ${formMessageId}`
      }
      aria-invalid={!!error}
      {...props}
    />
  );
}

function FormDescription({ className, ...props }: React.ComponentProps<"p">) {
  const { formDescriptionId } = useFormField();

  return (
    <p
      data-slot="form-description"
      id={formDescriptionId}
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  );
}

function FormMessage({ className, ...props }: React.ComponentProps<"p">) {
  const { error, formMessageId } = useFormField();
  const body = error ? String(error?.message ?? "") : props.children;

  if (!body) {
    return null;
  }

  return (
    <p
      data-slot="form-message"
      id={formMessageId}
      className={cn("text-destructive text-sm", className)}
      {...props}
    >
      {body}
    </p>
  );
}

export {
  useFormField,
  Form,
  FormItem,
  FormLabel,
  FormControl,
  FormDescription,
  FormMessage,
  FormField,
};


===== FILE: ./src\components\ui\hover-card.tsx =====

"use client";

import * as React from "react";
import * as HoverCardPrimitive from "@radix-ui/react-hover-card@1.1.6";

import { cn } from "./utils";

function HoverCard({
  ...props
}: React.ComponentProps<typeof HoverCardPrimitive.Root>) {
  return <HoverCardPrimitive.Root data-slot="hover-card" {...props} />;
}

function HoverCardTrigger({
  ...props
}: React.ComponentProps<typeof HoverCardPrimitive.Trigger>) {
  return (
    <HoverCardPrimitive.Trigger data-slot="hover-card-trigger" {...props} />
  );
}

function HoverCardContent({
  className,
  align = "center",
  sideOffset = 4,
  ...props
}: React.ComponentProps<typeof HoverCardPrimitive.Content>) {
  return (
    <HoverCardPrimitive.Portal data-slot="hover-card-portal">
      <HoverCardPrimitive.Content
        data-slot="hover-card-content"
        align={align}
        sideOffset={sideOffset}
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-64 origin-(--radix-hover-card-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",
          className,
        )}
        {...props}
      />
    </HoverCardPrimitive.Portal>
  );
}

export { HoverCard, HoverCardTrigger, HoverCardContent };


===== FILE: ./src\components\ui\input-otp.tsx =====

"use client";

import * as React from "react";
import { OTPInput, OTPInputContext } from "input-otp@1.4.2";
import { MinusIcon } from "lucide-react@0.487.0";

import { cn } from "./utils";

function InputOTP({
  className,
  containerClassName,
  ...props
}: React.ComponentProps<typeof OTPInput> & {
  containerClassName?: string;
}) {
  return (
    <OTPInput
      data-slot="input-otp"
      containerClassName={cn(
        "flex items-center gap-2 has-disabled:opacity-50",
        containerClassName,
      )}
      className={cn("disabled:cursor-not-allowed", className)}
      {...props}
    />
  );
}

function InputOTPGroup({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="input-otp-group"
      className={cn("flex items-center gap-1", className)}
      {...props}
    />
  );
}

function InputOTPSlot({
  index,
  className,
  ...props
}: React.ComponentProps<"div"> & {
  index: number;
}) {
  const inputOTPContext = React.useContext(OTPInputContext);
  const { char, hasFakeCaret, isActive } = inputOTPContext?.slots[index] ?? {};

  return (
    <div
      data-slot="input-otp-slot"
      data-active={isActive}
      className={cn(
        "data-[active=true]:border-ring data-[active=true]:ring-ring/50 data-[active=true]:aria-invalid:ring-destructive/20 dark:data-[active=true]:aria-invalid:ring-destructive/40 aria-invalid:border-destructive data-[active=true]:aria-invalid:border-destructive dark:bg-input/30 border-input relative flex h-9 w-9 items-center justify-center border-y border-r text-sm bg-input-background transition-all outline-none first:rounded-l-md first:border-l last:rounded-r-md data-[active=true]:z-10 data-[active=true]:ring-[3px]",
        className,
      )}
      {...props}
    >
      {char}
      {hasFakeCaret && (
        <div className="pointer-events-none absolute inset-0 flex items-center justify-center">
          <div className="animate-caret-blink bg-foreground h-4 w-px duration-1000" />
        </div>
      )}
    </div>
  );
}

function InputOTPSeparator({ ...props }: React.ComponentProps<"div">) {
  return (
    <div data-slot="input-otp-separator" role="separator" {...props}>
      <MinusIcon />
    </div>
  );
}

export { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator };


===== FILE: ./src\components\ui\input.tsx =====

import * as React from "react";

import { cn } from "./utils";

function Input({ className, type, ...props }: React.ComponentProps<"input">) {
  return (
    <input
      type={type}
      data-slot="input"
      className={cn(
        "file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border px-3 py-1 text-base bg-input-background transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",
        "focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]",
        "aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",
        className,
      )}
      {...props}
    />
  );
}

export { Input };


===== FILE: ./src\components\ui\label.tsx =====

"use client";

import * as React from "react";
import * as LabelPrimitive from "@radix-ui/react-label@2.1.2";

import { cn } from "./utils";

function Label({
  className,
  ...props
}: React.ComponentProps<typeof LabelPrimitive.Root>) {
  return (
    <LabelPrimitive.Root
      data-slot="label"
      className={cn(
        "flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",
        className,
      )}
      {...props}
    />
  );
}

export { Label };


===== FILE: ./src\components\ui\menubar.tsx =====

"use client";

import * as React from "react";
import * as MenubarPrimitive from "@radix-ui/react-menubar@1.1.6";
import { CheckIcon, ChevronRightIcon, CircleIcon } from "lucide-react@0.487.0";

import { cn } from "./utils";

function Menubar({
  className,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Root>) {
  return (
    <MenubarPrimitive.Root
      data-slot="menubar"
      className={cn(
        "bg-background flex h-9 items-center gap-1 rounded-md border p-1 shadow-xs",
        className,
      )}
      {...props}
    />
  );
}

function MenubarMenu({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {
  return <MenubarPrimitive.Menu data-slot="menubar-menu" {...props} />;
}

function MenubarGroup({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Group>) {
  return <MenubarPrimitive.Group data-slot="menubar-group" {...props} />;
}

function MenubarPortal({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {
  return <MenubarPrimitive.Portal data-slot="menubar-portal" {...props} />;
}

function MenubarRadioGroup({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {
  return (
    <MenubarPrimitive.RadioGroup data-slot="menubar-radio-group" {...props} />
  );
}

function MenubarTrigger({
  className,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Trigger>) {
  return (
    <MenubarPrimitive.Trigger
      data-slot="menubar-trigger"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground flex items-center rounded-sm px-2 py-1 text-sm font-medium outline-hidden select-none",
        className,
      )}
      {...props}
    />
  );
}

function MenubarContent({
  className,
  align = "start",
  alignOffset = -4,
  sideOffset = 8,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Content>) {
  return (
    <MenubarPortal>
      <MenubarPrimitive.Content
        data-slot="menubar-content"
        align={align}
        alignOffset={alignOffset}
        sideOffset={sideOffset}
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 min-w-[12rem] origin-(--radix-menubar-content-transform-origin) overflow-hidden rounded-md border p-1 shadow-md",
          className,
        )}
        {...props}
      />
    </MenubarPortal>
  );
}

function MenubarItem({
  className,
  inset,
  variant = "default",
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Item> & {
  inset?: boolean;
  variant?: "default" | "destructive";
}) {
  return (
    <MenubarPrimitive.Item
      data-slot="menubar-item"
      data-inset={inset}
      data-variant={variant}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    />
  );
}

function MenubarCheckboxItem({
  className,
  children,
  checked,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.CheckboxItem>) {
  return (
    <MenubarPrimitive.CheckboxItem
      data-slot="menubar-checkbox-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-xs py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      checked={checked}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <MenubarPrimitive.ItemIndicator>
          <CheckIcon className="size-4" />
        </MenubarPrimitive.ItemIndicator>
      </span>
      {children}
    </MenubarPrimitive.CheckboxItem>
  );
}

function MenubarRadioItem({
  className,
  children,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.RadioItem>) {
  return (
    <MenubarPrimitive.RadioItem
      data-slot="menubar-radio-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-xs py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <MenubarPrimitive.ItemIndicator>
          <CircleIcon className="size-2 fill-current" />
        </MenubarPrimitive.ItemIndicator>
      </span>
      {children}
    </MenubarPrimitive.RadioItem>
  );
}

function MenubarLabel({
  className,
  inset,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Label> & {
  inset?: boolean;
}) {
  return (
    <MenubarPrimitive.Label
      data-slot="menubar-label"
      data-inset={inset}
      className={cn(
        "px-2 py-1.5 text-sm font-medium data-[inset]:pl-8",
        className,
      )}
      {...props}
    />
  );
}

function MenubarSeparator({
  className,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Separator>) {
  return (
    <MenubarPrimitive.Separator
      data-slot="menubar-separator"
      className={cn("bg-border -mx-1 my-1 h-px", className)}
      {...props}
    />
  );
}

function MenubarShortcut({
  className,
  ...props
}: React.ComponentProps<"span">) {
  return (
    <span
      data-slot="menubar-shortcut"
      className={cn(
        "text-muted-foreground ml-auto text-xs tracking-widest",
        className,
      )}
      {...props}
    />
  );
}

function MenubarSub({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {
  return <MenubarPrimitive.Sub data-slot="menubar-sub" {...props} />;
}

function MenubarSubTrigger({
  className,
  inset,
  children,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.SubTrigger> & {
  inset?: boolean;
}) {
  return (
    <MenubarPrimitive.SubTrigger
      data-slot="menubar-sub-trigger"
      data-inset={inset}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground flex cursor-default items-center rounded-sm px-2 py-1.5 text-sm outline-none select-none data-[inset]:pl-8",
        className,
      )}
      {...props}
    >
      {children}
      <ChevronRightIcon className="ml-auto h-4 w-4" />
    </MenubarPrimitive.SubTrigger>
  );
}

function MenubarSubContent({
  className,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.SubContent>) {
  return (
    <MenubarPrimitive.SubContent
      data-slot="menubar-sub-content"
      className={cn(
        "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 min-w-[8rem] origin-(--radix-menubar-content-transform-origin) overflow-hidden rounded-md border p-1 shadow-lg",
        className,
      )}
      {...props}
    />
  );
}

export {
  Menubar,
  MenubarPortal,
  MenubarMenu,
  MenubarTrigger,
  MenubarContent,
  MenubarGroup,
  MenubarSeparator,
  MenubarLabel,
  MenubarItem,
  MenubarShortcut,
  MenubarCheckboxItem,
  MenubarRadioGroup,
  MenubarRadioItem,
  MenubarSub,
  MenubarSubTrigger,
  MenubarSubContent,
};


===== FILE: ./src\components\ui\navigation-menu.tsx =====

import * as React from "react";
import * as NavigationMenuPrimitive from "@radix-ui/react-navigation-menu@1.2.5";
import { cva } from "class-variance-authority@0.7.1";
import { ChevronDownIcon } from "lucide-react@0.487.0";

import { cn } from "./utils";

function NavigationMenu({
  className,
  children,
  viewport = true,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Root> & {
  viewport?: boolean;
}) {
  return (
    <NavigationMenuPrimitive.Root
      data-slot="navigation-menu"
      data-viewport={viewport}
      className={cn(
        "group/navigation-menu relative flex max-w-max flex-1 items-center justify-center",
        className,
      )}
      {...props}
    >
      {children}
      {viewport && <NavigationMenuViewport />}
    </NavigationMenuPrimitive.Root>
  );
}

function NavigationMenuList({
  className,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.List>) {
  return (
    <NavigationMenuPrimitive.List
      data-slot="navigation-menu-list"
      className={cn(
        "group flex flex-1 list-none items-center justify-center gap-1",
        className,
      )}
      {...props}
    />
  );
}

function NavigationMenuItem({
  className,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Item>) {
  return (
    <NavigationMenuPrimitive.Item
      data-slot="navigation-menu-item"
      className={cn("relative", className)}
      {...props}
    />
  );
}

const navigationMenuTriggerStyle = cva(
  "group inline-flex h-9 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground disabled:pointer-events-none disabled:opacity-50 data-[state=open]:hover:bg-accent data-[state=open]:text-accent-foreground data-[state=open]:focus:bg-accent data-[state=open]:bg-accent/50 focus-visible:ring-ring/50 outline-none transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1",
);

function NavigationMenuTrigger({
  className,
  children,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Trigger>) {
  return (
    <NavigationMenuPrimitive.Trigger
      data-slot="navigation-menu-trigger"
      className={cn(navigationMenuTriggerStyle(), "group", className)}
      {...props}
    >
      {children}{" "}
      <ChevronDownIcon
        className="relative top-[1px] ml-1 size-3 transition duration-300 group-data-[state=open]:rotate-180"
        aria-hidden="true"
      />
    </NavigationMenuPrimitive.Trigger>
  );
}

function NavigationMenuContent({
  className,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Content>) {
  return (
    <NavigationMenuPrimitive.Content
      data-slot="navigation-menu-content"
      className={cn(
        "data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 top-0 left-0 w-full p-2 pr-2.5 md:absolute md:w-auto",
        "group-data-[viewport=false]/navigation-menu:bg-popover group-data-[viewport=false]/navigation-menu:text-popover-foreground group-data-[viewport=false]/navigation-menu:data-[state=open]:animate-in group-data-[viewport=false]/navigation-menu:data-[state=closed]:animate-out group-data-[viewport=false]/navigation-menu:data-[state=closed]:zoom-out-95 group-data-[viewport=false]/navigation-menu:data-[state=open]:zoom-in-95 group-data-[viewport=false]/navigation-menu:data-[state=open]:fade-in-0 group-data-[viewport=false]/navigation-menu:data-[state=closed]:fade-out-0 group-data-[viewport=false]/navigation-menu:top-full group-data-[viewport=false]/navigation-menu:mt-1.5 group-data-[viewport=false]/navigation-menu:overflow-hidden group-data-[viewport=false]/navigation-menu:rounded-md group-data-[viewport=false]/navigation-menu:border group-data-[viewport=false]/navigation-menu:shadow group-data-[viewport=false]/navigation-menu:duration-200 **:data-[slot=navigation-menu-link]:focus:ring-0 **:data-[slot=navigation-menu-link]:focus:outline-none",
        className,
      )}
      {...props}
    />
  );
}

function NavigationMenuViewport({
  className,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Viewport>) {
  return (
    <div
      className={cn(
        "absolute top-full left-0 isolate z-50 flex justify-center",
      )}
    >
      <NavigationMenuPrimitive.Viewport
        data-slot="navigation-menu-viewport"
        className={cn(
          "origin-top-center bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border shadow md:w-[var(--radix-navigation-menu-viewport-width)]",
          className,
        )}
        {...props}
      />
    </div>
  );
}

function NavigationMenuLink({
  className,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Link>) {
  return (
    <NavigationMenuPrimitive.Link
      data-slot="navigation-menu-link"
      className={cn(
        "data-[active=true]:focus:bg-accent data-[active=true]:hover:bg-accent data-[active=true]:bg-accent/50 data-[active=true]:text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus-visible:ring-ring/50 [&_svg:not([class*='text-'])]:text-muted-foreground flex flex-col gap-1 rounded-sm p-2 text-sm transition-all outline-none focus-visible:ring-[3px] focus-visible:outline-1 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    />
  );
}

function NavigationMenuIndicator({
  className,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Indicator>) {
  return (
    <NavigationMenuPrimitive.Indicator
      data-slot="navigation-menu-indicator"
      className={cn(
        "data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden",
        className,
      )}
      {...props}
    >
      <div className="bg-border relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm shadow-md" />
    </NavigationMenuPrimitive.Indicator>
  );
}

export {
  NavigationMenu,
  NavigationMenuList,
  NavigationMenuItem,
  NavigationMenuContent,
  NavigationMenuTrigger,
  NavigationMenuLink,
  NavigationMenuIndicator,
  NavigationMenuViewport,
  navigationMenuTriggerStyle,
};


===== FILE: ./src\components\ui\pagination.tsx =====

import * as React from "react";
import {
  ChevronLeftIcon,
  ChevronRightIcon,
  MoreHorizontalIcon,
} from "lucide-react@0.487.0";

import { cn } from "./utils";
import { Button, buttonVariants } from "./button";

function Pagination({ className, ...props }: React.ComponentProps<"nav">) {
  return (
    <nav
      role="navigation"
      aria-label="pagination"
      data-slot="pagination"
      className={cn("mx-auto flex w-full justify-center", className)}
      {...props}
    />
  );
}

function PaginationContent({
  className,
  ...props
}: React.ComponentProps<"ul">) {
  return (
    <ul
      data-slot="pagination-content"
      className={cn("flex flex-row items-center gap-1", className)}
      {...props}
    />
  );
}

function PaginationItem({ ...props }: React.ComponentProps<"li">) {
  return <li data-slot="pagination-item" {...props} />;
}

type PaginationLinkProps = {
  isActive?: boolean;
} & Pick<React.ComponentProps<typeof Button>, "size"> &
  React.ComponentProps<"a">;

function PaginationLink({
  className,
  isActive,
  size = "icon",
  ...props
}: PaginationLinkProps) {
  return (
    <a
      aria-current={isActive ? "page" : undefined}
      data-slot="pagination-link"
      data-active={isActive}
      className={cn(
        buttonVariants({
          variant: isActive ? "outline" : "ghost",
          size,
        }),
        className,
      )}
      {...props}
    />
  );
}

function PaginationPrevious({
  className,
  ...props
}: React.ComponentProps<typeof PaginationLink>) {
  return (
    <PaginationLink
      aria-label="Go to previous page"
      size="default"
      className={cn("gap-1 px-2.5 sm:pl-2.5", className)}
      {...props}
    >
      <ChevronLeftIcon />
      <span className="hidden sm:block">Previous</span>
    </PaginationLink>
  );
}

function PaginationNext({
  className,
  ...props
}: React.ComponentProps<typeof PaginationLink>) {
  return (
    <PaginationLink
      aria-label="Go to next page"
      size="default"
      className={cn("gap-1 px-2.5 sm:pr-2.5", className)}
      {...props}
    >
      <span className="hidden sm:block">Next</span>
      <ChevronRightIcon />
    </PaginationLink>
  );
}

function PaginationEllipsis({
  className,
  ...props
}: React.ComponentProps<"span">) {
  return (
    <span
      aria-hidden
      data-slot="pagination-ellipsis"
      className={cn("flex size-9 items-center justify-center", className)}
      {...props}
    >
      <MoreHorizontalIcon className="size-4" />
      <span className="sr-only">More pages</span>
    </span>
  );
}

export {
  Pagination,
  PaginationContent,
  PaginationLink,
  PaginationItem,
  PaginationPrevious,
  PaginationNext,
  PaginationEllipsis,
};


===== FILE: ./src\components\ui\popover.tsx =====

"use client";

import * as React from "react";
import * as PopoverPrimitive from "@radix-ui/react-popover@1.1.6";

import { cn } from "./utils";

function Popover({
  ...props
}: React.ComponentProps<typeof PopoverPrimitive.Root>) {
  return <PopoverPrimitive.Root data-slot="popover" {...props} />;
}

function PopoverTrigger({
  ...props
}: React.ComponentProps<typeof PopoverPrimitive.Trigger>) {
  return <PopoverPrimitive.Trigger data-slot="popover-trigger" {...props} />;
}

function PopoverContent({
  className,
  align = "center",
  sideOffset = 4,
  ...props
}: React.ComponentProps<typeof PopoverPrimitive.Content>) {
  return (
    <PopoverPrimitive.Portal>
      <PopoverPrimitive.Content
        data-slot="popover-content"
        align={align}
        sideOffset={sideOffset}
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",
          className,
        )}
        {...props}
      />
    </PopoverPrimitive.Portal>
  );
}

function PopoverAnchor({
  ...props
}: React.ComponentProps<typeof PopoverPrimitive.Anchor>) {
  return <PopoverPrimitive.Anchor data-slot="popover-anchor" {...props} />;
}

export { Popover, PopoverTrigger, PopoverContent, PopoverAnchor };


===== FILE: ./src\components\ui\progress.tsx =====

"use client";

import * as React from "react";
import * as ProgressPrimitive from "@radix-ui/react-progress@1.1.2";

import { cn } from "./utils";

function Progress({
  className,
  value,
  ...props
}: React.ComponentProps<typeof ProgressPrimitive.Root>) {
  return (
    <ProgressPrimitive.Root
      data-slot="progress"
      className={cn(
        "bg-primary/20 relative h-2 w-full overflow-hidden rounded-full",
        className,
      )}
      {...props}
    >
      <ProgressPrimitive.Indicator
        data-slot="progress-indicator"
        className="bg-primary h-full w-full flex-1 transition-all"
        style={{ transform: `translateX(-${100 - (value || 0)}%)` }}
      />
    </ProgressPrimitive.Root>
  );
}

export { Progress };


===== FILE: ./src\components\ui\radio-group.tsx =====

"use client";

import * as React from "react";
import * as RadioGroupPrimitive from "@radix-ui/react-radio-group@1.2.3";
import { CircleIcon } from "lucide-react@0.487.0";

import { cn } from "./utils";

function RadioGroup({
  className,
  ...props
}: React.ComponentProps<typeof RadioGroupPrimitive.Root>) {
  return (
    <RadioGroupPrimitive.Root
      data-slot="radio-group"
      className={cn("grid gap-3", className)}
      {...props}
    />
  );
}

function RadioGroupItem({
  className,
  ...props
}: React.ComponentProps<typeof RadioGroupPrimitive.Item>) {
  return (
    <RadioGroupPrimitive.Item
      data-slot="radio-group-item"
      className={cn(
        "border-input text-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 aspect-square size-4 shrink-0 rounded-full border shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",
        className,
      )}
      {...props}
    >
      <RadioGroupPrimitive.Indicator
        data-slot="radio-group-indicator"
        className="relative flex items-center justify-center"
      >
        <CircleIcon className="fill-primary absolute top-1/2 left-1/2 size-2 -translate-x-1/2 -translate-y-1/2" />
      </RadioGroupPrimitive.Indicator>
    </RadioGroupPrimitive.Item>
  );
}

export { RadioGroup, RadioGroupItem };


===== FILE: ./src\components\ui\resizable.tsx =====

"use client";

import * as React from "react";
import { GripVerticalIcon } from "lucide-react@0.487.0";
import * as ResizablePrimitive from "react-resizable-panels@2.1.7";

import { cn } from "./utils";

function ResizablePanelGroup({
  className,
  ...props
}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) {
  return (
    <ResizablePrimitive.PanelGroup
      data-slot="resizable-panel-group"
      className={cn(
        "flex h-full w-full data-[panel-group-direction=vertical]:flex-col",
        className,
      )}
      {...props}
    />
  );
}

function ResizablePanel({
  ...props
}: React.ComponentProps<typeof ResizablePrimitive.Panel>) {
  return <ResizablePrimitive.Panel data-slot="resizable-panel" {...props} />;
}

function ResizableHandle({
  withHandle,
  className,
  ...props
}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {
  withHandle?: boolean;
}) {
  return (
    <ResizablePrimitive.PanelResizeHandle
      data-slot="resizable-handle"
      className={cn(
        "bg-border focus-visible:ring-ring relative flex w-px items-center justify-center after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:ring-1 focus-visible:ring-offset-1 focus-visible:outline-hidden data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90",
        className,
      )}
      {...props}
    >
      {withHandle && (
        <div className="bg-border z-10 flex h-4 w-3 items-center justify-center rounded-xs border">
          <GripVerticalIcon className="size-2.5" />
        </div>
      )}
    </ResizablePrimitive.PanelResizeHandle>
  );
}

export { ResizablePanelGroup, ResizablePanel, ResizableHandle };


===== FILE: ./src\components\ui\scroll-area.tsx =====

"use client";

import * as React from "react";
import * as ScrollAreaPrimitive from "@radix-ui/react-scroll-area@1.2.3";

import { cn } from "./utils";

function ScrollArea({
  className,
  children,
  ...props
}: React.ComponentProps<typeof ScrollAreaPrimitive.Root>) {
  return (
    <ScrollAreaPrimitive.Root
      data-slot="scroll-area"
      className={cn("relative", className)}
      {...props}
    >
      <ScrollAreaPrimitive.Viewport
        data-slot="scroll-area-viewport"
        className="focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1"
      >
        {children}
      </ScrollAreaPrimitive.Viewport>
      <ScrollBar />
      <ScrollAreaPrimitive.Corner />
    </ScrollAreaPrimitive.Root>
  );
}

function ScrollBar({
  className,
  orientation = "vertical",
  ...props
}: React.ComponentProps<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>) {
  return (
    <ScrollAreaPrimitive.ScrollAreaScrollbar
      data-slot="scroll-area-scrollbar"
      orientation={orientation}
      className={cn(
        "flex touch-none p-px transition-colors select-none",
        orientation === "vertical" &&
          "h-full w-2.5 border-l border-l-transparent",
        orientation === "horizontal" &&
          "h-2.5 flex-col border-t border-t-transparent",
        className,
      )}
      {...props}
    >
      <ScrollAreaPrimitive.ScrollAreaThumb
        data-slot="scroll-area-thumb"
        className="bg-border relative flex-1 rounded-full"
      />
    </ScrollAreaPrimitive.ScrollAreaScrollbar>
  );
}

export { ScrollArea, ScrollBar };


===== FILE: ./src\components\ui\select.tsx =====

"use client";

import * as React from "react";
import * as SelectPrimitive from "@radix-ui/react-select@2.1.6";
import {
  CheckIcon,
  ChevronDownIcon,
  ChevronUpIcon,
} from "lucide-react@0.487.0";

import { cn } from "./utils";

function Select({
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Root>) {
  return <SelectPrimitive.Root data-slot="select" {...props} />;
}

function SelectGroup({
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Group>) {
  return <SelectPrimitive.Group data-slot="select-group" {...props} />;
}

function SelectValue({
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Value>) {
  return <SelectPrimitive.Value data-slot="select-value" {...props} />;
}

function SelectTrigger({
  className,
  size = "default",
  children,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Trigger> & {
  size?: "sm" | "default";
}) {
  return (
    <SelectPrimitive.Trigger
      data-slot="select-trigger"
      data-size={size}
      className={cn(
        "border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-full items-center justify-between gap-2 rounded-md border bg-input-background px-3 py-2 text-sm whitespace-nowrap transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    >
      {children}
      <SelectPrimitive.Icon asChild>
        <ChevronDownIcon className="size-4 opacity-50" />
      </SelectPrimitive.Icon>
    </SelectPrimitive.Trigger>
  );
}

function SelectContent({
  className,
  children,
  position = "popper",
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Content>) {
  return (
    <SelectPrimitive.Portal>
      <SelectPrimitive.Content
        data-slot="select-content"
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md",
          position === "popper" &&
            "data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",
          className,
        )}
        position={position}
        {...props}
      >
        <SelectScrollUpButton />
        <SelectPrimitive.Viewport
          className={cn(
            "p-1",
            position === "popper" &&
              "h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1",
          )}
        >
          {children}
        </SelectPrimitive.Viewport>
        <SelectScrollDownButton />
      </SelectPrimitive.Content>
    </SelectPrimitive.Portal>
  );
}

function SelectLabel({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Label>) {
  return (
    <SelectPrimitive.Label
      data-slot="select-label"
      className={cn("text-muted-foreground px-2 py-1.5 text-xs", className)}
      {...props}
    />
  );
}

function SelectItem({
  className,
  children,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Item>) {
  return (
    <SelectPrimitive.Item
      data-slot="select-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",
        className,
      )}
      {...props}
    >
      <span className="absolute right-2 flex size-3.5 items-center justify-center">
        <SelectPrimitive.ItemIndicator>
          <CheckIcon className="size-4" />
        </SelectPrimitive.ItemIndicator>
      </span>
      <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>
    </SelectPrimitive.Item>
  );
}

function SelectSeparator({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Separator>) {
  return (
    <SelectPrimitive.Separator
      data-slot="select-separator"
      className={cn("bg-border pointer-events-none -mx-1 my-1 h-px", className)}
      {...props}
    />
  );
}

function SelectScrollUpButton({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.ScrollUpButton>) {
  return (
    <SelectPrimitive.ScrollUpButton
      data-slot="select-scroll-up-button"
      className={cn(
        "flex cursor-default items-center justify-center py-1",
        className,
      )}
      {...props}
    >
      <ChevronUpIcon className="size-4" />
    </SelectPrimitive.ScrollUpButton>
  );
}

function SelectScrollDownButton({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.ScrollDownButton>) {
  return (
    <SelectPrimitive.ScrollDownButton
      data-slot="select-scroll-down-button"
      className={cn(
        "flex cursor-default items-center justify-center py-1",
        className,
      )}
      {...props}
    >
      <ChevronDownIcon className="size-4" />
    </SelectPrimitive.ScrollDownButton>
  );
}

export {
  Select,
  SelectContent,
  SelectGroup,
  SelectItem,
  SelectLabel,
  SelectScrollDownButton,
  SelectScrollUpButton,
  SelectSeparator,
  SelectTrigger,
  SelectValue,
};


===== FILE: ./src\components\ui\separator.tsx =====

"use client";

import * as React from "react";
import * as SeparatorPrimitive from "@radix-ui/react-separator@1.1.2";

import { cn } from "./utils";

function Separator({
  className,
  orientation = "horizontal",
  decorative = true,
  ...props
}: React.ComponentProps<typeof SeparatorPrimitive.Root>) {
  return (
    <SeparatorPrimitive.Root
      data-slot="separator-root"
      decorative={decorative}
      orientation={orientation}
      className={cn(
        "bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px",
        className,
      )}
      {...props}
    />
  );
}

export { Separator };


===== FILE: ./src\components\ui\sheet.tsx =====

"use client";

import * as React from "react";
import * as SheetPrimitive from "@radix-ui/react-dialog@1.1.6";
import { XIcon } from "lucide-react@0.487.0";

import { cn } from "./utils";

function Sheet({ ...props }: React.ComponentProps<typeof SheetPrimitive.Root>) {
  return <SheetPrimitive.Root data-slot="sheet" {...props} />;
}

function SheetTrigger({
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Trigger>) {
  return <SheetPrimitive.Trigger data-slot="sheet-trigger" {...props} />;
}

function SheetClose({
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Close>) {
  return <SheetPrimitive.Close data-slot="sheet-close" {...props} />;
}

function SheetPortal({
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Portal>) {
  return <SheetPrimitive.Portal data-slot="sheet-portal" {...props} />;
}

function SheetOverlay({
  className,
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Overlay>) {
  return (
    <SheetPrimitive.Overlay
      data-slot="sheet-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className,
      )}
      {...props}
    />
  );
}

function SheetContent({
  className,
  children,
  side = "right",
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Content> & {
  side?: "top" | "right" | "bottom" | "left";
}) {
  return (
    <SheetPortal>
      <SheetOverlay />
      <SheetPrimitive.Content
        data-slot="sheet-content"
        className={cn(
          "bg-background data-[state=open]:animate-in data-[state=closed]:animate-out fixed z-50 flex flex-col gap-4 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500",
          side === "right" &&
            "data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right inset-y-0 right-0 h-full w-3/4 border-l sm:max-w-sm",
          side === "left" &&
            "data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left inset-y-0 left-0 h-full w-3/4 border-r sm:max-w-sm",
          side === "top" &&
            "data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top inset-x-0 top-0 h-auto border-b",
          side === "bottom" &&
            "data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom inset-x-0 bottom-0 h-auto border-t",
          className,
        )}
        {...props}
      >
        {children}
        <SheetPrimitive.Close className="ring-offset-background focus:ring-ring data-[state=open]:bg-secondary absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none">
          <XIcon className="size-4" />
          <span className="sr-only">Close</span>
        </SheetPrimitive.Close>
      </SheetPrimitive.Content>
    </SheetPortal>
  );
}

function SheetHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sheet-header"
      className={cn("flex flex-col gap-1.5 p-4", className)}
      {...props}
    />
  );
}

function SheetFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sheet-footer"
      className={cn("mt-auto flex flex-col gap-2 p-4", className)}
      {...props}
    />
  );
}

function SheetTitle({
  className,
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Title>) {
  return (
    <SheetPrimitive.Title
      data-slot="sheet-title"
      className={cn("text-foreground font-semibold", className)}
      {...props}
    />
  );
}

function SheetDescription({
  className,
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Description>) {
  return (
    <SheetPrimitive.Description
      data-slot="sheet-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  );
}

export {
  Sheet,
  SheetTrigger,
  SheetClose,
  SheetContent,
  SheetHeader,
  SheetFooter,
  SheetTitle,
  SheetDescription,
};


===== FILE: ./src\components\ui\sidebar.tsx =====

"use client";

import * as React from "react";
import { Slot } from "@radix-ui/react-slot@1.1.2";
import { VariantProps, cva } from "class-variance-authority@0.7.1";
import { PanelLeftIcon } from "lucide-react@0.487.0";

import { useIsMobile } from "./use-mobile";
import { cn } from "./utils";
import { Button } from "./button";
import { Input } from "./input";
import { Separator } from "./separator";
import {
  Sheet,
  SheetContent,
  SheetDescription,
  SheetHeader,
  SheetTitle,
} from "./sheet";
import { Skeleton } from "./skeleton";
import {
  Tooltip,
  TooltipContent,
  TooltipProvider,
  TooltipTrigger,
} from "./tooltip";

const SIDEBAR_COOKIE_NAME = "sidebar_state";
const SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7;
const SIDEBAR_WIDTH = "16rem";
const SIDEBAR_WIDTH_MOBILE = "18rem";
const SIDEBAR_WIDTH_ICON = "3rem";
const SIDEBAR_KEYBOARD_SHORTCUT = "b";

type SidebarContextProps = {
  state: "expanded" | "collapsed";
  open: boolean;
  setOpen: (open: boolean) => void;
  openMobile: boolean;
  setOpenMobile: (open: boolean) => void;
  isMobile: boolean;
  toggleSidebar: () => void;
};

const SidebarContext = React.createContext<SidebarContextProps | null>(null);

function useSidebar() {
  const context = React.useContext(SidebarContext);
  if (!context) {
    throw new Error("useSidebar must be used within a SidebarProvider.");
  }

  return context;
}

function SidebarProvider({
  defaultOpen = true,
  open: openProp,
  onOpenChange: setOpenProp,
  className,
  style,
  children,
  ...props
}: React.ComponentProps<"div"> & {
  defaultOpen?: boolean;
  open?: boolean;
  onOpenChange?: (open: boolean) => void;
}) {
  const isMobile = useIsMobile();
  const [openMobile, setOpenMobile] = React.useState(false);

  // This is the internal state of the sidebar.
  // We use openProp and setOpenProp for control from outside the component.
  const [_open, _setOpen] = React.useState(defaultOpen);
  const open = openProp ?? _open;
  const setOpen = React.useCallback(
    (value: boolean | ((value: boolean) => boolean)) => {
      const openState = typeof value === "function" ? value(open) : value;
      if (setOpenProp) {
        setOpenProp(openState);
      } else {
        _setOpen(openState);
      }

      // This sets the cookie to keep the sidebar state.
      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`;
    },
    [setOpenProp, open],
  );

  // Helper to toggle the sidebar.
  const toggleSidebar = React.useCallback(() => {
    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open);
  }, [isMobile, setOpen, setOpenMobile]);

  // Adds a keyboard shortcut to toggle the sidebar.
  React.useEffect(() => {
    const handleKeyDown = (event: KeyboardEvent) => {
      if (
        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&
        (event.metaKey || event.ctrlKey)
      ) {
        event.preventDefault();
        toggleSidebar();
      }
    };

    window.addEventListener("keydown", handleKeyDown);
    return () => window.removeEventListener("keydown", handleKeyDown);
  }, [toggleSidebar]);

  // We add a state so that we can do data-state="expanded" or "collapsed".
  // This makes it easier to style the sidebar with Tailwind classes.
  const state = open ? "expanded" : "collapsed";

  const contextValue = React.useMemo<SidebarContextProps>(
    () => ({
      state,
      open,
      setOpen,
      isMobile,
      openMobile,
      setOpenMobile,
      toggleSidebar,
    }),
    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar],
  );

  return (
    <SidebarContext.Provider value={contextValue}>
      <TooltipProvider delayDuration={0}>
        <div
          data-slot="sidebar-wrapper"
          style={
            {
              "--sidebar-width": SIDEBAR_WIDTH,
              "--sidebar-width-icon": SIDEBAR_WIDTH_ICON,
              ...style,
            } as React.CSSProperties
          }
          className={cn(
            "group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full",
            className,
          )}
          {...props}
        >
          {children}
        </div>
      </TooltipProvider>
    </SidebarContext.Provider>
  );
}

function Sidebar({
  side = "left",
  variant = "sidebar",
  collapsible = "offcanvas",
  className,
  children,
  ...props
}: React.ComponentProps<"div"> & {
  side?: "left" | "right";
  variant?: "sidebar" | "floating" | "inset";
  collapsible?: "offcanvas" | "icon" | "none";
}) {
  const { isMobile, state, openMobile, setOpenMobile } = useSidebar();

  if (collapsible === "none") {
    return (
      <div
        data-slot="sidebar"
        className={cn(
          "bg-sidebar text-sidebar-foreground flex h-full w-(--sidebar-width) flex-col",
          className,
        )}
        {...props}
      >
        {children}
      </div>
    );
  }

  if (isMobile) {
    return (
      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>
        <SheetContent
          data-sidebar="sidebar"
          data-slot="sidebar"
          data-mobile="true"
          className="bg-sidebar text-sidebar-foreground w-(--sidebar-width) p-0 [&>button]:hidden"
          style={
            {
              "--sidebar-width": SIDEBAR_WIDTH_MOBILE,
            } as React.CSSProperties
          }
          side={side}
        >
          <SheetHeader className="sr-only">
            <SheetTitle>Sidebar</SheetTitle>
            <SheetDescription>Displays the mobile sidebar.</SheetDescription>
          </SheetHeader>
          <div className="flex h-full w-full flex-col">{children}</div>
        </SheetContent>
      </Sheet>
    );
  }

  return (
    <div
      className="group peer text-sidebar-foreground hidden md:block"
      data-state={state}
      data-collapsible={state === "collapsed" ? collapsible : ""}
      data-variant={variant}
      data-side={side}
      data-slot="sidebar"
    >
      {/* This is what handles the sidebar gap on desktop */}
      <div
        data-slot="sidebar-gap"
        className={cn(
          "relative w-(--sidebar-width) bg-transparent transition-[width] duration-200 ease-linear",
          "group-data-[collapsible=offcanvas]:w-0",
          "group-data-[side=right]:rotate-180",
          variant === "floating" || variant === "inset"
            ? "group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+(--spacing(4)))]"
            : "group-data-[collapsible=icon]:w-(--sidebar-width-icon)",
        )}
      />
      <div
        data-slot="sidebar-container"
        className={cn(
          "fixed inset-y-0 z-10 hidden h-svh w-(--sidebar-width) transition-[left,right,width] duration-200 ease-linear md:flex",
          side === "left"
            ? "left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]"
            : "right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]",
          // Adjust the padding for floating and inset variants.
          variant === "floating" || variant === "inset"
            ? "p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+(--spacing(4))+2px)]"
            : "group-data-[collapsible=icon]:w-(--sidebar-width-icon) group-data-[side=left]:border-r group-data-[side=right]:border-l",
          className,
        )}
        {...props}
      >
        <div
          data-sidebar="sidebar"
          data-slot="sidebar-inner"
          className="bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm"
        >
          {children}
        </div>
      </div>
    </div>
  );
}

function SidebarTrigger({
  className,
  onClick,
  ...props
}: React.ComponentProps<typeof Button>) {
  const { toggleSidebar } = useSidebar();

  return (
    <Button
      data-sidebar="trigger"
      data-slot="sidebar-trigger"
      variant="ghost"
      size="icon"
      className={cn("size-7", className)}
      onClick={(event) => {
        onClick?.(event);
        toggleSidebar();
      }}
      {...props}
    >
      <PanelLeftIcon />
      <span className="sr-only">Toggle Sidebar</span>
    </Button>
  );
}

function SidebarRail({ className, ...props }: React.ComponentProps<"button">) {
  const { toggleSidebar } = useSidebar();

  return (
    <button
      data-sidebar="rail"
      data-slot="sidebar-rail"
      aria-label="Toggle Sidebar"
      tabIndex={-1}
      onClick={toggleSidebar}
      title="Toggle Sidebar"
      className={cn(
        "hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex",
        "in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize",
        "[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize",
        "hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full",
        "[[data-side=left][data-collapsible=offcanvas]_&]:-right-2",
        "[[data-side=right][data-collapsible=offcanvas]_&]:-left-2",
        className,
      )}
      {...props}
    />
  );
}

function SidebarInset({ className, ...props }: React.ComponentProps<"main">) {
  return (
    <main
      data-slot="sidebar-inset"
      className={cn(
        "bg-background relative flex w-full flex-1 flex-col",
        "md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2",
        className,
      )}
      {...props}
    />
  );
}

function SidebarInput({
  className,
  ...props
}: React.ComponentProps<typeof Input>) {
  return (
    <Input
      data-slot="sidebar-input"
      data-sidebar="input"
      className={cn("bg-background h-8 w-full shadow-none", className)}
      {...props}
    />
  );
}

function SidebarHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sidebar-header"
      data-sidebar="header"
      className={cn("flex flex-col gap-2 p-2", className)}
      {...props}
    />
  );
}

function SidebarFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sidebar-footer"
      data-sidebar="footer"
      className={cn("flex flex-col gap-2 p-2", className)}
      {...props}
    />
  );
}

function SidebarSeparator({
  className,
  ...props
}: React.ComponentProps<typeof Separator>) {
  return (
    <Separator
      data-slot="sidebar-separator"
      data-sidebar="separator"
      className={cn("bg-sidebar-border mx-2 w-auto", className)}
      {...props}
    />
  );
}

function SidebarContent({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sidebar-content"
      data-sidebar="content"
      className={cn(
        "flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden",
        className,
      )}
      {...props}
    />
  );
}

function SidebarGroup({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sidebar-group"
      data-sidebar="group"
      className={cn("relative flex w-full min-w-0 flex-col p-2", className)}
      {...props}
    />
  );
}

function SidebarGroupLabel({
  className,
  asChild = false,
  ...props
}: React.ComponentProps<"div"> & { asChild?: boolean }) {
  const Comp = asChild ? Slot : "div";

  return (
    <Comp
      data-slot="sidebar-group-label"
      data-sidebar="group-label"
      className={cn(
        "text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",
        "group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0",
        className,
      )}
      {...props}
    />
  );
}

function SidebarGroupAction({
  className,
  asChild = false,
  ...props
}: React.ComponentProps<"button"> & { asChild?: boolean }) {
  const Comp = asChild ? Slot : "button";

  return (
    <Comp
      data-slot="sidebar-group-action"
      data-sidebar="group-action"
      className={cn(
        "text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",
        // Increases the hit area of the button on mobile.
        "after:absolute after:-inset-2 md:after:hidden",
        "group-data-[collapsible=icon]:hidden",
        className,
      )}
      {...props}
    />
  );
}

function SidebarGroupContent({
  className,
  ...props
}: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sidebar-group-content"
      data-sidebar="group-content"
      className={cn("w-full text-sm", className)}
      {...props}
    />
  );
}

function SidebarMenu({ className, ...props }: React.ComponentProps<"ul">) {
  return (
    <ul
      data-slot="sidebar-menu"
      data-sidebar="menu"
      className={cn("flex w-full min-w-0 flex-col gap-1", className)}
      {...props}
    />
  );
}

function SidebarMenuItem({ className, ...props }: React.ComponentProps<"li">) {
  return (
    <li
      data-slot="sidebar-menu-item"
      data-sidebar="menu-item"
      className={cn("group/menu-item relative", className)}
      {...props}
    />
  );
}

const sidebarMenuButtonVariants = cva(
  "peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:size-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",
  {
    variants: {
      variant: {
        default: "hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",
        outline:
          "bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]",
      },
      size: {
        default: "h-8 text-sm",
        sm: "h-7 text-xs",
        lg: "h-12 text-sm group-data-[collapsible=icon]:p-0!",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  },
);

function SidebarMenuButton({
  asChild = false,
  isActive = false,
  variant = "default",
  size = "default",
  tooltip,
  className,
  ...props
}: React.ComponentProps<"button"> & {
  asChild?: boolean;
  isActive?: boolean;
  tooltip?: string | React.ComponentProps<typeof TooltipContent>;
} & VariantProps<typeof sidebarMenuButtonVariants>) {
  const Comp = asChild ? Slot : "button";
  const { isMobile, state } = useSidebar();

  const button = (
    <Comp
      data-slot="sidebar-menu-button"
      data-sidebar="menu-button"
      data-size={size}
      data-active={isActive}
      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}
      {...props}
    />
  );

  if (!tooltip) {
    return button;
  }

  if (typeof tooltip === "string") {
    tooltip = {
      children: tooltip,
    };
  }

  return (
    <Tooltip>
      <TooltipTrigger asChild>{button}</TooltipTrigger>
      <TooltipContent
        side="right"
        align="center"
        hidden={state !== "collapsed" || isMobile}
        {...tooltip}
      />
    </Tooltip>
  );
}

function SidebarMenuAction({
  className,
  asChild = false,
  showOnHover = false,
  ...props
}: React.ComponentProps<"button"> & {
  asChild?: boolean;
  showOnHover?: boolean;
}) {
  const Comp = asChild ? Slot : "button";

  return (
    <Comp
      data-slot="sidebar-menu-action"
      data-sidebar="menu-action"
      className={cn(
        "text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",
        // Increases the hit area of the button on mobile.
        "after:absolute after:-inset-2 md:after:hidden",
        "peer-data-[size=sm]/menu-button:top-1",
        "peer-data-[size=default]/menu-button:top-1.5",
        "peer-data-[size=lg]/menu-button:top-2.5",
        "group-data-[collapsible=icon]:hidden",
        showOnHover &&
          "peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0",
        className,
      )}
      {...props}
    />
  );
}

function SidebarMenuBadge({
  className,
  ...props
}: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sidebar-menu-badge"
      data-sidebar="menu-badge"
      className={cn(
        "text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none",
        "peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground",
        "peer-data-[size=sm]/menu-button:top-1",
        "peer-data-[size=default]/menu-button:top-1.5",
        "peer-data-[size=lg]/menu-button:top-2.5",
        "group-data-[collapsible=icon]:hidden",
        className,
      )}
      {...props}
    />
  );
}

function SidebarMenuSkeleton({
  className,
  showIcon = false,
  ...props
}: React.ComponentProps<"div"> & {
  showIcon?: boolean;
}) {
  // Random width between 50 to 90%.
  const width = React.useMemo(() => {
    return `${Math.floor(Math.random() * 40) + 50}%`;
  }, []);

  return (
    <div
      data-slot="sidebar-menu-skeleton"
      data-sidebar="menu-skeleton"
      className={cn("flex h-8 items-center gap-2 rounded-md px-2", className)}
      {...props}
    >
      {showIcon && (
        <Skeleton
          className="size-4 rounded-md"
          data-sidebar="menu-skeleton-icon"
        />
      )}
      <Skeleton
        className="h-4 max-w-(--skeleton-width) flex-1"
        data-sidebar="menu-skeleton-text"
        style={
          {
            "--skeleton-width": width,
          } as React.CSSProperties
        }
      />
    </div>
  );
}

function SidebarMenuSub({ className, ...props }: React.ComponentProps<"ul">) {
  return (
    <ul
      data-slot="sidebar-menu-sub"
      data-sidebar="menu-sub"
      className={cn(
        "border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5",
        "group-data-[collapsible=icon]:hidden",
        className,
      )}
      {...props}
    />
  );
}

function SidebarMenuSubItem({
  className,
  ...props
}: React.ComponentProps<"li">) {
  return (
    <li
      data-slot="sidebar-menu-sub-item"
      data-sidebar="menu-sub-item"
      className={cn("group/menu-sub-item relative", className)}
      {...props}
    />
  );
}

function SidebarMenuSubButton({
  asChild = false,
  size = "md",
  isActive = false,
  className,
  ...props
}: React.ComponentProps<"a"> & {
  asChild?: boolean;
  size?: "sm" | "md";
  isActive?: boolean;
}) {
  const Comp = asChild ? Slot : "a";

  return (
    <Comp
      data-slot="sidebar-menu-sub-button"
      data-sidebar="menu-sub-button"
      data-size={size}
      data-active={isActive}
      className={cn(
        "text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline-hidden focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",
        "data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground",
        size === "sm" && "text-xs",
        size === "md" && "text-sm",
        "group-data-[collapsible=icon]:hidden",
        className,
      )}
      {...props}
    />
  );
}

export {
  Sidebar,
  SidebarContent,
  SidebarFooter,
  SidebarGroup,
  SidebarGroupAction,
  SidebarGroupContent,
  SidebarGroupLabel,
  SidebarHeader,
  SidebarInput,
  SidebarInset,
  SidebarMenu,
  SidebarMenuAction,
  SidebarMenuBadge,
  SidebarMenuButton,
  SidebarMenuItem,
  SidebarMenuSkeleton,
  SidebarMenuSub,
  SidebarMenuSubButton,
  SidebarMenuSubItem,
  SidebarProvider,
  SidebarRail,
  SidebarSeparator,
  SidebarTrigger,
  useSidebar,
};


===== FILE: ./src\components\ui\skeleton.tsx =====

import { cn } from "./utils";

function Skeleton({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="skeleton"
      className={cn("bg-accent animate-pulse rounded-md", className)}
      {...props}
    />
  );
}

export { Skeleton };


===== FILE: ./src\components\ui\slider.tsx =====

"use client";

import * as React from "react";
import * as SliderPrimitive from "@radix-ui/react-slider@1.2.3";

import { cn } from "./utils";

function Slider({
  className,
  defaultValue,
  value,
  min = 0,
  max = 100,
  ...props
}: React.ComponentProps<typeof SliderPrimitive.Root>) {
  const _values = React.useMemo(
    () =>
      Array.isArray(value)
        ? value
        : Array.isArray(defaultValue)
          ? defaultValue
          : [min, max],
    [value, defaultValue, min, max],
  );

  return (
    <SliderPrimitive.Root
      data-slot="slider"
      defaultValue={defaultValue}
      value={value}
      min={min}
      max={max}
      className={cn(
        "relative flex w-full touch-none items-center select-none data-[disabled]:opacity-50 data-[orientation=vertical]:h-full data-[orientation=vertical]:min-h-44 data-[orientation=vertical]:w-auto data-[orientation=vertical]:flex-col",
        className,
      )}
      {...props}
    >
      <SliderPrimitive.Track
        data-slot="slider-track"
        className={cn(
          "bg-muted relative grow overflow-hidden rounded-full data-[orientation=horizontal]:h-4 data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-1.5",
        )}
      >
        <SliderPrimitive.Range
          data-slot="slider-range"
          className={cn(
            "bg-primary absolute data-[orientation=horizontal]:h-full data-[orientation=vertical]:w-full",
          )}
        />
      </SliderPrimitive.Track>
      {Array.from({ length: _values.length }, (_, index) => (
        <SliderPrimitive.Thumb
          data-slot="slider-thumb"
          key={index}
          className="border-primary bg-background ring-ring/50 block size-4 shrink-0 rounded-full border shadow-sm transition-[color,box-shadow] hover:ring-4 focus-visible:ring-4 focus-visible:outline-hidden disabled:pointer-events-none disabled:opacity-50"
        />
      ))}
    </SliderPrimitive.Root>
  );
}

export { Slider };


===== FILE: ./src\components\ui\sonner.tsx =====

"use client";

import { useTheme } from "next-themes@0.4.6";
import { Toaster as Sonner, ToasterProps } from "sonner@2.0.3";

const Toaster = ({ ...props }: ToasterProps) => {
  const { theme = "system" } = useTheme();

  return (
    <Sonner
      theme={theme as ToasterProps["theme"]}
      className="toaster group"
      style={
        {
          "--normal-bg": "var(--popover)",
          "--normal-text": "var(--popover-foreground)",
          "--normal-border": "var(--border)",
        } as React.CSSProperties
      }
      {...props}
    />
  );
};

export { Toaster };


===== FILE: ./src\components\ui\switch.tsx =====

"use client";

import * as React from "react";
import * as SwitchPrimitive from "@radix-ui/react-switch@1.1.3";

import { cn } from "./utils";

function Switch({
  className,
  ...props
}: React.ComponentProps<typeof SwitchPrimitive.Root>) {
  return (
    <SwitchPrimitive.Root
      data-slot="switch"
      className={cn(
        "peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-switch-background focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",
        className,
      )}
      {...props}
    >
      <SwitchPrimitive.Thumb
        data-slot="switch-thumb"
        className={cn(
          "bg-card dark:data-[state=unchecked]:bg-card-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0",
        )}
      />
    </SwitchPrimitive.Root>
  );
}

export { Switch };


===== FILE: ./src\components\ui\table.tsx =====

"use client";

import * as React from "react";

import { cn } from "./utils";

function Table({ className, ...props }: React.ComponentProps<"table">) {
  return (
    <div
      data-slot="table-container"
      className="relative w-full overflow-x-auto"
    >
      <table
        data-slot="table"
        className={cn("w-full caption-bottom text-sm", className)}
        {...props}
      />
    </div>
  );
}

function TableHeader({ className, ...props }: React.ComponentProps<"thead">) {
  return (
    <thead
      data-slot="table-header"
      className={cn("[&_tr]:border-b", className)}
      {...props}
    />
  );
}

function TableBody({ className, ...props }: React.ComponentProps<"tbody">) {
  return (
    <tbody
      data-slot="table-body"
      className={cn("[&_tr:last-child]:border-0", className)}
      {...props}
    />
  );
}

function TableFooter({ className, ...props }: React.ComponentProps<"tfoot">) {
  return (
    <tfoot
      data-slot="table-footer"
      className={cn(
        "bg-muted/50 border-t font-medium [&>tr]:last:border-b-0",
        className,
      )}
      {...props}
    />
  );
}

function TableRow({ className, ...props }: React.ComponentProps<"tr">) {
  return (
    <tr
      data-slot="table-row"
      className={cn(
        "hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",
        className,
      )}
      {...props}
    />
  );
}

function TableHead({ className, ...props }: React.ComponentProps<"th">) {
  return (
    <th
      data-slot="table-head"
      className={cn(
        "text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",
        className,
      )}
      {...props}
    />
  );
}

function TableCell({ className, ...props }: React.ComponentProps<"td">) {
  return (
    <td
      data-slot="table-cell"
      className={cn(
        "p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",
        className,
      )}
      {...props}
    />
  );
}

function TableCaption({
  className,
  ...props
}: React.ComponentProps<"caption">) {
  return (
    <caption
      data-slot="table-caption"
      className={cn("text-muted-foreground mt-4 text-sm", className)}
      {...props}
    />
  );
}

export {
  Table,
  TableHeader,
  TableBody,
  TableFooter,
  TableHead,
  TableRow,
  TableCell,
  TableCaption,
};


===== FILE: ./src\components\ui\tabs.tsx =====

"use client";

import * as React from "react";
import * as TabsPrimitive from "@radix-ui/react-tabs@1.1.3";

import { cn } from "./utils";

function Tabs({
  className,
  ...props
}: React.ComponentProps<typeof TabsPrimitive.Root>) {
  return (
    <TabsPrimitive.Root
      data-slot="tabs"
      className={cn("flex flex-col gap-2", className)}
      {...props}
    />
  );
}

function TabsList({
  className,
  ...props
}: React.ComponentProps<typeof TabsPrimitive.List>) {
  return (
    <TabsPrimitive.List
      data-slot="tabs-list"
      className={cn(
        "bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-xl p-[3px] flex",
        className,
      )}
      {...props}
    />
  );
}

function TabsTrigger({
  className,
  ...props
}: React.ComponentProps<typeof TabsPrimitive.Trigger>) {
  return (
    <TabsPrimitive.Trigger
      data-slot="tabs-trigger"
      className={cn(
        "data-[state=active]:bg-card dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-xl border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    />
  );
}

function TabsContent({
  className,
  ...props
}: React.ComponentProps<typeof TabsPrimitive.Content>) {
  return (
    <TabsPrimitive.Content
      data-slot="tabs-content"
      className={cn("flex-1 outline-none", className)}
      {...props}
    />
  );
}

export { Tabs, TabsList, TabsTrigger, TabsContent };


===== FILE: ./src\components\ui\textarea.tsx =====

import * as React from "react";

import { cn } from "./utils";

function Textarea({ className, ...props }: React.ComponentProps<"textarea">) {
  return (
    <textarea
      data-slot="textarea"
      className={cn(
        "resize-none border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-input-background px-3 py-2 text-base transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",
        className,
      )}
      {...props}
    />
  );
}

export { Textarea };


===== FILE: ./src\components\ui\toggle-group.tsx =====

"use client";

import * as React from "react";
import * as ToggleGroupPrimitive from "@radix-ui/react-toggle-group@1.1.2";
import { type VariantProps } from "class-variance-authority@0.7.1";

import { cn } from "./utils";
import { toggleVariants } from "./toggle";

const ToggleGroupContext = React.createContext<
  VariantProps<typeof toggleVariants>
>({
  size: "default",
  variant: "default",
});

function ToggleGroup({
  className,
  variant,
  size,
  children,
  ...props
}: React.ComponentProps<typeof ToggleGroupPrimitive.Root> &
  VariantProps<typeof toggleVariants>) {
  return (
    <ToggleGroupPrimitive.Root
      data-slot="toggle-group"
      data-variant={variant}
      data-size={size}
      className={cn(
        "group/toggle-group flex w-fit items-center rounded-md data-[variant=outline]:shadow-xs",
        className,
      )}
      {...props}
    >
      <ToggleGroupContext.Provider value={{ variant, size }}>
        {children}
      </ToggleGroupContext.Provider>
    </ToggleGroupPrimitive.Root>
  );
}

function ToggleGroupItem({
  className,
  children,
  variant,
  size,
  ...props
}: React.ComponentProps<typeof ToggleGroupPrimitive.Item> &
  VariantProps<typeof toggleVariants>) {
  const context = React.useContext(ToggleGroupContext);

  return (
    <ToggleGroupPrimitive.Item
      data-slot="toggle-group-item"
      data-variant={context.variant || variant}
      data-size={context.size || size}
      className={cn(
        toggleVariants({
          variant: context.variant || variant,
          size: context.size || size,
        }),
        "min-w-0 flex-1 shrink-0 rounded-none shadow-none first:rounded-l-md last:rounded-r-md focus:z-10 focus-visible:z-10 data-[variant=outline]:border-l-0 data-[variant=outline]:first:border-l",
        className,
      )}
      {...props}
    >
      {children}
    </ToggleGroupPrimitive.Item>
  );
}

export { ToggleGroup, ToggleGroupItem };


===== FILE: ./src\components\ui\toggle.tsx =====

"use client";

import * as React from "react";
import * as TogglePrimitive from "@radix-ui/react-toggle@1.1.2";
import { cva, type VariantProps } from "class-variance-authority@0.7.1";

import { cn } from "./utils";

const toggleVariants = cva(
  "inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium hover:bg-muted hover:text-muted-foreground disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 [&_svg]:shrink-0 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] outline-none transition-[color,box-shadow] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive whitespace-nowrap",
  {
    variants: {
      variant: {
        default: "bg-transparent",
        outline:
          "border border-input bg-transparent hover:bg-accent hover:text-accent-foreground",
      },
      size: {
        default: "h-9 px-2 min-w-9",
        sm: "h-8 px-1.5 min-w-8",
        lg: "h-10 px-2.5 min-w-10",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  },
);

function Toggle({
  className,
  variant,
  size,
  ...props
}: React.ComponentProps<typeof TogglePrimitive.Root> &
  VariantProps<typeof toggleVariants>) {
  return (
    <TogglePrimitive.Root
      data-slot="toggle"
      className={cn(toggleVariants({ variant, size, className }))}
      {...props}
    />
  );
}

export { Toggle, toggleVariants };


===== FILE: ./src\components\ui\tooltip.tsx =====

"use client";

import * as React from "react";
import * as TooltipPrimitive from "@radix-ui/react-tooltip@1.1.8";

import { cn } from "./utils";

function TooltipProvider({
  delayDuration = 0,
  ...props
}: React.ComponentProps<typeof TooltipPrimitive.Provider>) {
  return (
    <TooltipPrimitive.Provider
      data-slot="tooltip-provider"
      delayDuration={delayDuration}
      {...props}
    />
  );
}

function Tooltip({
  ...props
}: React.ComponentProps<typeof TooltipPrimitive.Root>) {
  return (
    <TooltipProvider>
      <TooltipPrimitive.Root data-slot="tooltip" {...props} />
    </TooltipProvider>
  );
}

function TooltipTrigger({
  ...props
}: React.ComponentProps<typeof TooltipPrimitive.Trigger>) {
  return <TooltipPrimitive.Trigger data-slot="tooltip-trigger" {...props} />;
}

function TooltipContent({
  className,
  sideOffset = 0,
  children,
  ...props
}: React.ComponentProps<typeof TooltipPrimitive.Content>) {
  return (
    <TooltipPrimitive.Portal>
      <TooltipPrimitive.Content
        data-slot="tooltip-content"
        sideOffset={sideOffset}
        className={cn(
          "bg-primary text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-fit origin-(--radix-tooltip-content-transform-origin) rounded-md px-3 py-1.5 text-xs text-balance",
          className,
        )}
        {...props}
      >
        {children}
        <TooltipPrimitive.Arrow className="bg-primary fill-primary z-50 size-2.5 translate-y-[calc(-50%_-_2px)] rotate-45 rounded-[2px]" />
      </TooltipPrimitive.Content>
    </TooltipPrimitive.Portal>
  );
}

export { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider };


===== FILE: ./src\components\ui\use-mobile.ts =====

import * as React from "react";

const MOBILE_BREAKPOINT = 768;

export function useIsMobile() {
  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(
    undefined,
  );

  React.useEffect(() => {
    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`);
    const onChange = () => {
      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT);
    };
    mql.addEventListener("change", onChange);
    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT);
    return () => mql.removeEventListener("change", onChange);
  }, []);

  return !!isMobile;
}


===== FILE: ./src\components\ui\utils.ts =====

import { clsx, type ClassValue } from "clsx";
import { twMerge } from "tailwind-merge";

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs));
}


===== FILE: ./src\guidelines\Guidelines.md =====

**Add your own guidelines here**
<!--

System Guidelines

Use this file to provide the AI with rules and guidelines you want it to follow.
This template outlines a few examples of things you can add. You can add your own sections and format it to suit your needs

TIP: More context isn't always better. It can confuse the LLM. Try and add the most important rules you need

# General guidelines

Any general rules you want the AI to follow.
For example:

* Only use absolute positioning when necessary. Opt for responsive and well structured layouts that use flexbox and grid by default
* Refactor code as you go to keep code clean
* Keep file sizes small and put helper functions and components in their own files.

--------------

# Design system guidelines
Rules for how the AI should make generations look like your company's design system

Additionally, if you select a design system to use in the prompt box, you can reference
your design system's components, tokens, variables and components.
For example:

* Use a base font-size of 14px
* Date formats should always be in the format ‚ÄúJun 10‚Äù
* The bottom toolbar should only ever have a maximum of 4 items
* Never use the floating action button with the bottom toolbar
* Chips should always come in sets of 3 or more
* Don't use a dropdown if there are 2 or fewer options

You can also create sub sections and add more specific details
For example:


## Button
The Button component is a fundamental interactive element in our design system, designed to trigger actions or navigate
users through the application. It provides visual feedback and clear affordances to enhance user experience.

### Usage
Buttons should be used for important actions that users need to take, such as form submissions, confirming choices,
or initiating processes. They communicate interactivity and should have clear, action-oriented labels.

### Variants
* Primary Button
  * Purpose : Used for the main action in a section or page
  * Visual Style : Bold, filled with the primary brand color
  * Usage : One primary button per section to guide users toward the most important action
* Secondary Button
  * Purpose : Used for alternative or supporting actions
  * Visual Style : Outlined with the primary color, transparent background
  * Usage : Can appear alongside a primary button for less important actions
* Tertiary Button
  * Purpose : Used for the least important actions
  * Visual Style : Text-only with no border, using primary color
  * Usage : For actions that should be available but not emphasized
-->


===== FILE: ./src\index.css =====

/*! tailwindcss v4.1.3 | MIT License | https://tailwindcss.com */
@layer properties {
  @supports (((-webkit-hyphens: none)) and (not (margin-trim: inline))) or ((-moz-orient: inline) and (not (color: rgb(from red r g b)))) {
    *, :before, :after, ::backdrop {
      --tw-translate-x: 0;
      --tw-translate-y: 0;
      --tw-translate-z: 0;
      --tw-rotate-x: rotateX(0);
      --tw-rotate-y: rotateY(0);
      --tw-rotate-z: rotateZ(0);
      --tw-skew-x: skewX(0);
      --tw-skew-y: skewY(0);
      --tw-space-y-reverse: 0;
      --tw-border-style: solid;
      --tw-font-weight: initial;
      --tw-tracking: initial;
      --tw-shadow: 0 0 #0000;
      --tw-shadow-color: initial;
      --tw-shadow-alpha: 100%;
      --tw-inset-shadow: 0 0 #0000;
      --tw-inset-shadow-color: initial;
      --tw-inset-shadow-alpha: 100%;
      --tw-ring-color: initial;
      --tw-ring-shadow: 0 0 #0000;
      --tw-inset-ring-color: initial;
      --tw-inset-ring-shadow: 0 0 #0000;
      --tw-ring-inset: initial;
      --tw-ring-offset-width: 0px;
      --tw-ring-offset-color: #fff;
      --tw-ring-offset-shadow: 0 0 #0000;
      --tw-outline-style: solid;
      --tw-blur: initial;
      --tw-brightness: initial;
      --tw-contrast: initial;
      --tw-grayscale: initial;
      --tw-hue-rotate: initial;
      --tw-invert: initial;
      --tw-opacity: initial;
      --tw-saturate: initial;
      --tw-sepia: initial;
      --tw-drop-shadow: initial;
      --tw-drop-shadow-color: initial;
      --tw-drop-shadow-alpha: 100%;
      --tw-drop-shadow-size: initial;
      --tw-backdrop-blur: initial;
      --tw-backdrop-brightness: initial;
      --tw-backdrop-contrast: initial;
      --tw-backdrop-grayscale: initial;
      --tw-backdrop-hue-rotate: initial;
      --tw-backdrop-invert: initial;
      --tw-backdrop-opacity: initial;
      --tw-backdrop-saturate: initial;
      --tw-backdrop-sepia: initial;
      --tw-duration: initial;
      --tw-scale-x: 1;
      --tw-scale-y: 1;
      --tw-scale-z: 1;
    }
  }
}

@layer theme {
  :root, :host {
    --font-sans: ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
    --font-mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    --color-black: #000;
    --color-white: #fff;
    --spacing: .25rem;
    --container-2xl: 42rem;
    --text-xs: .75rem;
    --text-xs--line-height: calc(1 / .75);
    --text-sm: .875rem;
    --text-sm--line-height: calc(1.25 / .875);
    --text-base: 1rem;
    --text-base--line-height: calc(1.5 / 1);
    --text-lg: 1.125rem;
    --text-xl: 1.25rem;
    --text-2xl: 1.5rem;
    --text-2xl--line-height: calc(2 / 1.5);
    --text-6xl: 3.75rem;
    --text-6xl--line-height: 1;
    --font-weight-normal: 400;
    --font-weight-medium: 500;
    --tracking-wide: .025em;
    --blur-sm: 8px;
    --default-transition-duration: .15s;
    --default-transition-timing-function: cubic-bezier(.4, 0, .2, 1);
    --default-font-family: var(--font-sans);
    --default-font-feature-settings: var(--font-sans--font-feature-settings);
    --default-font-variation-settings: var(--font-sans--font-variation-settings);
    --default-mono-font-family: var(--font-mono);
    --default-mono-font-feature-settings: var(--font-mono--font-feature-settings);
    --default-mono-font-variation-settings: var(--font-mono--font-variation-settings);
  }
}

@layer base {
  *, :after, :before, ::backdrop {
    box-sizing: border-box;
    border: 0 solid;
    margin: 0;
    padding: 0;
  }

  ::file-selector-button {
    box-sizing: border-box;
    border: 0 solid;
    margin: 0;
    padding: 0;
  }

  html, :host {
    -webkit-text-size-adjust: 100%;
    tab-size: 4;
    line-height: 1.5;
    font-family: var(--default-font-family, ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji");
    font-feature-settings: var(--default-font-feature-settings, normal);
    font-variation-settings: var(--default-font-variation-settings, normal);
    -webkit-tap-highlight-color: transparent;
  }

  body {
    line-height: inherit;
  }

  hr {
    height: 0;
    color: inherit;
    border-top-width: 1px;
  }

  abbr:where([title]) {
    -webkit-text-decoration: underline dotted;
    text-decoration: underline dotted;
  }

  h1, h2, h3, h4, h5, h6 {
    font-size: inherit;
    font-weight: inherit;
  }

  a {
    color: inherit;
    -webkit-text-decoration: inherit;
    -webkit-text-decoration: inherit;
    text-decoration: inherit;
  }

  b, strong {
    font-weight: bolder;
  }

  code, kbd, samp, pre {
    font-family: var(--default-mono-font-family, ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace);
    font-feature-settings: var(--default-mono-font-feature-settings, normal);
    font-variation-settings: var(--default-mono-font-variation-settings, normal);
    font-size: 1em;
  }

  small {
    font-size: 80%;
  }

  sub, sup {
    vertical-align: baseline;
    font-size: 75%;
    line-height: 0;
    position: relative;
  }

  sub {
    bottom: -.25em;
  }

  sup {
    top: -.5em;
  }

  table {
    text-indent: 0;
    border-color: inherit;
    border-collapse: collapse;
  }

  :-moz-focusring {
    outline: auto;
  }

  progress {
    vertical-align: baseline;
  }

  summary {
    display: list-item;
  }

  ol, ul, menu {
    list-style: none;
  }

  img, svg, video, canvas, audio, iframe, embed, object {
    vertical-align: middle;
    display: block;
  }

  img, video {
    max-width: 100%;
    height: auto;
  }

  button, input, select, optgroup, textarea {
    font: inherit;
    font-feature-settings: inherit;
    font-variation-settings: inherit;
    letter-spacing: inherit;
    color: inherit;
    opacity: 1;
    background-color: #0000;
    border-radius: 0;
  }

  ::file-selector-button {
    font: inherit;
    font-feature-settings: inherit;
    font-variation-settings: inherit;
    letter-spacing: inherit;
    color: inherit;
    opacity: 1;
    background-color: #0000;
    border-radius: 0;
  }

  :where(select:is([multiple], [size])) optgroup {
    font-weight: bolder;
  }

  :where(select:is([multiple], [size])) optgroup option {
    padding-inline-start: 20px;
  }

  ::file-selector-button {
    margin-inline-end: 4px;
  }

  ::placeholder {
    opacity: 1;
    color: currentColor;
  }

  @supports (color: color-mix(in lab, red, red)) {
    ::placeholder {
      color: color-mix(in oklab, currentColor 50%, transparent);
    }
  }

  textarea {
    resize: vertical;
  }

  ::-webkit-search-decoration {
    -webkit-appearance: none;
  }

  ::-webkit-date-and-time-value {
    min-height: 1lh;
    text-align: inherit;
  }

  ::-webkit-datetime-edit {
    display: inline-flex;
  }

  ::-webkit-datetime-edit-fields-wrapper {
    padding: 0;
  }

  ::-webkit-datetime-edit {
    padding-block: 0;
  }

  ::-webkit-datetime-edit-year-field {
    padding-block: 0;
  }

  ::-webkit-datetime-edit-month-field {
    padding-block: 0;
  }

  ::-webkit-datetime-edit-day-field {
    padding-block: 0;
  }

  ::-webkit-datetime-edit-hour-field {
    padding-block: 0;
  }

  ::-webkit-datetime-edit-minute-field {
    padding-block: 0;
  }

  ::-webkit-datetime-edit-second-field {
    padding-block: 0;
  }

  ::-webkit-datetime-edit-millisecond-field {
    padding-block: 0;
  }

  ::-webkit-datetime-edit-meridiem-field {
    padding-block: 0;
  }

  :-moz-ui-invalid {
    box-shadow: none;
  }

  button, input:where([type="button"], [type="reset"], [type="submit"]) {
    appearance: button;
  }

  ::file-selector-button {
    appearance: button;
  }

  ::-webkit-inner-spin-button {
    height: auto;
  }

  ::-webkit-outer-spin-button {
    height: auto;
  }

  [hidden]:where(:not([hidden="until-found"])) {
    display: none !important;
  }

  * {
    border-color: var(--border);
    outline-color: var(--ring);
  }

  @supports (color: color-mix(in lab, red, red)) {
    * {
      outline-color: color-mix(in oklab, var(--ring) 50%, transparent);
    }
  }

  * {
    border-color: var(--border);
    outline-color: var(--ring);
  }

  @supports (color: color-mix(in lab, red, red)) {
    * {
      outline-color: color-mix(in oklab, var(--ring) 50%, transparent);
    }
  }

  body {
    background-color: var(--background);
    color: var(--foreground);
  }

  :where(:not(:has([class*=" text-"]), :not(:has([class^="text-"])))) h1 {
    font-size: var(--text-2xl);
    font-weight: var(--font-weight-medium);
    line-height: 1.5;
  }

  :where(:not(:has([class*=" text-"]), :not(:has([class^="text-"])))) h2 {
    font-size: var(--text-xl);
    font-weight: var(--font-weight-medium);
    line-height: 1.5;
  }

  :where(:not(:has([class*=" text-"]), :not(:has([class^="text-"])))) h3 {
    font-size: var(--text-lg);
    font-weight: var(--font-weight-medium);
    line-height: 1.5;
  }

  :where(:not(:has([class*=" text-"]), :not(:has([class^="text-"])))) h4 {
    font-size: var(--text-base);
    font-weight: var(--font-weight-medium);
    line-height: 1.5;
  }

  :where(:not(:has([class*=" text-"]), :not(:has([class^="text-"])))) p {
    font-size: var(--text-base);
    font-weight: var(--font-weight-normal);
    line-height: 1.5;
  }

  :where(:not(:has([class*=" text-"]), :not(:has([class^="text-"])))) label, :where(:not(:has([class*=" text-"]), :not(:has([class^="text-"])))) button {
    font-size: var(--text-base);
    font-weight: var(--font-weight-medium);
    line-height: 1.5;
  }

  :where(:not(:has([class*=" text-"]), :not(:has([class^="text-"])))) input {
    font-size: var(--text-base);
    font-weight: var(--font-weight-normal);
    line-height: 1.5;
  }
}

@layer utilities {
  .pointer-events-none {
    pointer-events: none;
  }

  .absolute {
    position: absolute;
  }

  .fixed {
    position: fixed;
  }

  .relative {
    position: relative;
  }

  .inset-0 {
    inset: calc(var(--spacing) * 0);
  }

  .top-1\/2 {
    top: 50%;
  }

  .right-8 {
    right: calc(var(--spacing) * 8);
  }

  .bottom-8 {
    bottom: calc(var(--spacing) * 8);
  }

  .bottom-full {
    bottom: 100%;
  }

  .-left-1 {
    left: calc(var(--spacing) * -1);
  }

  .left-1\/2 {
    left: 50%;
  }

  .left-2 {
    left: calc(var(--spacing) * 2);
  }

  .left-3 {
    left: calc(var(--spacing) * 3);
  }

  .z-10 {
    z-index: 10;
  }

  .z-50 {
    z-index: 50;
  }

  .mx-4 {
    margin-inline: calc(var(--spacing) * 4);
  }

  .mt-1 {
    margin-top: calc(var(--spacing) * 1);
  }

  .mt-2 {
    margin-top: calc(var(--spacing) * 2);
  }

  .mt-3 {
    margin-top: calc(var(--spacing) * 3);
  }

  .mr-1 {
    margin-right: calc(var(--spacing) * 1);
  }

  .mr-2 {
    margin-right: calc(var(--spacing) * 2);
  }

  .mb-1 {
    margin-bottom: calc(var(--spacing) * 1);
  }

  .mb-2 {
    margin-bottom: calc(var(--spacing) * 2);
  }

  .mb-3 {
    margin-bottom: calc(var(--spacing) * 3);
  }

  .mb-4 {
    margin-bottom: calc(var(--spacing) * 4);
  }

  .mb-6 {
    margin-bottom: calc(var(--spacing) * 6);
  }

  .mb-8 {
    margin-bottom: calc(var(--spacing) * 8);
  }

  .ml-0\.5 {
    margin-left: calc(var(--spacing) * .5);
  }

  .flex {
    display: flex;
  }

  .grid {
    display: grid;
  }

  .inline-block {
    display: inline-block;
  }

  .inline-flex {
    display: inline-flex;
  }

  .aspect-square {
    aspect-ratio: 1;
  }

  .size-2\.5 {
    width: calc(var(--spacing) * 2.5);
    height: calc(var(--spacing) * 2.5);
  }

  .size-3\.5 {
    width: calc(var(--spacing) * 3.5);
    height: calc(var(--spacing) * 3.5);
  }

  .size-4 {
    width: calc(var(--spacing) * 4);
    height: calc(var(--spacing) * 4);
  }

  .size-9 {
    width: calc(var(--spacing) * 9);
    height: calc(var(--spacing) * 9);
  }

  .h-1 {
    height: calc(var(--spacing) * 1);
  }

  .h-2 {
    height: calc(var(--spacing) * 2);
  }

  .h-3 {
    height: calc(var(--spacing) * 3);
  }

  .h-4 {
    height: calc(var(--spacing) * 4);
  }

  .h-5 {
    height: calc(var(--spacing) * 5);
  }

  .h-6 {
    height: calc(var(--spacing) * 6);
  }

  .h-7 {
    height: calc(var(--spacing) * 7);
  }

  .h-8 {
    height: calc(var(--spacing) * 8);
  }

  .h-9 {
    height: calc(var(--spacing) * 9);
  }

  .h-10 {
    height: calc(var(--spacing) * 10);
  }

  .h-12 {
    height: calc(var(--spacing) * 12);
  }

  .h-14 {
    height: calc(var(--spacing) * 14);
  }

  .h-64 {
    height: calc(var(--spacing) * 64);
  }

  .h-\[2px\] {
    height: 2px;
  }

  .h-full {
    height: 100%;
  }

  .h-screen {
    height: 100vh;
  }

  .max-h-32 {
    max-height: calc(var(--spacing) * 32);
  }

  .w-2 {
    width: calc(var(--spacing) * 2);
  }

  .w-3 {
    width: calc(var(--spacing) * 3);
  }

  .w-4 {
    width: calc(var(--spacing) * 4);
  }

  .w-5 {
    width: calc(var(--spacing) * 5);
  }

  .w-6 {
    width: calc(var(--spacing) * 6);
  }

  .w-8 {
    width: calc(var(--spacing) * 8);
  }

  .w-12 {
    width: calc(var(--spacing) * 12);
  }

  .w-14 {
    width: calc(var(--spacing) * 14);
  }

  .w-32 {
    width: calc(var(--spacing) * 32);
  }

  .w-60 {
    width: calc(var(--spacing) * 60);
  }

  .w-64 {
    width: calc(var(--spacing) * 64);
  }

  .w-\[72px\] {
    width: 72px;
  }

  .w-fit {
    width: fit-content;
  }

  .w-full {
    width: 100%;
  }

  .max-w-2xl {
    max-width: var(--container-2xl);
  }

  .min-w-0 {
    min-width: calc(var(--spacing) * 0);
  }

  .flex-1 {
    flex: 1;
  }

  .shrink-0 {
    flex-shrink: 0;
  }

  .origin-\(--radix-tooltip-content-transform-origin\) {
    transform-origin: var(--radix-tooltip-content-transform-origin);
  }

  .-translate-x-1\/2 {
    --tw-translate-x: calc(calc(1 / 2 * 100%) * -1);
    translate: var(--tw-translate-x) var(--tw-translate-y);
  }

  .-translate-y-1\/2 {
    --tw-translate-y: calc(calc(1 / 2 * 100%) * -1);
    translate: var(--tw-translate-x) var(--tw-translate-y);
  }

  .translate-y-\[calc\(-50\%_-_2px\)\] {
    --tw-translate-y: calc(-50% - 2px);
    translate: var(--tw-translate-x) var(--tw-translate-y);
  }

  .-rotate-90 {
    rotate: -90deg;
  }

  .rotate-45 {
    rotate: 45deg;
  }

  .transform {
    transform: var(--tw-rotate-x) var(--tw-rotate-y) var(--tw-rotate-z) var(--tw-skew-x) var(--tw-skew-y);
  }

  .animate-in {
    animation: enter var(--tw-duration, .15s) var(--tw-ease, ease);
  }

  .cursor-move {
    cursor: move;
  }

  .cursor-pointer {
    cursor: pointer;
  }

  .grid-cols-7 {
    grid-template-columns: repeat(7, minmax(0, 1fr));
  }

  .flex-col {
    flex-direction: column;
  }

  .items-baseline {
    align-items: baseline;
  }

  .items-center {
    align-items: center;
  }

  .justify-between {
    justify-content: space-between;
  }

  .justify-center {
    justify-content: center;
  }

  .justify-end {
    justify-content: flex-end;
  }

  .gap-1 {
    gap: calc(var(--spacing) * 1);
  }

  .gap-1\.5 {
    gap: calc(var(--spacing) * 1.5);
  }

  .gap-2 {
    gap: calc(var(--spacing) * 2);
  }

  .gap-3 {
    gap: calc(var(--spacing) * 3);
  }

  .gap-4 {
    gap: calc(var(--spacing) * 4);
  }

  .gap-8 {
    gap: calc(var(--spacing) * 8);
  }

  :where(.space-y-2 > :not(:last-child)) {
    --tw-space-y-reverse: 0;
    margin-block-start: calc(calc(var(--spacing) * 2) * var(--tw-space-y-reverse));
    margin-block-end: calc(calc(var(--spacing) * 2) * calc(1 - var(--tw-space-y-reverse)));
  }

  .overflow-hidden {
    overflow: hidden;
  }

  .overflow-y-auto {
    overflow-y: auto;
  }

  .rounded {
    border-radius: .25rem;
  }

  .rounded-\[2px\] {
    border-radius: 2px;
  }

  .rounded-\[4px\] {
    border-radius: 4px;
  }

  .rounded-\[16px\] {
    border-radius: 16px;
  }

  .rounded-\[24px\] {
    border-radius: 24px;
  }

  .rounded-full {
    border-radius: 3.40282e38px;
  }

  .rounded-lg {
    border-radius: var(--radius);
  }

  .rounded-md {
    border-radius: calc(var(--radius)  - 2px);
  }

  .rounded-sm {
    border-radius: calc(var(--radius)  - 4px);
  }

  .rounded-r-full {
    border-top-right-radius: 3.40282e38px;
    border-bottom-right-radius: 3.40282e38px;
  }

  .border {
    border-style: var(--tw-border-style);
    border-width: 1px;
  }

  .border-0 {
    border-style: var(--tw-border-style);
    border-width: 0;
  }

  .border-t-2 {
    border-top-style: var(--tw-border-style);
    border-top-width: 2px;
  }

  .border-r {
    border-right-style: var(--tw-border-style);
    border-right-width: 1px;
  }

  .border-b {
    border-bottom-style: var(--tw-border-style);
    border-bottom-width: 1px;
  }

  .border-l-2 {
    border-left-style: var(--tw-border-style);
    border-left-width: 2px;
  }

  .border-\[\#4f545c\] {
    border-color: #4f545c;
  }

  .border-\[\#5865F2\] {
    border-color: #5865f2;
  }

  .border-\[\#202225\] {
    border-color: #202225;
  }

  .border-\[\#ed4245\] {
    border-color: #ed4245;
  }

  .border-input {
    border-color: var(--input);
  }

  .bg-\[\#2f3136\] {
    background-color: #2f3136;
  }

  .bg-\[\#4f545c\] {
    background-color: #4f545c;
  }

  .bg-\[\#57F287\] {
    background-color: #57f287;
  }

  .bg-\[\#5865F2\] {
    background-color: #5865f2;
  }

  .bg-\[\#18191c\] {
    background-color: #18191c;
  }

  .bg-\[\#36393f\] {
    background-color: #36393f;
  }

  .bg-\[\#202225\] {
    background-color: #202225;
  }

  .bg-background {
    background-color: var(--background);
  }

  .bg-black\/70 {
    background-color: #000000b3;
  }

  @supports (color: color-mix(in lab, red, red)) {
    .bg-black\/70 {
      background-color: color-mix(in oklab, var(--color-black) 70%, transparent);
    }
  }

  .bg-destructive {
    background-color: var(--destructive);
  }

  .bg-input-background {
    background-color: var(--input-background);
  }

  .bg-primary {
    background-color: var(--primary);
  }

  .bg-secondary {
    background-color: var(--secondary);
  }

  .bg-transparent {
    background-color: #0000;
  }

  .bg-white {
    background-color: var(--color-white);
  }

  .fill-primary {
    fill: var(--primary);
  }

  .p-2 {
    padding: calc(var(--spacing) * 2);
  }

  .p-3 {
    padding: calc(var(--spacing) * 3);
  }

  .p-4 {
    padding: calc(var(--spacing) * 4);
  }

  .p-6 {
    padding: calc(var(--spacing) * 6);
  }

  .p-8 {
    padding: calc(var(--spacing) * 8);
  }

  .px-2 {
    padding-inline: calc(var(--spacing) * 2);
  }

  .px-3 {
    padding-inline: calc(var(--spacing) * 3);
  }

  .px-4 {
    padding-inline: calc(var(--spacing) * 4);
  }

  .px-6 {
    padding-inline: calc(var(--spacing) * 6);
  }

  .py-0\.5 {
    padding-block: calc(var(--spacing) * .5);
  }

  .py-1 {
    padding-block: calc(var(--spacing) * 1);
  }

  .py-1\.5 {
    padding-block: calc(var(--spacing) * 1.5);
  }

  .py-2 {
    padding-block: calc(var(--spacing) * 2);
  }

  .py-3 {
    padding-block: calc(var(--spacing) * 3);
  }

  .pl-3 {
    padding-left: calc(var(--spacing) * 3);
  }

  .pl-8 {
    padding-left: calc(var(--spacing) * 8);
  }

  .pl-10 {
    padding-left: calc(var(--spacing) * 10);
  }

  .text-center {
    text-align: center;
  }

  .text-2xl {
    font-size: var(--text-2xl);
    line-height: var(--tw-leading, var(--text-2xl--line-height));
  }

  .text-6xl {
    font-size: var(--text-6xl);
    line-height: var(--tw-leading, var(--text-6xl--line-height));
  }

  .text-base {
    font-size: var(--text-base);
    line-height: var(--tw-leading, var(--text-base--line-height));
  }

  .text-sm {
    font-size: var(--text-sm);
    line-height: var(--tw-leading, var(--text-sm--line-height));
  }

  .text-xs {
    font-size: var(--text-xs);
    line-height: var(--tw-leading, var(--text-xs--line-height));
  }

  .font-medium {
    --tw-font-weight: var(--font-weight-medium);
    font-weight: var(--font-weight-medium);
  }

  .tracking-wide {
    --tw-tracking: var(--tracking-wide);
    letter-spacing: var(--tracking-wide);
  }

  .text-balance {
    text-wrap: balance;
  }

  .whitespace-nowrap {
    white-space: nowrap;
  }

  .text-\[\#00b0f4\] {
    color: #00b0f4;
  }

  .text-\[\#4f545c\] {
    color: #4f545c;
  }

  .text-\[\#57F287\] {
    color: #57f287;
  }

  .text-\[\#5865F2\] {
    color: #5865f2;
  }

  .text-\[\#72767d\] {
    color: #72767d;
  }

  .text-\[\#b9bbbe\] {
    color: #b9bbbe;
  }

  .text-\[\#dcddde\] {
    color: #dcddde;
  }

  .text-\[\#ed4245\] {
    color: #ed4245;
  }

  .text-\[\#faa61a\] {
    color: #faa61a;
  }

  .text-current {
    color: currentColor;
  }

  .text-foreground {
    color: var(--foreground);
  }

  .text-primary {
    color: var(--primary);
  }

  .text-primary-foreground {
    color: var(--primary-foreground);
  }

  .text-secondary-foreground {
    color: var(--secondary-foreground);
  }

  .text-white {
    color: var(--color-white);
  }

  .uppercase {
    text-transform: uppercase;
  }

  .line-through {
    text-decoration-line: line-through;
  }

  .underline-offset-4 {
    text-underline-offset: 4px;
  }

  .opacity-0 {
    opacity: 0;
  }

  .opacity-50 {
    opacity: .5;
  }

  .opacity-60 {
    opacity: .6;
  }

  .opacity-70 {
    opacity: .7;
  }

  .shadow-2xl {
    --tw-shadow: 0 25px 50px -12px var(--tw-shadow-color, #00000040);
    box-shadow: var(--tw-inset-shadow), var(--tw-inset-ring-shadow), var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow);
  }

  .shadow-lg {
    --tw-shadow: 0 10px 15px -3px var(--tw-shadow-color, #0000001a), 0 4px 6px -4px var(--tw-shadow-color, #0000001a);
    box-shadow: var(--tw-inset-shadow), var(--tw-inset-ring-shadow), var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow);
  }

  .shadow-xs {
    --tw-shadow: 0 1px 2px 0 var(--tw-shadow-color, #0000000d);
    box-shadow: var(--tw-inset-shadow), var(--tw-inset-ring-shadow), var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow);
  }

  .outline {
    outline-style: var(--tw-outline-style);
    outline-width: 1px;
  }

  .filter {
    filter: var(--tw-blur, ) var(--tw-brightness, ) var(--tw-contrast, ) var(--tw-grayscale, ) var(--tw-hue-rotate, ) var(--tw-invert, ) var(--tw-saturate, ) var(--tw-sepia, ) var(--tw-drop-shadow, );
  }

  .backdrop-blur-sm {
    --tw-backdrop-blur: blur(var(--blur-sm));
    -webkit-backdrop-filter: var(--tw-backdrop-blur, ) var(--tw-backdrop-brightness, ) var(--tw-backdrop-contrast, ) var(--tw-backdrop-grayscale, ) var(--tw-backdrop-hue-rotate, ) var(--tw-backdrop-invert, ) var(--tw-backdrop-opacity, ) var(--tw-backdrop-saturate, ) var(--tw-backdrop-sepia, );
    backdrop-filter: var(--tw-backdrop-blur, ) var(--tw-backdrop-brightness, ) var(--tw-backdrop-contrast, ) var(--tw-backdrop-grayscale, ) var(--tw-backdrop-hue-rotate, ) var(--tw-backdrop-invert, ) var(--tw-backdrop-opacity, ) var(--tw-backdrop-saturate, ) var(--tw-backdrop-sepia, );
  }

  .transition-\[color\,box-shadow\] {
    transition-property: color, box-shadow;
    transition-timing-function: var(--tw-ease, var(--default-transition-timing-function));
    transition-duration: var(--tw-duration, var(--default-transition-duration));
  }

  .transition-all {
    transition-property: all;
    transition-timing-function: var(--tw-ease, var(--default-transition-timing-function));
    transition-duration: var(--tw-duration, var(--default-transition-duration));
  }

  .transition-colors {
    transition-property: color, background-color, border-color, outline-color, text-decoration-color, fill, stroke, --tw-gradient-from, --tw-gradient-via, --tw-gradient-to;
    transition-timing-function: var(--tw-ease, var(--default-transition-timing-function));
    transition-duration: var(--tw-duration, var(--default-transition-duration));
  }

  .transition-opacity {
    transition-property: opacity;
    transition-timing-function: var(--tw-ease, var(--default-transition-timing-function));
    transition-duration: var(--tw-duration, var(--default-transition-duration));
  }

  .transition-shadow {
    transition-property: box-shadow;
    transition-timing-function: var(--tw-ease, var(--default-transition-timing-function));
    transition-duration: var(--tw-duration, var(--default-transition-duration));
  }

  .transition-none {
    transition-property: none;
  }

  .duration-200 {
    --tw-duration: .2s;
    transition-duration: .2s;
  }

  .duration-1000 {
    --tw-duration: 1s;
    transition-duration: 1s;
  }

  .outline-none {
    --tw-outline-style: none;
    outline-style: none;
  }

  .fade-in-0 {
    --tw-enter-opacity: 0;
  }

  .zoom-in-95 {
    --tw-enter-scale: .95;
  }

  @media (hover: hover) {
    .group-hover\:text-\[\#72767d\]:is(:where(.group):hover *) {
      color: #72767d;
    }
  }

  @media (hover: hover) {
    .group-hover\:opacity-100:is(:where(.group):hover *) {
      opacity: 1;
    }
  }

  .selection\:bg-primary ::selection, .selection\:bg-primary::selection {
    background-color: var(--primary);
  }

  .selection\:text-primary-foreground ::selection, .selection\:text-primary-foreground::selection {
    color: var(--primary-foreground);
  }

  .file\:inline-flex::file-selector-button {
    display: inline-flex;
  }

  .file\:h-7::file-selector-button {
    height: calc(var(--spacing) * 7);
  }

  .file\:border-0::file-selector-button {
    border-style: var(--tw-border-style);
    border-width: 0;
  }

  .file\:bg-transparent::file-selector-button {
    background-color: #0000;
  }

  .file\:text-sm::file-selector-button {
    font-size: var(--text-sm);
    line-height: var(--tw-leading, var(--text-sm--line-height));
  }

  .file\:font-medium::file-selector-button {
    --tw-font-weight: var(--font-weight-medium);
    font-weight: var(--font-weight-medium);
  }

  .file\:text-foreground::file-selector-button {
    color: var(--foreground);
  }

  .placeholder\:text-\[\#72767d\]::placeholder {
    color: #72767d;
  }

  .placeholder\:text-muted-foreground::placeholder {
    color: var(--muted-foreground);
  }

  @media (hover: hover) {
    .hover\:scale-110:hover {
      --tw-scale-x: 110%;
      --tw-scale-y: 110%;
      --tw-scale-z: 110%;
      scale: var(--tw-scale-x) var(--tw-scale-y);
    }
  }

  @media (hover: hover) {
    .hover\:rounded-\[16px\]:hover {
      border-radius: 16px;
    }
  }

  @media (hover: hover) {
    .hover\:border-\[\#00b0f4\]:hover {
      border-color: #00b0f4;
    }
  }

  @media (hover: hover) {
    .hover\:bg-\[\#3ba55d\]:hover {
      background-color: #3ba55d;
    }
  }

  @media (hover: hover) {
    .hover\:bg-\[\#4f545c\]:hover {
      background-color: #4f545c;
    }
  }

  @media (hover: hover) {
    .hover\:bg-\[\#4752C4\]:hover {
      background-color: #4752c4;
    }
  }

  @media (hover: hover) {
    .hover\:bg-\[\#5865F2\]:hover {
      background-color: #5865f2;
    }
  }

  @media (hover: hover) {
    .hover\:bg-\[\#34373c\]:hover {
      background-color: #34373c;
    }
  }

  @media (hover: hover) {
    .hover\:bg-\[\#ed4245\]:hover {
      background-color: #ed4245;
    }
  }

  @media (hover: hover) {
    .hover\:bg-accent:hover {
      background-color: var(--accent);
    }
  }

  @media (hover: hover) {
    .hover\:bg-destructive\/90:hover {
      background-color: var(--destructive);
    }

    @supports (color: color-mix(in lab, red, red)) {
      .hover\:bg-destructive\/90:hover {
        background-color: color-mix(in oklab, var(--destructive) 90%, transparent);
      }
    }
  }

  @media (hover: hover) {
    .hover\:bg-primary\/90:hover {
      background-color: var(--primary);
    }

    @supports (color: color-mix(in lab, red, red)) {
      .hover\:bg-primary\/90:hover {
        background-color: color-mix(in oklab, var(--primary) 90%, transparent);
      }
    }
  }

  @media (hover: hover) {
    .hover\:bg-secondary\/80:hover {
      background-color: var(--secondary);
    }

    @supports (color: color-mix(in lab, red, red)) {
      .hover\:bg-secondary\/80:hover {
        background-color: color-mix(in oklab, var(--secondary) 80%, transparent);
      }
    }
  }

  @media (hover: hover) {
    .hover\:text-accent-foreground:hover {
      color: var(--accent-foreground);
    }
  }

  @media (hover: hover) {
    .hover\:text-white:hover {
      color: var(--color-white);
    }
  }

  @media (hover: hover) {
    .hover\:underline:hover {
      text-decoration-line: underline;
    }
  }

  .focus-visible\:border-ring:focus-visible {
    border-color: var(--ring);
  }

  .focus-visible\:ring-1:focus-visible {
    --tw-ring-shadow: var(--tw-ring-inset, ) 0 0 0 calc(1px + var(--tw-ring-offset-width)) var(--tw-ring-color, currentcolor);
    box-shadow: var(--tw-inset-shadow), var(--tw-inset-ring-shadow), var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow);
  }

  .focus-visible\:ring-\[3px\]:focus-visible {
    --tw-ring-shadow: var(--tw-ring-inset, ) 0 0 0 calc(3px + var(--tw-ring-offset-width)) var(--tw-ring-color, currentcolor);
    box-shadow: var(--tw-inset-shadow), var(--tw-inset-ring-shadow), var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow);
  }

  .focus-visible\:ring-\[\#00b0f4\]:focus-visible {
    --tw-ring-color: #00b0f4;
  }

  .focus-visible\:ring-destructive\/20:focus-visible {
    --tw-ring-color: var(--destructive);
  }

  @supports (color: color-mix(in lab, red, red)) {
    .focus-visible\:ring-destructive\/20:focus-visible {
      --tw-ring-color: color-mix(in oklab, var(--destructive) 20%, transparent);
    }
  }

  .focus-visible\:ring-ring\/50:focus-visible {
    --tw-ring-color: var(--ring);
  }

  @supports (color: color-mix(in lab, red, red)) {
    .focus-visible\:ring-ring\/50:focus-visible {
      --tw-ring-color: color-mix(in oklab, var(--ring) 50%, transparent);
    }
  }

  .disabled\:pointer-events-none:disabled {
    pointer-events: none;
  }

  .disabled\:cursor-not-allowed:disabled {
    cursor: not-allowed;
  }

  .disabled\:opacity-50:disabled {
    opacity: .5;
  }

  .has-\[\>svg\]\:px-2\.5:has( > svg) {
    padding-inline: calc(var(--spacing) * 2.5);
  }

  .has-\[\>svg\]\:px-3:has( > svg) {
    padding-inline: calc(var(--spacing) * 3);
  }

  .has-\[\>svg\]\:px-4:has( > svg) {
    padding-inline: calc(var(--spacing) * 4);
  }

  .aria-invalid\:border-destructive[aria-invalid="true"] {
    border-color: var(--destructive);
  }

  .aria-invalid\:ring-destructive\/20[aria-invalid="true"] {
    --tw-ring-color: var(--destructive);
  }

  @supports (color: color-mix(in lab, red, red)) {
    .aria-invalid\:ring-destructive\/20[aria-invalid="true"] {
      --tw-ring-color: color-mix(in oklab, var(--destructive) 20%, transparent);
    }
  }

  .data-\[side\=bottom\]\:slide-in-from-top-2[data-side="bottom"] {
    --tw-enter-translate-y: calc(2 * var(--spacing) * -1);
  }

  .data-\[side\=left\]\:slide-in-from-right-2[data-side="left"] {
    --tw-enter-translate-x: calc(2 * var(--spacing));
  }

  .data-\[side\=right\]\:slide-in-from-left-2[data-side="right"] {
    --tw-enter-translate-x: calc(2 * var(--spacing) * -1);
  }

  .data-\[side\=top\]\:slide-in-from-bottom-2[data-side="top"] {
    --tw-enter-translate-y: calc(2 * var(--spacing));
  }

  .data-\[state\=checked\]\:border-\[\#57F287\][data-state="checked"] {
    border-color: #57f287;
  }

  .data-\[state\=checked\]\:border-primary[data-state="checked"] {
    border-color: var(--primary);
  }

  .data-\[state\=checked\]\:bg-\[\#57F287\][data-state="checked"] {
    background-color: #57f287;
  }

  .data-\[state\=checked\]\:bg-primary[data-state="checked"] {
    background-color: var(--primary);
  }

  .data-\[state\=checked\]\:text-primary-foreground[data-state="checked"] {
    color: var(--primary-foreground);
  }

  .data-\[state\=closed\]\:animate-out[data-state="closed"] {
    animation: exit var(--tw-duration, .15s) var(--tw-ease, ease);
  }

  .data-\[state\=closed\]\:fade-out-0[data-state="closed"] {
    --tw-exit-opacity: 0;
  }

  .data-\[state\=closed\]\:zoom-out-95[data-state="closed"] {
    --tw-exit-scale: .95;
  }

  @media (width >= 48rem) {
    .md\:text-sm {
      font-size: var(--text-sm);
      line-height: var(--tw-leading, var(--text-sm--line-height));
    }
  }

  .dark\:border-input:is(.dark *) {
    border-color: var(--input);
  }

  .dark\:bg-destructive\/60:is(.dark *) {
    background-color: var(--destructive);
  }

  @supports (color: color-mix(in lab, red, red)) {
    .dark\:bg-destructive\/60:is(.dark *) {
      background-color: color-mix(in oklab, var(--destructive) 60%, transparent);
    }
  }

  .dark\:bg-input\/30:is(.dark *) {
    background-color: var(--input);
  }

  @supports (color: color-mix(in lab, red, red)) {
    .dark\:bg-input\/30:is(.dark *) {
      background-color: color-mix(in oklab, var(--input) 30%, transparent);
    }
  }

  @media (hover: hover) {
    .dark\:hover\:bg-accent\/50:is(.dark *):hover {
      background-color: var(--accent);
    }

    @supports (color: color-mix(in lab, red, red)) {
      .dark\:hover\:bg-accent\/50:is(.dark *):hover {
        background-color: color-mix(in oklab, var(--accent) 50%, transparent);
      }
    }
  }

  @media (hover: hover) {
    .dark\:hover\:bg-input\/50:is(.dark *):hover {
      background-color: var(--input);
    }

    @supports (color: color-mix(in lab, red, red)) {
      .dark\:hover\:bg-input\/50:is(.dark *):hover {
        background-color: color-mix(in oklab, var(--input) 50%, transparent);
      }
    }
  }

  .dark\:focus-visible\:ring-destructive\/40:is(.dark *):focus-visible {
    --tw-ring-color: var(--destructive);
  }

  @supports (color: color-mix(in lab, red, red)) {
    .dark\:focus-visible\:ring-destructive\/40:is(.dark *):focus-visible {
      --tw-ring-color: color-mix(in oklab, var(--destructive) 40%, transparent);
    }
  }

  .dark\:aria-invalid\:ring-destructive\/40:is(.dark *)[aria-invalid="true"] {
    --tw-ring-color: var(--destructive);
  }

  @supports (color: color-mix(in lab, red, red)) {
    .dark\:aria-invalid\:ring-destructive\/40:is(.dark *)[aria-invalid="true"] {
      --tw-ring-color: color-mix(in oklab, var(--destructive) 40%, transparent);
    }
  }

  .dark\:data-\[state\=checked\]\:bg-primary:is(.dark *)[data-state="checked"] {
    background-color: var(--primary);
  }

  .\[\&_svg\]\:pointer-events-none svg {
    pointer-events: none;
  }

  .\[\&_svg\]\:shrink-0 svg {
    flex-shrink: 0;
  }

  .\[\&_svg\:not\(\[class\*\=\'size-\'\]\)\]\:size-4 svg:not([class*="size-"]) {
    width: calc(var(--spacing) * 4);
    height: calc(var(--spacing) * 4);
  }
}

:root {
  --font-size: 16px;
  --background: #fff;
  --foreground: oklch(.145 0 0);
  --card: #fff;
  --card-foreground: oklch(.145 0 0);
  --popover: oklch(1 0 0);
  --popover-foreground: oklch(.145 0 0);
  --primary: #030213;
  --primary-foreground: oklch(1 0 0);
  --secondary: oklch(.95 .0058 264.53);
  --secondary-foreground: #030213;
  --muted: #ececf0;
  --muted-foreground: #717182;
  --accent: #e9ebef;
  --accent-foreground: #030213;
  --destructive: #d4183d;
  --destructive-foreground: #fff;
  --border: #0000001a;
  --input: transparent;
  --input-background: #f3f3f5;
  --switch-background: #cbced4;
  --font-weight-medium: 500;
  --font-weight-normal: 400;
  --ring: oklch(.708 0 0);
  --chart-1: oklch(.646 .222 41.116);
  --chart-2: oklch(.6 .118 184.704);
  --chart-3: oklch(.398 .07 227.392);
  --chart-4: oklch(.828 .189 84.429);
  --chart-5: oklch(.769 .188 70.08);
  --radius: .625rem;
  --sidebar: oklch(.985 0 0);
  --sidebar-foreground: oklch(.145 0 0);
  --sidebar-primary: #030213;
  --sidebar-primary-foreground: oklch(.985 0 0);
  --sidebar-accent: oklch(.97 0 0);
  --sidebar-accent-foreground: oklch(.205 0 0);
  --sidebar-border: oklch(.922 0 0);
  --sidebar-ring: oklch(.708 0 0);
}

.dark {
  --background: oklch(.145 0 0);
  --foreground: oklch(.985 0 0);
  --card: oklch(.145 0 0);
  --card-foreground: oklch(.985 0 0);
  --popover: oklch(.145 0 0);
  --popover-foreground: oklch(.985 0 0);
  --primary: oklch(.985 0 0);
  --primary-foreground: oklch(.205 0 0);
  --secondary: oklch(.269 0 0);
  --secondary-foreground: oklch(.985 0 0);
  --muted: oklch(.269 0 0);
  --muted-foreground: oklch(.708 0 0);
  --accent: oklch(.269 0 0);
  --accent-foreground: oklch(.985 0 0);
  --destructive: oklch(.396 .141 25.723);
  --destructive-foreground: oklch(.637 .237 25.331);
  --border: oklch(.269 0 0);
  --input: oklch(.269 0 0);
  --ring: oklch(.439 0 0);
  --font-weight-medium: 500;
  --font-weight-normal: 400;
  --chart-1: oklch(.488 .243 264.376);
  --chart-2: oklch(.696 .17 162.48);
  --chart-3: oklch(.769 .188 70.08);
  --chart-4: oklch(.627 .265 303.9);
  --chart-5: oklch(.645 .246 16.439);
  --sidebar: oklch(.205 0 0);
  --sidebar-foreground: oklch(.985 0 0);
  --sidebar-primary: oklch(.488 .243 264.376);
  --sidebar-primary-foreground: oklch(.985 0 0);
  --sidebar-accent: oklch(.269 0 0);
  --sidebar-accent-foreground: oklch(.985 0 0);
  --sidebar-border: oklch(.269 0 0);
  --sidebar-ring: oklch(.439 0 0);
}

html {
  font-size: var(--font-size);
}

@property --tw-translate-x {
  syntax: "*";
  inherits: false;
  initial-value: 0;
}

@property --tw-translate-y {
  syntax: "*";
  inherits: false;
  initial-value: 0;
}

@property --tw-translate-z {
  syntax: "*";
  inherits: false;
  initial-value: 0;
}

@property --tw-rotate-x {
  syntax: "*";
  inherits: false;
  initial-value: rotateX(0);
}

@property --tw-rotate-y {
  syntax: "*";
  inherits: false;
  initial-value: rotateY(0);
}

@property --tw-rotate-z {
  syntax: "*";
  inherits: false;
  initial-value: rotateZ(0);
}

@property --tw-skew-x {
  syntax: "*";
  inherits: false;
  initial-value: skewX(0);
}

@property --tw-skew-y {
  syntax: "*";
  inherits: false;
  initial-value: skewY(0);
}

@property --tw-space-y-reverse {
  syntax: "*";
  inherits: false;
  initial-value: 0;
}

@property --tw-border-style {
  syntax: "*";
  inherits: false;
  initial-value: solid;
}

@property --tw-font-weight {
  syntax: "*";
  inherits: false
}

@property --tw-tracking {
  syntax: "*";
  inherits: false
}

@property --tw-shadow {
  syntax: "*";
  inherits: false;
  initial-value: 0 0 #0000;
}

@property --tw-shadow-color {
  syntax: "*";
  inherits: false
}

@property --tw-shadow-alpha {
  syntax: "<percentage>";
  inherits: false;
  initial-value: 100%;
}

@property --tw-inset-shadow {
  syntax: "*";
  inherits: false;
  initial-value: 0 0 #0000;
}

@property --tw-inset-shadow-color {
  syntax: "*";
  inherits: false
}

@property --tw-inset-shadow-alpha {
  syntax: "<percentage>";
  inherits: false;
  initial-value: 100%;
}

@property --tw-ring-color {
  syntax: "*";
  inherits: false
}

@property --tw-ring-shadow {
  syntax: "*";
  inherits: false;
  initial-value: 0 0 #0000;
}

@property --tw-inset-ring-color {
  syntax: "*";
  inherits: false
}

@property --tw-inset-ring-shadow {
  syntax: "*";
  inherits: false;
  initial-value: 0 0 #0000;
}

@property --tw-ring-inset {
  syntax: "*";
  inherits: false
}

@property --tw-ring-offset-width {
  syntax: "<length>";
  inherits: false;
  initial-value: 0;
}

@property --tw-ring-offset-color {
  syntax: "*";
  inherits: false;
  initial-value: #fff;
}

@property --tw-ring-offset-shadow {
  syntax: "*";
  inherits: false;
  initial-value: 0 0 #0000;
}

@property --tw-outline-style {
  syntax: "*";
  inherits: false;
  initial-value: solid;
}

@property --tw-blur {
  syntax: "*";
  inherits: false
}

@property --tw-brightness {
  syntax: "*";
  inherits: false
}

@property --tw-contrast {
  syntax: "*";
  inherits: false
}

@property --tw-grayscale {
  syntax: "*";
  inherits: false
}

@property --tw-hue-rotate {
  syntax: "*";
  inherits: false
}

@property --tw-invert {
  syntax: "*";
  inherits: false
}

@property --tw-opacity {
  syntax: "*";
  inherits: false
}

@property --tw-saturate {
  syntax: "*";
  inherits: false
}

@property --tw-sepia {
  syntax: "*";
  inherits: false
}

@property --tw-drop-shadow {
  syntax: "*";
  inherits: false
}

@property --tw-drop-shadow-color {
  syntax: "*";
  inherits: false
}

@property --tw-drop-shadow-alpha {
  syntax: "<percentage>";
  inherits: false;
  initial-value: 100%;
}

@property --tw-drop-shadow-size {
  syntax: "*";
  inherits: false
}

@property --tw-backdrop-blur {
  syntax: "*";
  inherits: false
}

@property --tw-backdrop-brightness {
  syntax: "*";
  inherits: false
}

@property --tw-backdrop-contrast {
  syntax: "*";
  inherits: false
}

@property --tw-backdrop-grayscale {
  syntax: "*";
  inherits: false
}

@property --tw-backdrop-hue-rotate {
  syntax: "*";
  inherits: false
}

@property --tw-backdrop-invert {
  syntax: "*";
  inherits: false
}

@property --tw-backdrop-opacity {
  syntax: "*";
  inherits: false
}

@property --tw-backdrop-saturate {
  syntax: "*";
  inherits: false
}

@property --tw-backdrop-sepia {
  syntax: "*";
  inherits: false
}

@property --tw-duration {
  syntax: "*";
  inherits: false
}

@property --tw-scale-x {
  syntax: "*";
  inherits: false;
  initial-value: 1;
}

@property --tw-scale-y {
  syntax: "*";
  inherits: false;
  initial-value: 1;
}

@property --tw-scale-z {
  syntax: "*";
  inherits: false;
  initial-value: 1;
}

@keyframes enter {
  from {
    opacity: var(--tw-enter-opacity, 1);
    transform: translate3d(var(--tw-enter-translate-x, 0), var(--tw-enter-translate-y, 0), 0) scale3d(var(--tw-enter-scale, 1), var(--tw-enter-scale, 1), var(--tw-enter-scale, 1)) rotate(var(--tw-enter-rotate, 0));
  }
}

@keyframes exit {
  to {
    opacity: var(--tw-exit-opacity, 1);
    transform: translate3d(var(--tw-exit-translate-x, 0), var(--tw-exit-translate-y, 0), 0) scale3d(var(--tw-exit-scale, 1), var(--tw-exit-scale, 1), var(--tw-exit-scale, 1)) rotate(var(--tw-exit-rotate, 0));
  }
}


===== FILE: ./src\main.tsx =====


  // import { createRoot } from "react-dom/client";
  // import App from "./App.tsx";
  // import "./index.css";
  // import './worker/utils/dev-tools.ts'

  // createRoot(document.getElementById("root")!).render(<App />);
  

import React from 'react'
import ReactDOM from 'react-dom/client'
import App from './App.tsx'
import './index.css'
import './worker/utils/dev-tools' // ADD THIS LINE

ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <App />
  </React.StrictMode>,
)

===== FILE: ./src\styles\globals.css =====

@custom-variant dark (&:is(.dark *));

:root {
  --font-size: 16px;
  --background: #ffffff;
  --foreground: oklch(0.145 0 0);
  --card: #ffffff;
  --card-foreground: oklch(0.145 0 0);
  --popover: oklch(1 0 0);
  --popover-foreground: oklch(0.145 0 0);
  --primary: #030213;
  --primary-foreground: oklch(1 0 0);
  --secondary: oklch(0.95 0.0058 264.53);
  --secondary-foreground: #030213;
  --muted: #ececf0;
  --muted-foreground: #717182;
  --accent: #e9ebef;
  --accent-foreground: #030213;
  --destructive: #d4183d;
  --destructive-foreground: #ffffff;
  --border: rgba(0, 0, 0, 0.1);
  --input: transparent;
  --input-background: #f3f3f5;
  --switch-background: #cbced4;
  --font-weight-medium: 500;
  --font-weight-normal: 400;
  --ring: oklch(0.708 0 0);
  --chart-1: oklch(0.646 0.222 41.116);
  --chart-2: oklch(0.6 0.118 184.704);
  --chart-3: oklch(0.398 0.07 227.392);
  --chart-4: oklch(0.828 0.189 84.429);
  --chart-5: oklch(0.769 0.188 70.08);
  --radius: 0.625rem;
  --sidebar: oklch(0.985 0 0);
  --sidebar-foreground: oklch(0.145 0 0);
  --sidebar-primary: #030213;
  --sidebar-primary-foreground: oklch(0.985 0 0);
  --sidebar-accent: oklch(0.97 0 0);
  --sidebar-accent-foreground: oklch(0.205 0 0);
  --sidebar-border: oklch(0.922 0 0);
  --sidebar-ring: oklch(0.708 0 0);
}

.dark {
  --background: oklch(0.145 0 0);
  --foreground: oklch(0.985 0 0);
  --card: oklch(0.145 0 0);
  --card-foreground: oklch(0.985 0 0);
  --popover: oklch(0.145 0 0);
  --popover-foreground: oklch(0.985 0 0);
  --primary: oklch(0.985 0 0);
  --primary-foreground: oklch(0.205 0 0);
  --secondary: oklch(0.269 0 0);
  --secondary-foreground: oklch(0.985 0 0);
  --muted: oklch(0.269 0 0);
  --muted-foreground: oklch(0.708 0 0);
  --accent: oklch(0.269 0 0);
  --accent-foreground: oklch(0.985 0 0);
  --destructive: oklch(0.396 0.141 25.723);
  --destructive-foreground: oklch(0.637 0.237 25.331);
  --border: oklch(0.269 0 0);
  --input: oklch(0.269 0 0);
  --ring: oklch(0.439 0 0);
  --font-weight-medium: 500;
  --font-weight-normal: 400;
  --chart-1: oklch(0.488 0.243 264.376);
  --chart-2: oklch(0.696 0.17 162.48);
  --chart-3: oklch(0.769 0.188 70.08);
  --chart-4: oklch(0.627 0.265 303.9);
  --chart-5: oklch(0.645 0.246 16.439);
  --sidebar: oklch(0.205 0 0);
  --sidebar-foreground: oklch(0.985 0 0);
  --sidebar-primary: oklch(0.488 0.243 264.376);
  --sidebar-primary-foreground: oklch(0.985 0 0);
  --sidebar-accent: oklch(0.269 0 0);
  --sidebar-accent-foreground: oklch(0.985 0 0);
  --sidebar-border: oklch(0.269 0 0);
  --sidebar-ring: oklch(0.439 0 0);
}

@theme inline {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --color-card: var(--card);
  --color-card-foreground: var(--card-foreground);
  --color-popover: var(--popover);
  --color-popover-foreground: var(--popover-foreground);
  --color-primary: var(--primary);
  --color-primary-foreground: var(--primary-foreground);
  --color-secondary: var(--secondary);
  --color-secondary-foreground: var(--secondary-foreground);
  --color-muted: var(--muted);
  --color-muted-foreground: var(--muted-foreground);
  --color-accent: var(--accent);
  --color-accent-foreground: var(--accent-foreground);
  --color-destructive: var(--destructive);
  --color-destructive-foreground: var(--destructive-foreground);
  --color-border: var(--border);
  --color-input: var(--input);
  --color-input-background: var(--input-background);
  --color-switch-background: var(--switch-background);
  --color-ring: var(--ring);
  --color-chart-1: var(--chart-1);
  --color-chart-2: var(--chart-2);
  --color-chart-3: var(--chart-3);
  --color-chart-4: var(--chart-4);
  --color-chart-5: var(--chart-5);
  --radius-sm: calc(var(--radius) - 4px);
  --radius-md: calc(var(--radius) - 2px);
  --radius-lg: var(--radius);
  --radius-xl: calc(var(--radius) + 4px);
  --color-sidebar: var(--sidebar);
  --color-sidebar-foreground: var(--sidebar-foreground);
  --color-sidebar-primary: var(--sidebar-primary);
  --color-sidebar-primary-foreground: var(--sidebar-primary-foreground);
  --color-sidebar-accent: var(--sidebar-accent);
  --color-sidebar-accent-foreground: var(--sidebar-accent-foreground);
  --color-sidebar-border: var(--sidebar-border);
  --color-sidebar-ring: var(--sidebar-ring);
}

@layer base {
  * {
    @apply border-border outline-ring/50;
  }

  body {
    @apply bg-background text-foreground;
  }
}

/**
 * Base typography. This is not applied to elements which have an ancestor with a Tailwind text class.
 */
@layer base {
  :where(:not(:has([class*=' text-']), :not(:has([class^='text-'])))) {
    h1 {
      font-size: var(--text-2xl);
      font-weight: var(--font-weight-medium);
      line-height: 1.5;
    }

    h2 {
      font-size: var(--text-xl);
      font-weight: var(--font-weight-medium);
      line-height: 1.5;
    }

    h3 {
      font-size: var(--text-lg);
      font-weight: var(--font-weight-medium);
      line-height: 1.5;
    }

    h4 {
      font-size: var(--text-base);
      font-weight: var(--font-weight-medium);
      line-height: 1.5;
    }

    p {
      font-size: var(--text-base);
      font-weight: var(--font-weight-normal);
      line-height: 1.5;
    }

    label {
      font-size: var(--text-base);
      font-weight: var(--font-weight-medium);
      line-height: 1.5;
    }

    button {
      font-size: var(--text-base);
      font-weight: var(--font-weight-medium);
      line-height: 1.5;
    }

    input {
      font-size: var(--text-base);
      font-weight: var(--font-weight-normal);
      line-height: 1.5;
    }
  }
}

html {
  font-size: var(--font-size);
}


===== FILE: ./src\worker\api\remote-client.ts =====

/**
 * RemoteAPI Client
 * Handles communication with external backend API
 * Only used when online for GM validation, social features, etc.
 */

import type { Quest } from '../models/Quest';
import type { GMSuggestion } from '../models/GMSuggestion';

export interface ValidationResult {
  validatedDifficulty: string;
  confidence: number;
  reasoning: string;
  xpPerPomodoro: number;
  recommendations: string[];
}

export class RemoteAPI {
  private baseURL: string;
  private authToken: string | null = null;

  constructor(baseURL: string = import.meta.env.VITE_API_URL || 'https://api.ascend.app') {
    this.baseURL = baseURL;
  }

  /**
   * Set authentication token
   */
  setAuthToken(token: string): void {
    this.authToken = token;
  }

  /**
   * Check if online
   */
  isOnline(): boolean {
    return navigator.onLine;
  }

  /**
   * Validate quest difficulty with GM
   */
  async validateQuest(quest: Quest, userContext: any): Promise<ValidationResult> {
    if (!this.isOnline()) {
      throw new Error('Cannot validate quest while offline');
    }

    const response = await fetch(`${this.baseURL}/agent/validate-quest`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${this.authToken}`
      },
      body: JSON.stringify({
        questId: quest.questId,
        questData: {
          title: quest.title,
          description: quest.description,
          subtasks: quest.subtasks
        },
        userContext
      })
    });

    if (!response.ok) {
      throw new Error(`Validation failed: ${response.statusText}`);
    }

    return await response.json();
  }

  /**
   * Get GM suggestions
   */
  async getGMSuggestions(userId: string): Promise<GMSuggestion[]> {
    if (!this.isOnline()) {
      return []; // Return empty array if offline
    }

    const response = await fetch(`${this.baseURL}/gm/suggestions`, {
      method: 'GET',
      headers: {
        'Authorization': `Bearer ${this.authToken}`
      }
    });

    if (!response.ok) {
      throw new Error(`Failed to fetch suggestions: ${response.statusText}`);
    }

    const data = await response.json();
    return data.suggestions || [];
  }

  /**
   * Sync session to cloud
   */
  async syncSession(session: any): Promise<void> {
    if (!this.isOnline()) return;

    await fetch(`${this.baseURL}/sessions/${session.sessionId}`, {
      method: 'PUT',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${this.authToken}`
      },
      body: JSON.stringify(session)
    });
  }

  /**
   * Sync quest to cloud
   */
  async syncQuest(quest: Quest): Promise<void> {
    if (!this.isOnline()) return;

    await fetch(`${this.baseURL}/quests/${quest.questId}`, {
      method: 'PUT',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${this.authToken}`
      },
      body: JSON.stringify(quest)
    });
  }

  /**
   * Fetch public quests
   */
  async fetchPublicQuests(limit: number = 20): Promise<Quest[]> {
    if (!this.isOnline()) return [];

    const response = await fetch(`${this.baseURL}/quests?public=true&limit=${limit}`, {
      headers: {
        'Authorization': `Bearer ${this.authToken}`
      }
    });

    if (!response.ok) return [];

    const data = await response.json();
    return data.quests || [];
  }
}


===== FILE: ./src\worker\db\indexed-db.ts =====

/**
 * IndexedDB Wrapper for Worker Storage
 * Handles all local data persistence
 */

import Dexie, { Table } from 'dexie';

// Import types from models
import type { UserProfile } from '../models/UserProfile';
import type { Quest } from '../models/Quest';
import type { Session } from '../models/Session';
import type { TaskOrder } from '../models/TaskOrder';
import type { ActivityItem } from '../models/ActivityItem';
import type { AgentState } from '../models/AgentState';
import type { GoalComment } from '../models/GoalComment';
import type { Notification } from '../models/Notification';
import type { SyncOperation } from '../models/SyncOperation';

export class WorkerDB extends Dexie {
  // Tables
  users!: Table<UserProfile, string>;
  quests!: Table<Quest, string>;
  sessions!: Table<Session, string>;
  taskOrders!: Table<TaskOrder, string>;
  activityFeed!: Table<ActivityItem, string>;
  agentStates!: Table<AgentState, string>;
  comments!: Table<GoalComment, string>;
  notifications!: Table<Notification, string>;
  syncQueue!: Table<SyncOperation, string>;

  constructor() {
    super('AscendDB');
    
    this.version(3).stores({
      users: 'userId, username, totalLevel',
      quests: 'questId, ownerId, type, isPublic, isCompleted, [ownerId+isCompleted]',
      sessions: 'sessionId, userId, questId, startTime, status, [userId+startTime]',
      taskOrders: '[userId+questId], userId, lastUpdated',
      activityFeed: 'activityId, userId, type, timestamp, [userId+timestamp]',
      agentStates: 'userId, lastObservationTimestamp',
      comments: 'commentId, questId, userId, timestamp',
      notifications: 'notificationId, userId, isRead, createdAt, [userId+isRead]',
      syncQueue: 'id, timestamp, priority, [priority+timestamp]'
    });
  }

  /**
   * Get active quests for user
   */
  async getActiveQuests(userId: string): Promise<Quest[]> {
    console.log("In indexed-db, getActiveQuests", userId); 
    const quests = await this.quests
      .where('ownerId')
      .equals(userId) 
      // .where('[ownerId+isCompleted]')
      // .equals([userId, 0] as any) // 0 = false
      .toArray();
    console.log('User, quests', userId, quests);
    return quests.filter(q => q.isCompleted === false);
  }

  /**
   * Get sessions for date range
   */
  async getSessionsByDateRange(
    userId: string,
    startDate: string,
    endDate: string
  ): Promise<Session[]> {
    const start = new Date(startDate).getTime();
    const end = new Date(endDate).getTime();
    
    const sessions = await this.sessions
      .where('userId')
      .equals(userId) 
      // .where('[userId+startTime]')
      // .between([userId, new Date(start).toISOString()] as any, [userId, new Date(end).toISOString()] as any)
      .toArray();
    console.log('leavign getsessionsbydaterange'); 
    return sessions;
  }

  /**
   * Get today's sessions
   */
  async getTodaySessions(userId: string): Promise<Session[]> {
    const today = new Date().toISOString().split('T')[0];
    const tomorrow = new Date(Date.now() + 86400000).toISOString().split('T')[0];
    
    return await this.getSessionsByDateRange(userId, today, tomorrow);
  }

  /**
   * Get task order for quest
   */
  async getTaskOrder(userId: string, questId: string): Promise<TaskOrder | undefined> {
    const taskOrders = await this.taskOrders
      .where('userId').equals(userId)
      // .where('[userId+questId]')
      // .equals([userId, questId] as any)
      .first();
    console.log('leavign get task orders')
    return taskOrders;
  }

  /**
   * Upsert task order
   */
  async upsertTaskOrder(taskOrder: TaskOrder): Promise<void> {
    await this.taskOrders.put({
      ...taskOrder,
      lastUpdated: new Date().toISOString()
    });
  }

  /**
   * Add to sync queue
   */
  async queueSync(operation: Omit<SyncOperation, 'id' | 'timestamp'>): Promise<void> {
    const id = `${operation.collection}-${operation.documentId || Date.now()}`;
    
    await this.syncQueue.put({
      ...operation,
      id,
      timestamp: Date.now(),
      retries: 0,
      error: null
    } as SyncOperation);
  }

  /**
   * Get pending sync operations sorted by priority
   */
  async getPendingSyncOps(limit: number = 50): Promise<SyncOperation[]> {
    return await this.syncQueue
      .orderBy('[priority+timestamp]')
      .reverse() // High priority first
      .limit(limit)
      .toArray();
  }

  /**
   * Remove sync operation
   */
  async removeSyncOp(id: string): Promise<void> {
    await this.syncQueue.delete(id);
  }

  /**
   * Clear all data (for testing/reset)
   */
  async clearAll(): Promise<void> {
    await Promise.all([
      this.users.clear(),
      this.quests.clear(),
      this.sessions.clear(),
      this.taskOrders.clear(),
      this.activityFeed.clear(),
      this.agentStates.clear(),
      this.comments.clear(),
      this.notifications.clear(),
      this.syncQueue.clear()
    ]);
  }
}

// Singleton instance
let dbInstance: WorkerDB | null = null;

export function getDB(): WorkerDB {
  if (!dbInstance) {
    dbInstance = new WorkerDB();
  }
  return dbInstance;
}

===== FILE: ./src\worker\implementations\v01-home-quests.md =====


# Backend Worker Implementation v0.1-home-quests

**Timestamp**: 2025-01-15 16:30  
**Based on**: DeepSeek Handshake v0.1-home-quests-backend-analysis  
**Target**: `/src/worker/` integration into existing React project

---

## Summary of Changes

### New Modules Created:
- ‚úÖ **SessionService** - Pause/resume, quality calculation, XP tracking
- ‚úÖ **TaskService** - Smart sorting, reordering, bulk updates
- ‚úÖ **AnalyticsService** - Heatmap generation, today's metrics
- ‚úÖ **ActivityFeedService** - Feed aggregation from multiple sources
- ‚úÖ **SearchService** - Cross-entity search (quests + tasks)
- ‚úÖ **WorkerDB** - IndexedDB wrapper with all schemas
- ‚úÖ **SyncQueue** - Offline operation queueing with priorities
- ‚úÖ **RemoteAPI** - Client for external API calls (GM, social features)
- ‚úÖ **TaskSortingUtil** - Priority calculation algorithm

### Data Models Added:
- TaskOrder schema
- ActivityItem schema
- Session.pauseEvents field
- GMSuggestion interface

### Integration Points:
- FocusSessionModal ‚Üí SessionService
- MainPanel ‚Üí TaskService, AnalyticsService
- MiddlePanel ‚Üí ActivityFeedService, SearchService, RemoteAPI
- TaskList ‚Üí TaskService

---

## Code Files

### `/src/worker/db/indexed-db.ts`

```typescript
/**
 * IndexedDB Wrapper for Worker Storage
 * Handles all local data persistence
 */

import Dexie, { Table } from 'dexie';

// Import types from models
import type { UserProfile } from '../models/UserProfile';
import type { Quest } from '../models/Quest';
import type { Session } from '../models/Session';
import type { TaskOrder } from '../models/TaskOrder';
import type { ActivityItem } from '../models/ActivityItem';
import type { AgentState } from '../models/AgentState';
import type { GoalComment } from '../models/GoalComment';
import type { Notification } from '../models/Notification';
import type { SyncOperation } from '../models/SyncOperation';

export class WorkerDB extends Dexie {
  // Tables
  users!: Table<UserProfile, string>;
  quests!: Table<Quest, string>;
  sessions!: Table<Session, string>;
  taskOrders!: Table<TaskOrder, string>;
  activityFeed!: Table<ActivityItem, string>;
  agentStates!: Table<AgentState, string>;
  comments!: Table<GoalComment, string>;
  notifications!: Table<Notification, string>;
  syncQueue!: Table<SyncOperation, string>;

  constructor() {
    super('AscendDB');
    
    this.version(3).stores({
      users: 'userId, username, totalLevel',
      quests: 'questId, ownerId, type, isPublic, isCompleted, [ownerId+isCompleted]',
      sessions: 'sessionId, userId, questId, startTime, status, [userId+startTime]',
      taskOrders: '[userId+questId], userId, lastUpdated',
      activityFeed: 'activityId, userId, type, timestamp, [userId+timestamp]',
      agentStates: 'userId, lastObservationTimestamp',
      comments: 'commentId, questId, userId, timestamp',
      notifications: 'notificationId, userId, isRead, createdAt, [userId+isRead]',
      syncQueue: 'id, timestamp, priority, [priority+timestamp]'
    });
  }

  /**
   * Get active quests for user
   */
  async getActiveQuests(userId: string): Promise<Quest[]> {
    return await this.quests
      .where('[ownerId+isCompleted]')
      .equals([userId, 0]) // 0 = false
      .toArray();
  }

  /**
   * Get sessions for date range
   */
  async getSessionsByDateRange(
    userId: string,
    startDate: string,
    endDate: string
  ): Promise<Session[]> {
    const start = new Date(startDate).getTime();
    const end = new Date(endDate).getTime();
    
    return await this.sessions
      .where('[userId+startTime]')
      .between([userId, new Date(start).toISOString()], [userId, new Date(end).toISOString()])
      .toArray();
  }

  /**
   * Get today's sessions
   */
  async getTodaySessions(userId: string): Promise<Session[]> {
    const today = new Date().toISOString().split('T')[0];
    const tomorrow = new Date(Date.now() + 86400000).toISOString().split('T')[0];
    
    return await this.getSessionsByDateRange(userId, today, tomorrow);
  }

  /**
   * Get task order for quest
   */
  async getTaskOrder(userId: string, questId: string): Promise<TaskOrder | undefined> {
    return await this.taskOrders
      .where('[userId+questId]')
      .equals([userId, questId])
      .first();
  }

  /**
   * Upsert task order
   */
  async upsertTaskOrder(taskOrder: TaskOrder): Promise<void> {
    await this.taskOrders.put({
      ...taskOrder,
      lastUpdated: new Date().toISOString()
    });
  }

  /**
   * Add to sync queue
   */
  async queueSync(operation: Omit<SyncOperation, 'id' | 'timestamp'>): Promise<void> {
    const id = `${operation.collection}-${operation.documentId || Date.now()}`;
    
    await this.syncQueue.put({
      ...operation,
      id,
      timestamp: Date.now(),
      retries: 0,
      error: null
    } as SyncOperation);
  }

  /**
   * Get pending sync operations sorted by priority
   */
  async getPendingSyncOps(limit: number = 50): Promise<SyncOperation[]> {
    return await this.syncQueue
      .orderBy('[priority+timestamp]')
      .reverse() // High priority first
      .limit(limit)
      .toArray();
  }

  /**
   * Remove sync operation
   */
  async removeSyncOp(id: string): Promise<void> {
    await this.syncQueue.delete(id);
  }

  /**
   * Clear all data (for testing/reset)
   */
  async clearAll(): Promise<void> {
    await Promise.all([
      this.users.clear(),
      this.quests.clear(),
      this.sessions.clear(),
      this.taskOrders.clear(),
      this.activityFeed.clear(),
      this.agentStates.clear(),
      this.comments.clear(),
      this.notifications.clear(),
      this.syncQueue.clear()
    ]);
  }
}

// Singleton instance
let dbInstance: WorkerDB | null = null;

export function getDB(): WorkerDB {
  if (!dbInstance) {
    dbInstance = new WorkerDB();
  }
  return dbInstance;
}
```

---

### `/src/worker/models/TaskOrder.ts`

```typescript
/**
 * TaskOrder Model
 * Stores user's custom task ordering preferences
 */

export interface TaskOrder {
  userId: string;
  questId: string;
  taskOrder: string[]; // Array of subtaskIds in display order
  lastUpdated: string; // ISO8601
}
```

---

### `/src/worker/models/ActivityItem.ts`

```typescript
/**
 * ActivityItem Model
 * Unified activity feed item structure
 */

export type ActivityType = 
  | 'level_up'
  | 'quest_complete'
  | 'dungeon_clear'
  | 'comment'
  | 'streak_milestone'
  | 'achievement_unlock';

export interface ActivityItem {
  activityId: string;
  type: ActivityType;
  userId: string;
  username: string;
  timestamp: string; // ISO8601
  
  data: {
    level?: number;
    questId?: string;
    questTitle?: string;
    xpEarned?: number;
    dungeonId?: string;
    participants?: string[];
    fromUser?: string;
    preview?: string;
    streakDays?: number;
    achievementName?: string;
  };
  
  isRead?: boolean;
  priority?: 'low' | 'normal' | 'high';
}
```

---

### `/src/worker/models/SyncOperation.ts`

```typescript
/**
 * SyncOperation Model
 * Queued operations for offline sync
 */

export interface SyncOperation {
  id: string;
  operation: 'create' | 'update' | 'delete';
  collection: string;
  documentId: string;
  data: any;
  timestamp: number;
  priority: number; // 1-10 (10 = highest)
  retries: number;
  error: string | null;
}
```

---

### `/src/worker/models/GMSuggestion.ts`

```typescript
/**
 * GMSuggestion Model
 * AI-generated suggestions for user
 */

export interface GMSuggestion {
  suggestionId: string;
  type: 'recommendation' | 'nudge' | 'milestone' | 'warning';
  priority: 'low' | 'medium' | 'high' | 'critical';
  title: string;
  message: string;
  actions: Array<{
    label: string;
    action: string;
    params: any;
  }>;
  dismissible: boolean;
  createdAt: string;
  expiresAt: string | null;
}
```

---

### `/src/worker/services/session.service.ts`

```typescript
/**
 * SessionService
 * Handles session lifecycle, pause/resume, quality calculation
 */

import { getDB } from '../db/indexed-db';
import type { Session, PauseEvent } from '../models/Session';
import type { UserProfile } from '../models/UserProfile';
import type { Quest } from '../models/Quest';

export class SessionService {
  private db = getDB();

  /**
   * Create new session
   */
  async createSession(
    userId: string,
    questId: string,
    subtaskId: string | null,
    plannedDurationMin: number
  ): Promise<Session> {
    const session: Session = {
      sessionId: crypto.randomUUID(),
      userId,
      questId,
      subtaskId,
      startTime: new Date().toISOString(),
      endTime: null,
      plannedDurationMin,
      actualDurationMin: 0,
      status: 'active',
      pauseEvents: [],
      interruptions: [],
      quality: {
        score: 0,
        factors: {
          completionRate: 0,
          interruptionPenalty: 0,
          overtimeBonus: 0,
          consistencyBonus: 0
        }
      },
      xpEarned: 0,
      xpMultipliers: [],
      notes: null,
      tags: []
    };

    await this.db.sessions.add(session);
    
    // Queue for sync (priority 9 - active session)
    await this.db.queueSync({
      operation: 'create',
      collection: 'sessions',
      documentId: session.sessionId,
      data: session,
      priority: 9
    });

    return session;
  }

  /**
   * Pause active session
   */
  async pauseSession(sessionId: string): Promise<Session> {
    const session = await this.db.sessions.get(sessionId);
    
    if (!session) {
      throw new Error('Session not found');
    }
    
    if (session.status !== 'active') {
      throw new Error('Cannot pause non-active session');
    }

    const pauseEvent: PauseEvent = {
      timestamp: new Date().toISOString(),
      durationSec: 0, // Will be calculated on resume
      reason: null,
      wasAutomatic: false
    };

    session.status = 'paused';
    session.pauseEvents.push(pauseEvent);

    await this.db.sessions.update(sessionId, session);
    
    // Queue for sync (priority 9)
    await this.db.queueSync({
      operation: 'update',
      collection: 'sessions',
      documentId: sessionId,
      data: session,
      priority: 9
    });

    return session;
  }

  /**
   * Resume paused session
   */
  async resumeSession(sessionId: string): Promise<Session> {
    const session = await this.db.sessions.get(sessionId);
    
    if (!session) {
      throw new Error('Session not found');
    }
    
    if (session.status !== 'paused') {
      throw new Error('Cannot resume non-paused session');
    }

    // Calculate pause duration
    const lastPause = session.pauseEvents[session.pauseEvents.length - 1];
    const pauseDuration = Math.floor(
      (Date.now() - new Date(lastPause.timestamp).getTime()) / 1000
    );
    
    lastPause.durationSec = pauseDuration;

    // Add to interruptions
    session.interruptions.push({
      timestamp: lastPause.timestamp,
      durationSec: pauseDuration,
      reason: 'manual_pause'
    });

    session.status = 'active';

    await this.db.sessions.update(sessionId, session);
    
    await this.db.queueSync({
      operation: 'update',
      collection: 'sessions',
      documentId: sessionId,
      data: session,
      priority: 9
    });

    return session;
  }

  /**
   * Complete session and calculate XP
   */
  async completeSession(
    sessionId: string,
    actualDurationMin: number,
    notes?: string
  ): Promise<{
    session: Session;
    xpAwarded: number;
    qualityScore: number;
    levelUp: boolean | { newLevel: number; questId: string };
  }> {
    const session = await this.db.sessions.get(sessionId);
    if (!session) throw new Error('Session not found');

    const userProfile = await this.db.users.get(session.userId);
    if (!userProfile) throw new Error('User not found');

    const quest = await this.db.quests.get(session.questId);
    if (!quest) throw new Error('Quest not found');

    // Calculate quality score
    const qualityScore = this.calculateQuality(
      session,
      actualDurationMin,
      userProfile.streakData.currentStreak
    );

    // Calculate XP with quality multiplier
    const baseXP = quest.difficulty.xpPerPomodoro;
    const qualityMultiplier = qualityScore >= 50 ? 1.0 : 0.5;
    let xpEarned = Math.floor(baseXP * qualityMultiplier);

    // Apply additional multipliers
    if (quest.isTrackAligned) {
      xpEarned = Math.floor(xpEarned * 1.1);
    }
    if (quest.isDungeon) {
      xpEarned = Math.floor(xpEarned * 1.5);
    }

    // Update session
    session.status = 'completed';
    session.endTime = new Date().toISOString();
    session.actualDurationMin = actualDurationMin;
    session.xpEarned = xpEarned;
    session.notes = notes || null;
    session.quality = {
      score: qualityScore,
      factors: {
        completionRate: (actualDurationMin / session.plannedDurationMin) * 100,
        interruptionPenalty: this.calculateInterruptionPenalty(session),
        overtimeBonus: this.calculateOvertimeBonus(session, actualDurationMin),
        consistencyBonus: Math.min(10, (userProfile.streakData.currentStreak / 30) * 10)
      }
    };

    await this.db.sessions.update(sessionId, session);

    // Update quest XP
    quest.gamification.currentExp += xpEarned;
    quest.tracking.totalTrackedTime += actualDurationMin;
    quest.tracking.lastSessionAt = session.endTime;
    
    // Check for level up
    const levelUp = await this.checkQuestLevelUp(quest);

    await this.db.quests.update(quest.questId, quest);

    // Update user total XP
    userProfile.experiencePoints += xpEarned;
    await this.db.users.update(userProfile.userId, userProfile);

    // Queue for sync (priority 10 - completed session)
    await this.db.queueSync({
      operation: 'update',
      collection: 'sessions',
      documentId: sessionId,
      data: session,
      priority: 10
    });

    await this.db.queueSync({
      operation: 'update',
      collection: 'quests',
      documentId: quest.questId,
      data: quest,
      priority: 9
    });

    return {
      session,
      xpAwarded: xpEarned,
      qualityScore,
      levelUp
    };
  }

  /**
   * Calculate session quality score
   * Formula from SRS Section 6.2
   */
  private calculateQuality(
    session: Session,
    actualDurationMin: number,
    userStreak: number
  ): number {
    const { plannedDurationMin, pauseEvents } = session;

    // Base score from completion rate
    const completionRate = Math.min(actualDurationMin / plannedDurationMin, 1.5);
    let baseScore = 100 * completionRate;

    // Interruption penalty
    const totalPauseTime = pauseEvents.reduce((sum, p) => sum + p.durationSec, 0);
    const pauseTimePercent = (totalPauseTime / (plannedDurationMin * 60)) * 100;
    const interruptionPenalty = Math.min(50, pauseTimePercent);
    
    baseScore -= interruptionPenalty;

    // Overtime bonus
    const overtimePercent = Math.max(0, (actualDurationMin - plannedDurationMin) / plannedDurationMin);
    const overtimeBonus = Math.min(10, overtimePercent * 20);
    
    baseScore += overtimeBonus;

    // Consistency bonus
    const consistencyBonus = Math.min(10, (userStreak / 30) * 10);
    baseScore += consistencyBonus;

    // Clamp to 0-100
    return Math.max(0, Math.min(100, Math.round(baseScore)));
  }

  private calculateInterruptionPenalty(session: Session): number {
    const totalPauseTime = session.pauseEvents.reduce((sum, p) => sum + p.durationSec, 0);
    const pauseTimePercent = (totalPauseTime / (session.plannedDurationMin * 60)) * 100;
    return Math.min(50, pauseTimePercent);
  }

  private calculateOvertimeBonus(session: Session, actualDuration: number): number {
    const overtimePercent = Math.max(
      0,
      (actualDuration - session.plannedDurationMin) / session.plannedDurationMin
    );
    return Math.min(10, overtimePercent * 20);
  }

  private async checkQuestLevelUp(quest: Quest): Promise<boolean | { newLevel: number; questId: string }> {
    const { currentLevel, currentExp, expToNextLevel } = quest.gamification;
    
    if (currentExp >= expToNextLevel) {
      const newLevel = currentLevel + 1;
      const remainingExp = currentExp - expToNextLevel;
      
      // Calculate new exp requirement
      const baseExp = 500;
      const newExpToNextLevel = Math.floor(baseExp * Math.pow(1.5, newLevel));
      
      quest.gamification.currentLevel = newLevel;
      quest.gamification.currentExp = remainingExp;
      quest.gamification.expToNextLevel = newExpToNextLevel;
      
      // Log to progress history
      quest.progressHistory.push({
        date: new Date().toISOString().split('T')[0],
        completions: 0,
        expEarned: 0,
        timeSpentMin: 0,
        isMilestone: true,
        sessionsCompleted: 0
      });
      
      return { newLevel, questId: quest.questId };
    }
    
    return false;
  }

  /**
   * Abandon session (stopped early)
   */
  async abandonSession(sessionId: string): Promise<Session> {
    const session = await this.db.sessions.get(sessionId);
    if (!session) throw new Error('Session not found');

    session.status = 'abandoned';
    session.endTime = new Date().toISOString();
    session.xpEarned = 0; // No XP for abandoned sessions

    await this.db.sessions.update(sessionId, session);
    
    await this.db.queueSync({
      operation: 'update',
      collection: 'sessions',
      documentId: sessionId,
      data: session,
      priority: 7
    });

    return session;
  }

  /**
   * Get active session for user
   */
  async getActiveSession(userId: string): Promise<Session | null> {
    const sessions = await this.db.sessions
      .where('userId')
      .equals(userId)
      .and(s => s.status === 'active' || s.status === 'paused')
      .toArray();
    
    return sessions[0] || null;
  }
}
```

---

### `/src/worker/utils/task-sorting.util.ts`

```typescript
/**
 * Task Sorting Utilities
 * Implements smart sorting algorithm from SRS 11.2
 */

import type { Quest } from '../models/Quest';

/**
 * Calculate task priority based on multiple factors
 * Priority = (dueDate urgency √ó 0.4)
 *          + (schedule frequency √ó 0.3)
 *          + (last worked √ó 0.2)
 *          + (todo flag √ó 0.1)
 */
export function calculateTaskPriority(quest: Quest): number {
  let priority = 0;

  // Due date urgency (0-10)
  if (quest.dueDate) {
    const now = new Date();
    const due = new Date(quest.dueDate);
    const daysUntilDue = (due.getTime() - now.getTime()) / (1000 * 60 * 60 * 24);
    
    let urgency = 0;
    if (daysUntilDue < 0) urgency = 10; // Overdue
    else if (daysUntilDue < 1) urgency = 9;
    else if (daysUntilDue < 3) urgency = 7;
    else if (daysUntilDue < 7) urgency = 5;
    else urgency = 2;
    
    priority += urgency * 0.4;
  }

  // Schedule frequency (0-10)
  if (quest.schedule) {
    const frequencyScore: Record<string, number> = {
      'Daily': 10,
      'Weekly': 6,
      'Custom': 4
    };
    
    priority += (frequencyScore[quest.schedule.frequency] || 2) * 0.3;
  }

  // Last worked recency (0-10)
  if (quest.tracking?.lastSessionAt) {
    const lastWorked = new Date(quest.tracking.lastSessionAt);
    const daysSince = (Date.now() - lastWorked.getTime()) / (1000 * 60 * 60 * 24);
    
    let recencyScore = 0;
    if (daysSince > 7) recencyScore = 10;
    else if (daysSince > 3) recencyScore = 7;
    else if (daysSince > 1) recencyScore = 4;
    else recencyScore = 1;
    
    priority += recencyScore * 0.2;
  }

  // Todo flag boost
  if (quest.type === 'TodoQuest') {
    priority += 3 * 0.1;
  }

  return priority;
}

/**
 * Sort quests by calculated priority
 */
export function sortQuestsByPriority(quests: Quest[]): Quest[] {
  return quests.sort((a, b) => {
    const priorityA = calculateTaskPriority(a);
    const priorityB = calculateTaskPriority(b);
    return priorityB - priorityA; // Descending
  });
}
```

---

### `/src/worker/services/task.service.ts`

```typescript
/**
 * TaskService
 * Handles task ordering, smart sorting, bulk operations
 */

import { getDB } from '../db/indexed-db';
import { sortQuestsByPriority } from '../utils/task-sorting.util';
import type { Quest } from '../models/Quest';
import type { TaskOrder } from '../models/TaskOrder';

export class TaskService {
  private db = getDB();

  /**
   * Get today's tasks with smart sorting
   */
  async getTodaysTasks(userId: string): Promise<Quest[]> {
    // Fetch all active quests
    const quests = await this.db.getActiveQuests(userId);
    
    // Apply smart sorting
    const sorted = sortQuestsByPriority(quests);
    
    // Apply user's custom order if exists
    const customOrdered = await this.applyCustomOrder(userId, sorted);
    
    return customOrdered;
  }

  /**
   * Apply user's custom task ordering
   */
  private async applyCustomOrder(userId: string, quests: Quest[]): Promise<Quest[]> {
    const taskOrders = await this.db.taskOrders
      .where('userId')
      .equals(userId)
      .toArray();
    
    if (taskOrders.length === 0) {
      return quests;
    }

    // Create map of quest IDs to their custom orders
    const orderMap = new Map<string, number>();
    taskOrders.forEach(to => {
      const quest = quests.find(q => q.questId === to.questId);
      if (quest) {
        // Use task count as ordering weight
        orderMap.set(to.questId, to.taskOrder.length);
      }
    });

    // Sort by custom order where available
    return quests.sort((a, b) => {
      const orderA = orderMap.get(a.questId) || 999;
      const orderB = orderMap.get(b.questId) || 999;
      return orderA - orderB;
    });
  }

  /**
   * Update task order for a quest
   */
  async updateTaskOrder(
    userId: string,
    questId: string,
    taskOrder: string[]
  ): Promise<TaskOrder> {
    // Validate quest exists and user owns it
    const quest = await this.db.quests.get(questId);
    if (!quest || quest.ownerId !== userId) {
      throw new Error('Quest not found or access denied');
    }

    // Validate all task IDs exist in quest
    const validIds = new Set(quest.subtasks.map(st => st.id));
    const invalidIds = taskOrder.filter(id => !validIds.has(id));
    
    if (invalidIds.length > 0) {
      throw new Error(`Invalid subtask IDs: ${invalidIds.join(', ')}`);
    }

    const taskOrderDoc: TaskOrder = {
      userId,
      questId,
      taskOrder,
      lastUpdated: new Date().toISOString()
    };

    await this.db.upsertTaskOrder(taskOrderDoc);
    
    // Queue for sync (priority 8 - high)
    await this.db.queueSync({
      operation: 'update',
      collection: 'taskOrders',
      documentId: `${userId}-${questId}`,
      data: taskOrderDoc,
      priority: 8
    });

    return taskOrderDoc;
  }

  /**
   * Bulk update task completion status
   */
  async bulkUpdateTaskStatus(
    userId: string,
    updates: Array<{
      questId: string;
      subtaskId: string;
      isComplete: boolean;
    }>
  ): Promise<void> {
    for (const update of updates) {
      const quest = await this.db.quests.get(update.questId);
      if (!quest || quest.ownerId !== userId) continue;

      const subtask = quest.subtasks.find(st => st.id === update.subtaskId);
      if (!subtask) continue;

      subtask.isComplete = update.isComplete;
      subtask.completedAt = update.isComplete ? new Date().toISOString() : null;

      await this.db.quests.update(quest.questId, quest);
      
      // Queue for sync (priority 7)
      await this.db.queueSync({
        operation: 'update',
        collection: 'quests',
        documentId: quest.questId,
        data: quest,
        priority: 7
      });
    }
  }

  /**
   * Toggle subtask completion
   */
  async toggleSubtaskCompletion(
    userId: string,
    questId: string,
    subtaskId: string
  ): Promise<Quest> {
    const quest = await this.db.quests.get(questId);
    if (!quest || quest.ownerId !== userId) {
      throw new Error('Quest not found or access denied');
    }

    const subtask = quest.subtasks.find(st => st.id === subtaskId);
    if (!subtask) {
      throw new Error('Subtask not found');
    }

    subtask.isComplete = !subtask.isComplete;
    subtask.completedAt = subtask.isComplete ? new Date().toISOString() : null;

    await this.db.quests.update(questId, quest);
    
    await this.db.queueSync({
      operation: 'update',
      collection: 'quests',
      documentId: questId,
      data: quest,
      priority: 7
    });

    return quest;
  }
}
```

---

### `/src/worker/services/analytics.service.ts`

```typescript
/**
 * AnalyticsService
 * Generates analytics, heatmaps, and metrics
 */

import { getDB } from '../db/indexed-db';
import type { Session } from '../models/Session';

export interface HeatmapDay {
  date: string;
  count: number;
  intensity: number; // 0-4 for color coding
}

export interface TodayMetrics {
  xpEarned: number;
  sessionsCompleted: number;
  currentStreak: number;
  timeSpentMin: number;
}

export class AnalyticsService {
  private db = getDB();

  /**
   * Generate heatmap data for date range
   */
  async getHeatmapData(
    userId: string,
    startDate: string,
    endDate: string
  ): Promise<HeatmapDay[]> {
    // Fetch sessions in range
    const sessions = await this.db.getSessionsByDateRange(userId, startDate, endDate);

    // Group by date
    const dailyCounts = new Map<string, number>();
    
    sessions.forEach(session => {
      const date = session.startTime.split('T')[0];
      dailyCounts.set(date, (dailyCounts.get(date) || 0) + 1);
    });

    // Calculate intensity levels (0-4)
    const counts = Array.from(dailyCounts.values());
    const maxCount = Math.max(...counts, 1);
    
    // Fill in all dates in range with zero counts
    const start = new Date(startDate);
    const end = new Date(endDate);
    const heatmapData: HeatmapDay[] = [];
    
    for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
      const dateStr = d.toISOString().split('T')[0];
      const count = dailyCounts.get(dateStr) || 0;
      
      heatmapData.push({
        date: dateStr,
        count,
        intensity: Math.ceil((count / maxCount) * 4) // 0-4 scale
      });
    }

    return heatmapData;
  }

  /**
   * Get today's metrics for MainPanel stats
   */
  async getTodayMetrics(userId: string): Promise<TodayMetrics> {
    const sessions = await this.db.getTodaySessions(userId);
    
    // Calculate totals
    const xpEarned = sessions.reduce((sum, s) => sum + (s.xpEarned || 0), 0);
    const sessionsCompleted = sessions.filter(s => s.status === 'completed').length;
    const timeSpentMin = sessions.reduce((sum, s) => sum + s.actualDurationMin, 0);
    
    // Get current streak from user profile
    const userProfile = await this.db.users.get(userId);
    const currentStreak = userProfile?.streakData.currentStreak || 0;

    return {
      xpEarned,
      sessionsCompleted,
      currentStreak,
      timeSpentMin
    };
  }

  /**
   * Get session history for a quest
   */
  async getQuestSessions(questId: string, limit: number = 50): Promise<Session[]> {
    return await this.db.sessions
      .where('questId')
      .equals(questId)
      .reverse()
      .limit(limit)
      .toArray();
  }

  /**
   * Calculate velocity (XP per hour) for a quest
   */
  async calculateQuestVelocity(questId: string): Promise<number> {
    const sessions = await this.getQuestSessions(questId, 100);
    
    const totalXP = sessions.reduce((sum, s) => sum + (s.xpEarned || 0), 0);
    const totalTimeHours = sessions.reduce((sum, s) => sum + s.actualDurationMin, 0) / 60;
    
    return totalTimeHours > 0 ? totalXP / totalTimeHours : 0;
  }

  /**
   * Get average session quality for a quest
   */
  async getAverageQuality(questId: string): Promise<number> {
    const sessions = await this.getQuestSessions(questId);
    const completedSessions = sessions.filter(s => s.status === 'completed');
    
    if (completedSessions.length === 0) return 0;
    
    const totalQuality = completedSessions.reduce((sum, s) => sum + s.quality.score, 0);
    return Math.round(totalQuality / completedSessions.length);
  }
}
```

---

### `/src/worker/services/activity-feed.service.ts`

```typescript
/**
 * ActivityFeedService
 * Generates unified activity feed from multiple sources
 */

import { getDB } from '../db/indexed-db';
import type { ActivityItem, ActivityType } from '../models/ActivityItem';
import type { Quest } from '../models/Quest';

export class ActivityFeedService {
  private db = getDB();

  /**
   * Get unified activity feed
   */
  async getActivityFeed(
    userId: string,
    options: {
      limit?: number;
      types?: ActivityType[];
      includeWatched?: boolean;
    } = {}
  ): Promise<ActivityItem[]> {
    const {
      limit = 20,
      types = [],
      includeWatched = true
    } = options;

    // Fetch from local activity feed cache
    let activities = await this.db.activityFeed
      .where('userId')
      .equals(userId)
      .reverse()
      .sortBy('timestamp');

    // Generate activities from user's own data
    const userActivities = await this.generateUserActivities(userId);
    
    // Merge and deduplicate
    const allActivities = [...activities, ...userActivities];
    const uniqueActivities = this.deduplicateActivities(allActivities);

    // Filter by types if specified
    let filtered = types.length > 0
      ? uniqueActivities.filter(a => types.includes(a.type))
      : uniqueActivities;

    // Sort by timestamp descending
    filtered.sort((a, b) => 
      new Date(b.timestamp).getTime() - new Date(a.timestamp).getTime()
    );

    return filtered.slice(0, limit);
  }

  /**
   * Generate activities from user's quest progress
   */
  private async generateUserActivities(userId: string): Promise<ActivityItem[]> {
    const activities: ActivityItem[] = [];
    const userProfile = await this.db.users.get(userId);
    if (!userProfile) return activities;

    const quests = await this.db.quests
      .where('ownerId')
      .equals(userId)
      .toArray();

    for (const quest of quests) {
      // Check for recent level ups in progressHistory
      const recentHistory = quest.progressHistory
        .filter(h => h.isMilestone)
        .slice(-3); // Last 3 milestones

      for (const history of recentHistory) {
        activities.push({
          activityId: `${quest.questId}-level-${history.date}`,
          type: 'level_up',
          userId,
          username: userProfile.username,
          timestamp: history.date,
          data: {
            level: quest.gamification.currentLevel,
            questId: quest.questId,
            questTitle: quest.title
          }
        });
      }

      // Check for quest completion
      if (quest.isCompleted && quest.completedAt) {
        const completedRecently = this.isRecent(quest.completedAt, 7); // Last 7 days
        
        if (completedRecently) {
          activities.push({
            activityId: `${quest.questId}-complete`,
            type: 'quest_complete',
            userId,
            username: userProfile.username,
            timestamp: quest.completedAt,
            data: {
              questId: quest.questId,
              questTitle: quest.title,
              xpEarned: quest.gamification.currentExp
            }
          });
        }
      }
    }

    // Check for streak milestones
    const streak = userProfile.streakData.currentStreak;
    if ([7, 30, 100, 365].includes(streak)) {
      activities.push({
        activityId: `streak-${streak}`,
        type: 'streak_milestone',
        userId,
        username: userProfile.username,
        timestamp: new Date().toISOString(),
        data: {
          streakDays: streak
        }
      });
    }

    return activities;
  }

  /**
   * Deduplicate activities by ID
   */
  private deduplicateActivities(activities: ActivityItem[]): ActivityItem[] {
    const seen = new Set<string>();
    return activities.filter(activity => {
      if (seen.has(activity.activityId)) {
        return false;
      }
      seen.add(activity.activityId);
      return true;
    });
  }

  /**
   * Check if timestamp is within N days
   */
  private isRecent(timestamp: string, days: number): boolean {
    const date = new Date(timestamp);
    const now = new Date();
    const diffDays = (now.getTime() - date.getTime()) / (1000 * 60 * 60 * 24);
    return diffDays <= days;
  }

  /**
   * Add activity to feed (for caching)
   */
  async addActivity(activity: ActivityItem): Promise<void> {
    await this.db.activityFeed.add(activity);
  }
}
```

---

### `/src/worker/services/search.service.ts`

```typescript
/**
 * SearchService
 * Cross-entity search across quests and tasks
 */

import { getDB } from '../db/indexed-db';
import type { Quest } from '../models/Quest';

export interface SearchResult {
  id: string;
  type: 'quest' | 'task';
  title: string;
  description?: string;
  questId?: string;
  questTitle?: string;
  relevanceScore: number;
}

export class SearchService {
  private db = getDB();

  /**
   * Search across quests and tasks
   */
  async search(
    userId: string,
    query: string,
    options: {
      type?: 'quests' | 'tasks' | 'all';
      limit?: number;
      includePublic?: boolean;
    } = {}
  ): Promise<SearchResult[]> {
    const {
      type = 'all',
      limit = 20,
      includePublic = false
    } = options;

    const results: SearchResult[] = [];
    const lowerQuery = query.toLowerCase();

    // Search in quests
    if (type === 'all' || type === 'quests') {
      const questResults = await this.searchQuests(userId, lowerQuery, includePublic);
      results.push(...questResults);
    }

    // Search in tasks (subtasks)
    if (type === 'all' || type === 'tasks') {
      const taskResults = await this.searchTasks(userId, lowerQuery);
      results.push(...taskResults);
    }

    // Sort by relevance score
    results.sort((a, b) => b.relevanceScore - a.relevanceScore);

    return results.slice(0, limit);
  }

  /**
   * Search within quests
   */
  private async searchQuests(
    userId: string,
    query: string,
    includePublic: boolean
  ): Promise<SearchResult[]> {
    let quests: Quest[];

    if (includePublic) {
      quests = await this.db.quests
        .where('isPublic')
        .equals(1)
        .or('ownerId')
        .equals(userId)
        .toArray();
    } else {
      quests = await this.db.quests
        .where('ownerId')
        .equals(userId)
        .toArray();
    }

    return quests
      .map(quest => {
        const titleMatch = quest.title.toLowerCase().includes(query);
        const descMatch = quest.description.toLowerCase().includes(query);
        const tagMatch = quest.tags.some(tag => tag.toLowerCase().includes(query));

        // Calculate relevance score
        let score = 0;
        if (titleMatch) score += 10;
        if (descMatch) score += 5;
        if (tagMatch) score += 3;

        // Boost active quests
        if (!quest.isCompleted) score += 2;

        // Boost priority quests
        if (quest.priority === 'A') score += 2;
        else if (quest.priority === 'B') score += 1;

        if (score === 0) return null;

        return {
          id: quest.questId,
          type: 'quest' as const,
          title: quest.title,
          description: quest.description,
          relevanceScore: score
        };
      })
      .filter((result): result is SearchResult => result !== null);
  }

  /**
   * Search within subtasks
   */
  private async searchTasks(userId: string, query: string): Promise<SearchResult[]> {
    const quests = await this.db.quests
      .where('ownerId')
      .equals(userId)
      .toArray();

    const results: SearchResult[] = [];

    for (const quest of quests) {
      for (const subtask of quest.subtasks || []) {
        const match = subtask.title.toLowerCase().includes(query);
        
        if (match) {
          results.push({
            id: subtask.id,
            type: 'task',
            title: subtask.title,
            questId: quest.questId,
            questTitle: quest.title,
            relevanceScore: subtask.isComplete ? 3 : 8 // Boost incomplete
          });
        }
      }
    }

    return results;
  }
}
```

---

### `/src/worker/api/remote-client.ts`

```typescript
/**
 * RemoteAPI Client
 * Handles communication with external backend API
 * Only used when online for GM validation, social features, etc.
 */

import type { Quest } from '../models/Quest';
import type { GMSuggestion } from '../models/GMSuggestion';

export interface ValidationResult {
  validatedDifficulty: string;
  confidence: number;
  reasoning: string;
  xpPerPomodoro: number;
  recommendations: string[];
}

export class RemoteAPI {
  private baseURL: string;
  private authToken: string | null = null;

  constructor(baseURL: string = import.meta.env.VITE_API_URL || 'https://api.ascend.app') {
    this.baseURL = baseURL;
  }

  /**
   * Set authentication token
   */
  setAuthToken(token: string): void {
    this.authToken = token;
  }

  /**
   * Check if online
   */
  isOnline(): boolean {
    return navigator.onLine;
  }

  /**
   * Validate quest difficulty with GM
   */
  async validateQuest(quest: Quest, userContext: any): Promise<ValidationResult> {
    if (!this.isOnline()) {
      throw new Error('Cannot validate quest while offline');
    }

    const response = await fetch(`${this.baseURL}/agent/validate-quest`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${this.authToken}`
      },
      body: JSON.stringify({
        questId: quest.questId,
        questData: {
          title: quest.title,
          description: quest.description,
          subtasks: quest.subtasks
        },
        userContext
      })
    });

    if (!response.ok) {
      throw new Error(`Validation failed: ${response.statusText}`);
    }

    return await response.json();
  }

  /**
   * Get GM suggestions
   */
  async getGMSuggestions(userId: string): Promise<GMSuggestion[]> {
    if (!this.isOnline()) {
      return []; // Return empty array if offline
    }

    const response = await fetch(`${this.baseURL}/gm/suggestions`, {
      method: 'GET',
      headers: {
        'Authorization': `Bearer ${this.authToken}`
      }
    });

    if (!response.ok) {
      throw new Error(`Failed to fetch suggestions: ${response.statusText}`);
    }

    const data = await response.json();
    return data.suggestions || [];
  }

  /**
   * Sync session to cloud
   */
  async syncSession(session: any): Promise<void> {
    if (!this.isOnline()) return;

    await fetch(`${this.baseURL}/sessions/${session.sessionId}`, {
      method: 'PUT',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${this.authToken}`
      },
      body: JSON.stringify(session)
    });
  }

  /**
   * Sync quest to cloud
   */
  async syncQuest(quest: Quest): Promise<void> {
    if (!this.isOnline()) return;

    await fetch(`${this.baseURL}/quests/${quest.questId}`, {
      method: 'PUT',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${this.authToken}`
      },
      body: JSON.stringify(quest)
    });
  }

  /**
   * Fetch public quests
   */
  async fetchPublicQuests(limit: number = 20): Promise<Quest[]> {
    if (!this.isOnline()) return [];

    const response = await fetch(`${this.baseURL}/quests?public=true&limit=${limit}`, {
      headers: {
        'Authorization': `Bearer ${this.authToken}`
      }
    });

    if (!response.ok) return [];

    const data = await response.json();
    return data.quests || [];
  }
}
```

---

### `/src/worker/sync/sync-queue.ts`

```typescript
/**
 * SyncQueue Manager
 * Handles offline operation queueing and background sync
 */

import { getDB } from '../db/indexed-db';
import { RemoteAPI } from '../api/remote-client';
import type { SyncOperation } from '../models/SyncOperation';

export class SyncQueue {
  private db = getDB();
  private remoteAPI: RemoteAPI;
  private isProcessing = false;
  private syncInterval: number | null = null;

  constructor(remoteAPI: RemoteAPI) {
    this.remoteAPI = remoteAPI;
  }

  /**
   * Start background sync (every 5 minutes when online)
   */
  startBackgroundSync(): void {
    if (this.syncInterval) return;

    this.syncInterval = window.setInterval(() => {
      if (navigator.onLine && !this.isProcessing) {
        this.processQueue();
      }
    }, 5 * 60 * 1000); // 5 minutes

    // Also sync on network reconnection
    window.addEventListener('online', () => {
      this.processQueue();
    });
  }

  /**
   * Stop background sync
   */
  stopBackgroundSync(): void {
    if (this.syncInterval) {
      clearInterval(this.syncInterval);
      this.syncInterval = null;
    }
  }

  /**
   * Process sync queue
   */
  async processQueue(): Promise<void> {
    if (this.isProcessing) return;
    if (!navigator.onLine) return;

    this.isProcessing = true;

    try {
      const operations = await this.db.getPendingSyncOps(50);

      for (const op of operations) {
        try {
          await this.syncOperation(op);
          await this.db.removeSyncOp(op.id);
        } catch (error) {
          console.error(`Sync failed for operation ${op.id}:`, error);
          
          // Increment retry count
          op.retries += 1;
          op.error = error instanceof Error ? error.message : 'Unknown error';
          
          if (op.retries >= 5) {
            // Max retries reached, log and remove
            console.error(`Max retries reached for operation ${op.id}`);
            await this.db.removeSyncOp(op.id);
          } else {
            // Update with error info
            await this.db.syncQueue.update(op.id, op);
          }
        }
      }
    } finally {
      this.isProcessing = false;
    }
  }

  /**
   * Sync single operation to remote
   */
  private async syncOperation(op: SyncOperation): Promise<void> {
    switch (op.collection) {
      case 'sessions':
        await this.remoteAPI.syncSession(op.data);
        break;
      
      case 'quests':
        await this.remoteAPI.syncQuest(op.data);
        break;
      
      case 'taskOrders':
        // Task orders are local-only for now
        break;
      
      default:
        console.warn(`Unknown collection: ${op.collection}`);
    }
  }

  /**
   * Get pending operation count
   */
  async getPendingCount(): Promise<number> {
    return await this.db.syncQueue.count();
  }

  /**
   * Clear all queued operations (for testing)
   */
  async clearQueue(): Promise<void> {
    await this.db.syncQueue.clear();
  }
}
```

---

### `/src/worker/index.ts`

```typescript
/**
 * Worker Entry Point
 * Exports all services for use in UI components
 */

export { SessionService } from './services/session.service';
export { TaskService } from './services/task.service';
export { AnalyticsService } from './services/analytics.service';
export { ActivityFeedService } from './services/activity-feed.service';
export { SearchService } from './services/search.service';
export { RemoteAPI } from './api/remote-client';
export { SyncQueue } from './sync/sync-queue';
export { getDB, WorkerDB } from './db/indexed-db';

// Export utilities
export { calculateTaskPriority, sortQuestsByPriority } from './utils/task-sorting.util';

// Export types
export type { HeatmapDay, TodayMetrics } from './services/analytics.service';
export type { SearchResult } from './services/search.service';
export type { ValidationResult } from './api/remote-client';
```

---

## Integration Notes

### 1. **FocusSessionModal Integration**

```typescript
// In FocusSessionModal.tsx
import { SessionService } from '@/worker';

const sessionService = new SessionService();

// Start session
const handleStartSession = async () => {
  const session = await sessionService.createSession(
    userId,
    selectedQuest.questId,
    selectedSubtask?.id || null,
    25 // duration in minutes
  );
  setCurrentSession(session);
};

// Pause session
const handlePause = async () => {
  if (!currentSession) return;
  const updated = await sessionService.pauseSession(currentSession.sessionId);
  setCurrentSession(updated);
};

// Resume session
const handleResume = async () => {
  if (!currentSession) return;
  const updated = await sessionService.resumeSession(currentSession.sessionId);
  setCurrentSession(updated);
};

// Complete session
const handleComplete = async (actualMinutes: number) => {
  if (!currentSession) return;
  
  const result = await sessionService.completeSession(
    currentSession.sessionId,
    actualMinutes,
    notes
  );
  
  // Show XP gained
  showNotification(`+${result.xpAwarded} XP earned!`);
  
  // Check for level up
  if (result.levelUp && typeof result.levelUp === 'object') {
    showNotification(`Level Up! Now level ${result.levelUp.newLevel}`);
  }
};
```

---

### 2. **MainPanel Integration**

```typescript
// In MainPanel.tsx
import { TaskService, AnalyticsService } from '@/worker';

const taskService = new TaskService();
const analyticsService = new AnalyticsService();

// Fetch today's tasks
const loadTasks = async () => {
  const tasks = await taskService.getTodaysTasks(userId);
  setTasks(tasks);
};

// Fetch today's metrics
const loadMetrics = async () => {
  const metrics = await analyticsService.getTodayMetrics(userId);
  setMetrics(metrics);
};

// Fetch heatmap
const loadHeatmap = async () => {
  const endDate = new Date().toISOString().split('T')[0];
  const startDate = new Date(Date.now() - 90 * 86400000).toISOString().split('T')[0];
  
  const heatmap = await analyticsService.getHeatmapData(userId, startDate, endDate);
  setHeatmapData(heatmap);
};

useEffect(() => {
  loadTasks();
  loadMetrics();
  loadHeatmap();
}, [userId]);
```

---

### 3. **TaskList Integration**

```typescript
// In TaskList.tsx
import { TaskService } from '@/worker';

const taskService = new TaskService();

// Handle drag-and-drop reorder
const handleReorder = async (questId: string, newOrder: string[]) => {
  // Optimistic UI update
  setTasks(reorderedTasks);
  
  // Persist to worker (will queue for sync)
  try {
    await taskService.updateTaskOrder(userId, questId, newOrder);
  } catch (error) {
    // Revert on error
    setTasks(originalTasks);
    showError('Failed to save order');
  }
};

// Toggle task completion
const handleToggle = async (questId: string, subtaskId: string) => {
  const updated = await taskService.toggleSubtaskCompletion(userId, questId, subtaskId);
  // Update local state
  updateQuestInList(updated);
};
```

---

### 4. **MiddlePanel Integration**

```typescript
// In MiddlePanel.tsx
import { ActivityFeedService, SearchService, RemoteAPI } from '@/worker';

const activityService = new ActivityFeedService();
const searchService = new SearchService();
const remoteAPI = new RemoteAPI();

// Load activity feed
const loadActivityFeed = async () => {
  const activities = await activityService.getActivityFeed(userId, {
    limit: 10,
    includeWatched: true
  });
  setActivities(activities);
};

// Handle search
const handleSearch = async (query: string) => {
  if (query.length < 2) {
    setSearchResults([]);
    return;
  }
  
  const results = await searchService.search(userId, query, {
    type: 'all',
    limit: 20
  });
  setSearchResults(results);
};

// Load GM suggestions (requires online)
const loadGMSuggestions = async () => {
  try {
    const suggestions = await remoteAPI.getGMSuggestions(userId);
    setSuggestions(suggestions);
  } catch (error) {
    // Offline or failed, show cached suggestions
    console.log('GM suggestions unavailable offline');
  }
};
```

---

### 5. **App-level Sync Initialization**

```typescript
// In App.tsx or main.tsx
import { RemoteAPI, SyncQueue } from '@/worker';

// Initialize once at app startup
const remoteAPI = new RemoteAPI();
const syncQueue = new SyncQueue(remoteAPI);

// Set auth token after login
const handleLogin = (token: string) => {
  remoteAPI.setAuthToken(token);
  
  // Start background sync
  syncQueue.startBackgroundSync();
};

// Cleanup on unmount
useEffect(() => {
  return () => {
    syncQueue.stopBackgroundSync();
  };
}, []);
```

---

## Database Schema Summary

All schemas are handled in `/src/worker/db/indexed-db.ts`:

- ‚úÖ `users` - UserProfile
- ‚úÖ `quests` - Quest documents
- ‚úÖ `sessions` - Session records with pauseEvents
- ‚úÖ `taskOrders` - Custom task ordering
- ‚úÖ `activityFeed` - Cached activity items
- ‚úÖ `agentStates` - GM agent state
- ‚úÖ `comments` - Quest comments
- ‚úÖ `notifications` - User notifications
- ‚úÖ `syncQueue` - Pending sync operations

---

## Next Steps

1. **Install Dexie.js**:
   ```bash
   npm install dexie
   ```

2. **Add environment variable** for API URL:
   ```env
   VITE_API_URL=https://api.ascend.app
   ```

3. **Import worker services** in your components as shown in integration notes

4. **Test offline functionality** by disabling network in DevTools

5. **Monitor sync queue** with:
   ```typescript
   const pendingCount = await syncQueue.getPendingCount();
   console.log(`${pendingCount} operations pending sync`);
   ```

---

## All Files Complete

- ‚úÖ No placeholder code
- ‚úÖ No Express/NestJS
- ‚úÖ No HTTP endpoints
- ‚úÖ Pure TypeScript modules
- ‚úÖ IndexedDB for local storage
- ‚úÖ Offline-first with sync queue
- ‚úÖ Remote API client for online features
- ‚úÖ All business logic implemented
- ‚úÖ Ready for integration into React components

**Status: Implementation complete. Ready for testing.**



===== FILE: ./src\worker\index.ts =====

/**
 * Worker Entry Point
 * Exports all services for use in UI components
 */

export { SessionService } from './services/session.service';
export { TaskService } from './services/task.service';
export { AnalyticsService } from './services/analytics.service';
export { ActivityFeedService } from './services/activity-feed.service';
export { SearchService } from './services/search.service';
export { RemoteAPI } from './api/remote-client';
export { SyncQueue } from './sync/sync-queue';
export { getDB, WorkerDB } from './db/indexed-db';
export { SeedService } from './services/seed.service'; // NEW
export { AuthService } from './services/auth.service'; // NEW
export { QuestUIAdapter } from './services/quest-ui-adapter.service';
export { QuestService } from './services/quest.service';
export { NotificationService } from './services/notification.service';

// Export utilities
export { calculateTaskPriority, sortQuestsByPriority } from './utils/task-sorting.util';

// Export types
export type { HeatmapDay, TodayMetrics } from './services/analytics.service';
export type { SearchResult } from './services/search.service';
export type { ValidationResult } from './api/remote-client';

===== FILE: ./src\worker\models\ActivityItem.ts =====

/**
 * ActivityItem Model
 * Unified activity feed item structure
 */

export type ActivityType = 
  | 'level_up'
  | 'quest_complete'
  | 'dungeon_clear'
  | 'comment'
  | 'streak_milestone'
  | 'achievement_unlock';

export interface ActivityItem {
  activityId: string;
  type: ActivityType;
  userId: string;
  username: string;
  timestamp: string; // ISO8601
  
  data: {
    level?: number;
    questId?: string;
    questTitle?: string;
    xpEarned?: number;
    dungeonId?: string;
    participants?: string[];
    fromUser?: string;
    preview?: string;
    streakDays?: number;
    achievementName?: string;
  };
  
  isRead?: boolean;
  priority?: 'low' | 'normal' | 'high';
}


===== FILE: ./src\worker\models\AgentState.ts =====

/**
 * AgentState Model
 * GM/Agent state structure from SRS Section 4.6
 */

export interface AgentState {
  userId: string;
  lastObservationTimestamp: string; // ISO8601
  
  patterns: Pattern[];
  
  recommendedQuestAdjustments: QuestAdjustment[];
  
  motivationalProfile: {
    tone: 'firm' | 'gentle' | 'neutral';
    preferredFeedbackFrequency: 'high' | 'medium' | 'low';
    respondsWellTo: string[];
  };
  
  pendingActions: PendingAction[];
  
  performanceMetrics: {
    weeklyVelocity: number;
    monthlyConsistency: number;
    burnoutRisk: number; // 0-100
    optimizationOpportunities: string[];
  };
}

export interface Pattern {
  name: string;
  category: 'productivity' | 'behavior' | 'risk';
  confidence: number; // 0-1
  detail: string;
  detectedAt: string; // ISO8601
  severity: 'info' | 'warning' | 'critical';
}

export interface QuestAdjustment {
  questId: string;
  suggestionText: string;
  actionType: 'adjust_schedule' | 'suggest_buff' | 'create_subtask' | 'reduce_difficulty' | 'rest_recommendation';
  params: Record<string, any>;
  priority: number;
  createdAt: string; // ISO8601
}

export interface PendingAction {
  id: string;
  trigger: string;
  payload: Record<string, any>;
  createdAt: string; // ISO8601
}

===== FILE: ./src\worker\models\AnalyticsSummary.ts =====

/**
 * AnalyticsSummary Model
 * Analytics data structure from SRS Section 4.8
 */

export interface AnalyticsSummary {
  userId: string;
  period: 'daily' | 'weekly' | 'monthly';
  startDate: string; // YYYY-MM-DD
  endDate: string; // YYYY-MM-DD
  
  metrics: {
    totalSessions: number;
    totalPomodoros: number;
    totalTimeMin: number;
    totalXpEarned: number;
    
    averageSessionQuality: number; // 0-100
    consistencyScore: number; // 0-100
    questVelocity: number; // XP/hour
    
    levelGained: number;
    xpRise: number;
    xpRisePercent: number;
  };
  
  breakdown: {
    byDay: DayBreakdown[];
    byQuest: QuestBreakdown[];
  };
  
  streakInfo: {
    current: number;
    longest: number;
    daysActive: number;
    daysInPeriod: number;
  };
  
  generatedAt: string; // ISO8601
}

export interface DayBreakdown {
  date: string; // YYYY-MM-DD
  sessions: number;
  xp: number;
  timeMin: number;
}

export interface QuestBreakdown {
  questId: string;
  questTitle: string;
  sessions: number;
  xp: number;
  timeMin: number;
  percentOfTotal: number;
}

===== FILE: ./src\worker\models\DungeonMemberProgress.ts =====

/**
 * DungeonMemberProgress Model
 * Dungeon member tracking from SRS Section 4.4
 */

export interface DungeonMemberProgress {
  progressId: string;
  dungeonId: string; // questId
  userId: string;
  
  completedSubtasks: string[]; // subtaskIds
  pomodorosCompleted: number;
  sessionsCompleted: number;
  totalTimeSpentMin: number;
  
  expEarned: number;
  contributionPercent: number; // 0-100
  
  status: 'active' | 'completed' | 'failed';
  joinedAt: string; // ISO8601
  lastUpdated: string; // ISO8601
  
  performance: {
    averageSessionQuality: number;
    consistencyScore: number;
    velocityRank: number; // 1-N
  };
}

===== FILE: ./src\worker\models\GMSuggestion.ts =====

/**
 * GMSuggestion Model
 * AI-generated suggestions for user
 */

export interface GMSuggestion {
  suggestionId: string;
  type: 'recommendation' | 'nudge' | 'milestone' | 'warning';
  priority: 'low' | 'medium' | 'high' | 'critical';
  title: string;
  message: string;
  actions: Array<{
    label: string;
    action: string;
    params: any;
  }>;
  dismissible: boolean;
  createdAt: string;
  expiresAt: string | null;
}

===== FILE: ./src\worker\models\GoalComment.ts =====

/**
 * GoalComment Model
 * Comment structure from SRS Section 4.7
 */

export interface GoalComment {
  commentId: string;
  questId: string;
  userId: string;
  username: string;
  
  text: string;
  type: 'encouragement' | 'question' | 'suggestion';
  
  timestamp: string; // ISO8601
  editedAt: string | null; // ISO8601
  
  reactions: Reaction[];
}

export interface Reaction {
  userId: string;
  emoji: string;
  timestamp: string; // ISO8601
}

===== FILE: ./src\worker\models\Notification.ts =====

/**
 * Notification Model
 * Notification structure from SRS Section 4.5
 */

export interface Notification {
  notificationId: string;
  userId: string;
  type: 'milestone' | 'comment' | 'slowdown' | 'guild' | 'achievement' | 'quest_default';
  
  title: string;
  message: string;
  priority: 'low' | 'normal' | 'high';
  
  questId: string | null;
  sourceUserId: string | null;
  
  actionUrl: string | null;
  isRead: boolean;
  
  createdAt: string; // ISO8601
  readAt: string | null; // ISO8601
}

===== FILE: ./src\worker\models\Quest.ts =====

/**
 * Quest Model
 * Complete quest structure from SRS Section 4.2
 */

export interface Quest {
  questId: string;
  ownerId: string;
  title: string;
  description: string;
  type: 'Quest' | 'DungeonQuest' | 'TodoQuest';
  isDungeon: boolean;
  isPublic: boolean;
  tags: string[];
  hidden: boolean;
  priority: 'A' | 'B' | 'C';
  
  difficulty: {
    userAssigned: 'Trivial' | 'Easy' | 'Medium' | 'Hard' | 'Epic';
    gmValidated: string | null;
    isLocked: boolean;
    validatedAt: string | null; // ISO8601
    xpPerPomodoro: number;
  };
  
  schedule: {
    frequency: 'Daily' | 'Weekly' | 'Custom';
    targetCompletionsPerCycle: number;
    pomodoroDurationMin: number;
    breakDurationMin: number;
    preferredTimeSlots: string[]; // HH:MM format
  };
  
  subtasks: Subtask[];
  
  watchers: string[]; // userIds
  members: string[]; // userIds (for guild quests)
  isTrackAligned: boolean;
  dueDate: string | null; // ISO8601
  isCompleted: boolean;
  completedAt: string | null; // ISO8601
  
  activeBuffs: string[]; // buffIds
  
  gamification: {
    currentLevel: number;
    currentExp: number;
    expToNextLevel: number;
  };
  
  progressHistory: ProgressHistoryEntry[];
  
  tracking: {
    totalTrackedTime: number; // minutes
    velocity: number; // XP/hour
    averageSessionQuality: number; // 0-100
    lastSessionAt: string | null; // ISO8601
  };
  
  registeredAt: string; // ISO8601
  createdAt: string; // ISO8601
  updatedAt: string; // ISO8601
}

export interface Subtask {
  id: string;
  title: string;
  estimatePomodoros: number;
  isComplete: boolean;
  completedAt: string | null; // ISO8601
  revisionCount: number;
}

export interface ProgressHistoryEntry {
  date: string; // YYYY-MM-DD
  completions: number;
  expEarned: number;
  timeSpentMin: number;
  isMilestone: boolean;
  sessionsCompleted: number;
}

===== FILE: ./src\worker\models\Session.ts =====

/**
 * Session Model
 * Complete session structure from SRS Section 4.3 (with pauseEvents)
 */

export interface Session {
  sessionId: string;
  userId: string;
  questId: string;
  subtaskId: string | null;
  
  startTime: string; // ISO8601
  endTime: string | null; // ISO8601
  plannedDurationMin: number;
  actualDurationMin: number;
  
  status: 'active' | 'paused' | 'completed' | 'abandoned';
  
  pauseEvents: PauseEvent[]; // NEW in v0.1
  
  interruptions: Interruption[];
  
  quality: {
    score: number; // 0-100
    factors: {
      completionRate: number; // 0-100
      interruptionPenalty: number;
      overtimeBonus: number;
      consistencyBonus: number;
    };
  };
  
  xpEarned: number;
  xpMultipliers: XPMultiplier[];
  
  notes: string | null;
  tags: string[];
}

export interface PauseEvent {
  timestamp: string; // ISO8601
  durationSec: number;
  reason?: string | null;
  wasAutomatic: boolean;
}

export interface Interruption {
  timestamp: string; // ISO8601
  durationSec: number;
  reason: string | null;
}

export interface XPMultiplier {
  source: 'difficulty' | 'track_aligned' | 'rune' | 'buff' | 'dungeon';
  value: number;
}

===== FILE: ./src\worker\models\SyncOperation.ts =====

/**
 * SyncOperation Model
 * Queued operations for offline sync
 */

export interface SyncOperation {
  id: string;
  operation: 'create' | 'update' | 'delete';
  collection: string;
  documentId: string;
  data: any;
  timestamp: number;
  priority: number; // 1-10 (10 = highest)
  retries: number;
  error: string | null;
}


===== FILE: ./src\worker\models\TaskOrder.ts =====

/**
 * TaskOrder Model
 * Stores user's custom task ordering preferences
 */

export interface TaskOrder {
  userId: string;
  questId: string;
  taskOrder: string[]; // Array of subtaskIds in display order
  lastUpdated: string; // ISO8601
}


===== FILE: ./src\worker\models\UserProfile.ts =====

/**
 * UserProfile Model
 * Complete user data structure from SRS Section 4.1
 */

export interface UserProfile {
  userId: string;
  username: string;
  totalLevel: number;
  experiencePoints: number;
  isPublic: boolean;
  joinDate: string; // ISO8601
  specializationTrack: 'Architect' | 'Scholar' | 'Vanguard';
  grade: string; // 'Bronze I' | 'Silver III' | 'Gold' | 'Platinum' | 'Ascendant'
  rankPoints: number;
  
  inventory: InventoryItem[];
  
  equippedArtifacts: {
    weapon: string | null; // itemId
    armor: string | null;
    accessory: string | null;
  };
  
  activeBuffs: Buff[];
  activeDebuffs: Debuff[];
  
  agentProfile: {
    motivationalStyle: 'firm' | 'gentle' | 'neutral';
    preferredDifficulty: 'easy' | 'medium' | 'strict';
    trustLevel: number; // 0-100
  };
  
  streakData: {
    currentStreak: number;
    longestStreak: number;
    lastActivityDate: string; // YYYY-MM-DD
    streakStartDate: string; // YYYY-MM-DD
  };
  
  consistencyScore: number; // 0-100
  achievements: string[];
}

export interface InventoryItem {
  itemId: string;
  name: string;
  type: 'Artifact' | 'Rune';
  effect: string;
  rarity: 'Common' | 'Rare' | 'Epic' | 'Legendary';
  usesRemaining: number | null; // null for artifacts
  durability: number | null; // 0-100, null if disabled
  slotType: 'Weapon' | 'Armor' | 'Accessory' | null;
  isEquipped: boolean;
  acquiredAt: string; // ISO8601
}

export interface Buff {
  buffId: string;
  name: string;
  source: 'streak' | 'rune' | 'artifact';
  effect: Record<string, any>;
  multiplier: number;
  expiresAt: string | null; // ISO8601
}

export interface Debuff {
  debuffId: string;
  name: string;
  effect: string;
  severity: number; // 0-100
  expiresAt: string | null; // ISO8601
}

===== FILE: ./src\worker\models\index.ts =====

/**
 * Model Index
 * Re-exports all models for convenient importing
 */

export type { UserProfile, InventoryItem, Buff, Debuff } from './UserProfile';
export type { Quest, Subtask, ProgressHistoryEntry } from './Quest';
export type { Session, PauseEvent, Interruption, XPMultiplier } from './Session';
export type { TaskOrder } from './TaskOrder';
export type { ActivityItem, ActivityType } from './ActivityItem';
export type { AgentState, Pattern, QuestAdjustment, PendingAction } from './AgentState';
export type { GoalComment, Reaction } from './GoalComment';
export type { Notification } from './Notification';
export type { SyncOperation } from './SyncOperation';
export type { GMSuggestion } from './GMSuggestion';
export type { DungeonMemberProgress } from './DungeonMemberProgress';
export type { AnalyticsSummary, DayBreakdown, QuestBreakdown } from './AnalyticsSummary';

===== FILE: ./src\worker\services\activity-feed.service.ts =====

/**
 * ActivityFeedService
 * Generates unified activity feed from multiple sources
 */

import { getDB } from '../db/indexed-db';
import type { ActivityItem, ActivityType } from '../models/ActivityItem';
import type { Quest } from '../models/Quest';

export class ActivityFeedService {
  private db = getDB();

  /**
   * Get unified activity feed
   */
  async getActivityFeed(
    userId: string,
    options: {
      limit?: number;
      types?: ActivityType[];
      includeWatched?: boolean;
    } = {}
  ): Promise<ActivityItem[]> {
    const {
      limit = 20,
      types = [],
      includeWatched = true
    } = options;

    // Fetch from local activity feed cache
    let activities = await this.db.activityFeed
      .where('userId')
      .equals(userId)
      .reverse()
      .sortBy('timestamp');

    // Generate activities from user's own data
    const userActivities = await this.generateUserActivities(userId);
    
    // Merge and deduplicate
    const allActivities = [...activities, ...userActivities];
    const uniqueActivities = this.deduplicateActivities(allActivities);

    // Filter by types if specified
    let filtered = types.length > 0
      ? uniqueActivities.filter(a => types.includes(a.type))
      : uniqueActivities;

    // Sort by timestamp descending
    filtered.sort((a, b) => 
      new Date(b.timestamp).getTime() - new Date(a.timestamp).getTime()
    );

    return filtered.slice(0, limit);
  }

  /**
   * Generate activities from user's quest progress
   */
  private async generateUserActivities(userId: string): Promise<ActivityItem[]> {
    const activities: ActivityItem[] = [];
    const userProfile = await this.db.users.get(userId);
    if (!userProfile) return activities;

    const quests = await this.db.quests
      .where('ownerId')
      .equals(userId)
      .toArray();

    for (const quest of quests) {
      // Check for recent level ups in progressHistory
      const recentHistory = quest.progressHistory
        .filter(h => h.isMilestone)
        .slice(-3); // Last 3 milestones

      for (const history of recentHistory) {
        activities.push({
          activityId: `${quest.questId}-level-${history.date}`,
          type: 'level_up',
          userId,
          username: userProfile.username,
          timestamp: history.date,
          data: {
            level: quest.gamification.currentLevel,
            questId: quest.questId,
            questTitle: quest.title
          }
        });
      }

      // Check for quest completion
      if (quest.isCompleted && quest.completedAt) {
        const completedRecently = this.isRecent(quest.completedAt, 7); // Last 7 days
        
        if (completedRecently) {
          activities.push({
            activityId: `${quest.questId}-complete`,
            type: 'quest_complete',
            userId,
            username: userProfile.username,
            timestamp: quest.completedAt,
            data: {
              questId: quest.questId,
              questTitle: quest.title,
              xpEarned: quest.gamification.currentExp
            }
          });
        }
      }
    }

    // Check for streak milestones
    const streak = userProfile.streakData.currentStreak;
    if ([7, 30, 100, 365].includes(streak)) {
      activities.push({
        activityId: `streak-${streak}`,
        type: 'streak_milestone',
        userId,
        username: userProfile.username,
        timestamp: new Date().toISOString(),
        data: {
          streakDays: streak
        }
      });
    }

    return activities;
  }

  /**
   * Deduplicate activities by ID
   */
  private deduplicateActivities(activities: ActivityItem[]): ActivityItem[] {
    const seen = new Set<string>();
    return activities.filter(activity => {
      if (seen.has(activity.activityId)) {
        return false;
      }
      seen.add(activity.activityId);
      return true;
    });
  }

  /**
   * Check if timestamp is within N days
   */
  private isRecent(timestamp: string, days: number): boolean {
    const date = new Date(timestamp);
    const now = new Date();
    const diffDays = (now.getTime() - date.getTime()) / (1000 * 60 * 60 * 24);
    return diffDays <= days;
  }

  /**
   * Add activity to feed (for caching)
   */
  async addActivity(activity: ActivityItem): Promise<void> {
    await this.db.activityFeed.add(activity);
  }
}


===== FILE: ./src\worker\services\analytics.service.ts =====

/**
 * AnalyticsService
 * Generates analytics, heatmaps, and metrics
 */

import { getDB } from '../db/indexed-db';
import type { Session } from '../models/Session';

export interface HeatmapDay {
  date: string;
  count: number;
  intensity: number; // 0-4 for color coding
}

export interface TodayMetrics {
  xpEarned: number;
  sessionsCompleted: number;
  currentStreak: number;
  timeSpentMin: number;
}

export class AnalyticsService {
  private db = getDB();

  /**
   * Generate heatmap data for date range
   */
  async getHeatmapData(
    userId: string,
    startDate: string,
    endDate: string
  ): Promise<HeatmapDay[]> {
    // Fetch sessions in range
    const sessions = await this.db.getSessionsByDateRange(userId, startDate, endDate);

    // Group by date
    const dailyCounts = new Map<string, number>();
    
    sessions.forEach(session => {
      const date = session.startTime.split('T')[0];
      dailyCounts.set(date, (dailyCounts.get(date) || 0) + 1);
    });

    // Calculate intensity levels (0-4)
    const counts = Array.from(dailyCounts.values());
    const maxCount = Math.max(...counts, 1);
    
    // Fill in all dates in range with zero counts
    const start = new Date(startDate);
    const end = new Date(endDate);
    const heatmapData: HeatmapDay[] = [];
    
    for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
      const dateStr = d.toISOString().split('T')[0];
      const count = dailyCounts.get(dateStr) || 0;
      
      heatmapData.push({
        date: dateStr,
        count,
        intensity: Math.ceil((count / maxCount) * 4) // 0-4 scale
      });
    }

    return heatmapData;
  }

  /**
   * Get today's metrics for MainPanel stats
   */
  async getTodayMetrics(userId: string): Promise<TodayMetrics> {
    const sessions = await this.db.getTodaySessions(userId);
    
    // Calculate totals
    const xpEarned = sessions.reduce((sum, s) => sum + (s.xpEarned || 0), 0);
    const sessionsCompleted = sessions.filter(s => s.status === 'completed').length;
    const timeSpentMin = sessions.reduce((sum, s) => sum + s.actualDurationMin, 0);
    
    // Get current streak from user profile
    const userProfile = await this.db.users.get(userId);
    const currentStreak = userProfile?.streakData.currentStreak || 0;

    return {
      xpEarned,
      sessionsCompleted,
      currentStreak,
      timeSpentMin
    };
  }

  /**
   * Get session history for a quest
   */
  async getQuestSessions(questId: string, limit: number = 50): Promise<Session[]> {
    return await this.db.sessions
      .where('questId')
      .equals(questId)
      .reverse()
      .limit(limit)
      .toArray();
  }

  /**
   * Calculate velocity (XP per hour) for a quest
   */
  async calculateQuestVelocity(questId: string): Promise<number> {
    const sessions = await this.getQuestSessions(questId, 100);
    
    const totalXP = sessions.reduce((sum, s) => sum + (s.xpEarned || 0), 0);
    const totalTimeHours = sessions.reduce((sum, s) => sum + s.actualDurationMin, 0) / 60;
    
    return totalTimeHours > 0 ? totalXP / totalTimeHours : 0;
  }

  /**
   * Get average session quality for a quest
   */
  async getAverageQuality(questId: string): Promise<number> {
    const sessions = await this.getQuestSessions(questId);
    const completedSessions = sessions.filter(s => s.status === 'completed');
    
    if (completedSessions.length === 0) return 0;
    
    const totalQuality = completedSessions.reduce((sum, s) => sum + s.quality.score, 0);
    return Math.round(totalQuality / completedSessions.length);
  }
}

export function totalExpForLevel(L: number) {
  return 100 * (Math.exp(L / 5) - 1)
}

export function xpToNextLevel(currentExp: number) {
  // compute current level (continuous)
  const level = Math.floor(Math.log(currentExp / 100 + 1) * 5)
  const neededTotal = totalExpForLevel(level + 1)
  return Math.max(0, Math.ceil(neededTotal - currentExp))
}

export function xpDeltaForLevel(L: number) {
  const factor = Math.exp(1 / 5) - 1 // ‚âà 0.22140275816
  return 100 * Math.exp(L / 5) * factor
}

export function currentLevelFromExp(currentExp: number) {
    return Math.floor(Math.log(currentExp / 100 + 1) * 5);
}

===== FILE: ./src\worker\services\auth.service.ts =====

/**
 * AuthService
 * Manages current user session
 * Returns userId for components to use
 */

import { getDB } from '../db/indexed-db';
import { SeedService } from './seed.service';

export class AuthService {
  private db = getDB();
  private seedService = new SeedService();
  private currentUserId: string | null = null;

  /**
   * Initialize and get current user ID
   * Seeds database on first load
   */
  async getCurrentUserId(): Promise<string> {
    // Check if already initialized
    if (this.currentUserId) {
      console.log("In auth service, user is current user");
      return this.currentUserId;
    }

    // Check localStorage for saved user
    const savedUserId = localStorage.getItem('ascend_current_user');
    
    if (savedUserId) {
      // Verify user exists in DB
      const user = await this.db.users.get(savedUserId);
      console.log("In auth service, user gotten from db");
      if (user) {
        this.currentUserId = savedUserId;
        return savedUserId;
      }
    }

    // No saved user, seed database and get test user
    const userId = await this.seedService.seedDatabase();
    this.currentUserId = userId;
    localStorage.setItem('ascend_current_user', userId);
    
    return userId;
  }

  /**
   * Get current user profile
   */
  async getCurrentUser() {
    const userId = await this.getCurrentUserId();
    return await this.db.users.get(userId);
  }

  /**
   * Switch user (for future multi-user support)
   */
  async switchUser(userId: string): Promise<void> {
    const user = await this.db.users.get(userId);
    if (!user) {
      throw new Error('User not found');
    }
    
    this.currentUserId = userId;
    localStorage.setItem('ascend_current_user', userId);
  }

  /**
   * Logout (clear current user)
   */
  logout(): void {
    this.currentUserId = null;
    localStorage.removeItem('ascend_current_user');
  }
}

===== FILE: ./src\worker\services\notification.service.ts =====

/**
 * NotificationService
 * Manages quest notifications
 */

import { getDB } from '../db/indexed-db';
import type { Notification } from '../models/Notification';

export class NotificationService {
  private db = getDB();

  /**
   * Get user's notifications
   */
  async getUserNotifications(
    userId: string,
    unreadOnly: boolean = false
  ): Promise<Notification[]> {
    let query = this.db.notifications
      .where('userId')
      .equals(userId);

    if (unreadOnly) {
      const all = await query.toArray();
      return all.filter(n => !n.isRead);
    }

    return await query.reverse().sortBy('createdAt');
  }

  /**
   * Mark notification as read
   */
  async markAsRead(notificationId: string): Promise<void> {
    const notification = await this.db.notifications.get(notificationId);
    if (!notification) return;

    notification.isRead = true;
    notification.readAt = new Date().toISOString();

    await this.db.notifications.update(notificationId, notification);
  }

  /**
   * Create notification
   */
  async createNotification(
    userId: string,
    type: Notification['type'],
    title: string,
    message: string,
    questId?: string,
    priority: Notification['priority'] = 'normal'
  ): Promise<Notification> {
    const notification: Notification = {
      notificationId: crypto.randomUUID(),
      userId,
      type,
      title,
      message,
      priority,
      questId: questId || null,
      sourceUserId: null,
      actionUrl: questId ? `/quests/${questId}` : null,
      isRead: false,
      createdAt: new Date().toISOString(),
      readAt: null
    };

    await this.db.notifications.add(notification);
    
    await this.db.queueSync({
      operation: 'create',
      collection: 'notifications',
      documentId: notification.notificationId,
      data: notification,
      priority: 6
    });

    return notification;
  }
}

===== FILE: ./src\worker\services\quest-ui-adapter.service.ts =====

/**
 * QuestUIAdapter
 * Converts between worker Quest model and UI Task interface
 * Bridges the gap between Figma-generated UI and worker architecture
 */

import type { Quest } from '../models/Quest';
import type { Task } from '../../App'; // UI interface

export class QuestUIAdapter {
  /**
   * Convert Quest subtasks to UI Task format for today's view
   */
  static questsToTasks(quests: Quest[]): Task[] {
    const tasks: Task[] = [];
    
    for (const quest of quests) {
      for (const subtask of quest.subtasks) {
        if (!subtask.isComplete) {
          tasks.push({
            id: subtask.id,
            title: subtask.title,
            questId: quest.questId,
            questTag: quest.title,
            levelReq: quest.gamification.currentLevel,
            completed: subtask.isComplete,
            questColor: this.getQuestColor(quest)
          });
        }
      }
    }
    
    return tasks;
  }

  /**
   * Get color for quest based on difficulty or type
   */
  private static getQuestColor(quest: Quest): string {
    const colorMap: Record<string, string> = {
      'Trivial': '#72767d',
      'Easy': '#57F287',
      'Medium': '#5865F2',
      'Hard': '#FEE75C',
      'Epic': '#EB459E'
    };
    
    return colorMap[quest.difficulty.userAssigned] || '#5865F2';
  }

  /**
   * Find quest and subtask from task ID
   */
  static async findQuestAndSubtask(
    taskId: string,
    quests: Quest[]
  ): Promise<{ quest: Quest; subtask: any } | null> {
    for (const quest of quests) {
      const subtask = quest.subtasks.find(st => st.id === taskId);
      if (subtask) {
        return { quest, subtask };
      }
    }
    return null;
  }
}

===== FILE: ./src\worker\services\quest.service.ts =====

/**
 * QuestService
 * Handles quest CRUD operations, watching, joining
 */

import { getDB } from '../db/indexed-db';
import type { Quest } from '../models/Quest';
import type { GoalComment } from '../models/GoalComment';

export class QuestService {
  private db = getDB();

  /**
   * Get all user's quests
   */
  async getUserQuests(userId: string): Promise<Quest[]> {
    const quests = await this.db.quests
      .where('ownerId')
      .equals(userId)
      .toArray();
    console.log('in quest service, leaving getuserquests', quests)
    return quests; 
  }

  /**
   * Get single quest by ID
   */
  async getQuest(questId: string): Promise<Quest | undefined> {
    return await this.db.quests.get(questId);
  }

  /**
   * Get watched quests (where user is in watchers array)
   */
  async getWatchedQuests(userId: string): Promise<Quest[]> {
    const allQuests = await this.db.quests.toArray();
    console.log('in quest service, leaving getwatchedquests', allQuests)
    return allQuests.filter(q => q.watchers.includes(userId));
  }

  /**
   * Toggle watch status on a quest
   */
  async toggleWatch(userId: string, questId: string): Promise<Quest> {
    const quest = await this.db.quests.get(questId);
    if (!quest) throw new Error('Quest not found');

    const isWatching = quest.watchers.includes(userId);
    
    if (isWatching) {
      // Remove from watchers
      quest.watchers = quest.watchers.filter(id => id !== userId);
    } else {
      // Add to watchers
      quest.watchers.push(userId);
    }

    await this.db.quests.update(questId, quest);
    
    // Queue for sync
    await this.db.queueSync({
      operation: 'update',
      collection: 'quests',
      documentId: questId,
      data: quest,
      priority: 6
    });

    return quest;
  }

  /**
   * Get comments for a quest
   */
  async getQuestComments(questId: string): Promise<GoalComment[]> {
    console.log('getting quest comments')
    const comments = await this.db.comments
      .where('questId')
      .equals(questId)
      .sortBy('timestamp');
    console.log('leaving get quest comments', comments); 
    return comments;
  }

  /**
   * Add comment to quest
   */
  async addComment(
    questId: string,
    userId: string,
    username: string,
    text: string,
    type: 'encouragement' | 'question' | 'suggestion' = 'encouragement'
  ): Promise<GoalComment> {
    const comment: GoalComment = {
      commentId: crypto.randomUUID(),
      questId,
      userId,
      username,
      text,
      type,
      timestamp: new Date().toISOString(),
      editedAt: null,
      reactions: []
    };

    await this.db.comments.add(comment);
    
    // Queue for sync
    await this.db.queueSync({
      operation: 'create',
      collection: 'comments',
      documentId: comment.commentId,
      data: comment,
      priority: 6
    });

    return comment;
  }

  /**
   * Get public/discoverable quests
   */
  async getPublicQuests(limit: number = 20): Promise<Quest[]> {
    return await this.db.quests
      .where('isPublic')
      .equals(1)
      .limit(limit)
      .toArray();
  }

  /**
   * Join a guild/dungeon quest
   */
  async joinQuest(userId: string, questId: string): Promise<Quest> {
    const quest = await this.db.quests.get(questId);
    if (!quest) throw new Error('Quest not found');

    if (!quest.members.includes(userId)) {
      quest.members.push(userId);
    }

    await this.db.quests.update(questId, quest);
    
    await this.db.queueSync({
      operation: 'update',
      collection: 'quests',
      documentId: questId,
      data: quest,
      priority: 7
    });

    return quest;
  }
}

===== FILE: ./src\worker\services\search.service.ts =====

/**
 * SearchService
 * Cross-entity search across quests and tasks
 */

import { getDB } from "../db/indexed-db";
import type { Quest } from "../models/Quest";

export interface SearchResult {
  id: string;
  type: "quest" | "task";
  title: string;
  description?: string;
  questId?: string;
  questTitle?: string;
  relevanceScore: number;
}

export class SearchService {
  private db = getDB();

  /**
   * Search across quests and tasks
   */
  async search(
    userId: string,
    query: string,
    options: {
      type?: "quests" | "tasks" | "all";
      limit?: number;
      includePublic?: boolean;
    } = {}
  ): Promise<SearchResult[]> {
    const { type = "all", limit = 20, includePublic = false } = options;

    const results: SearchResult[] = [];
    const lowerQuery = query.toLowerCase();

    // Search in quests
    if (type === "all" || type === "quests") {
      const questResults = await this.searchQuests(
        userId,
        lowerQuery,
        includePublic
      );
      results.push(...questResults);
    }

    // Search in tasks (subtasks)
    if (type === "all" || type === "tasks") {
      const taskResults = await this.searchTasks(userId, lowerQuery);
      results.push(...taskResults);
    }

    // Sort by relevance score
    results.sort((a, b) => b.relevanceScore - a.relevanceScore);

    return results.slice(0, limit);
  }

  /**
   * Search within quests
   */
  private async searchQuests(
    userId: string,
    query: string,
    includePublic: boolean
  ): Promise<SearchResult[]> {
    let quests: Quest[];

    if (includePublic) {
      quests = await this.db.quests
        .where("isPublic")
        .equals(1)
        .or("ownerId")
        .equals(userId)
        .toArray();
    } else {
      quests = await this.db.quests.where("ownerId").equals(userId).toArray();
    }

    const results: SearchResult[] = [];

    for (const quest of quests) {
      const titleMatch = quest.title.toLowerCase().includes(query);
      const descMatch = quest.description.toLowerCase().includes(query);
      const tagMatch = quest.tags.some((tag) =>
        tag.toLowerCase().includes(query)
      );

      // Calculate relevance score
      let score = 0;
      if (titleMatch) score += 10;
      if (descMatch) score += 5;
      if (tagMatch) score += 3;

      // Boost active quests
      if (!quest.isCompleted) score += 2;

      // Boost priority quests
      if (quest.priority === "A") score += 2;
      else if (quest.priority === "B") score += 1;

      if (score === 0) continue;

      results.push({
        id: quest.questId,
        type: "quest" as const,
        title: quest.title,
        description: quest.description,
        relevanceScore: score,
      });
    }

    return results;
  }

  // ADD this method to existing SearchService class

  /**
   * Search quests only (not subtasks) for MiddlePanel
   * Returns full Quest objects for display
   */
  async searchQuestsOnly(
    userId: string,
    query: string,
    options: {
      limit?: number;
      includeScheduledOnly?: boolean;
    } = {}
  ): Promise<Quest[]> {
    const { limit = 20, includeScheduledOnly = false } = options;

    let quests = await this.db.quests.where("ownerId").equals(userId).toArray();

    // Filter by schedule if requested
    if (includeScheduledOnly) {
      quests = quests.filter((q) => q.schedule && q.schedule.frequency);
    }

    if (!query || query.length < 2) {
      return quests.slice(0, limit);
    }

    const lowerQuery = query.toLowerCase();

    // Search in quest title, description, tags, AND subtask titles
    const matches = quests.filter((quest) => {
      const titleMatch = quest.title.toLowerCase().includes(lowerQuery);
      const descMatch = quest.description.toLowerCase().includes(lowerQuery);
      const tagMatch = quest.tags.some((tag) =>
        tag.toLowerCase().includes(lowerQuery)
      );
      const subtaskMatch = quest.subtasks.some((st) =>
        st.title.toLowerCase().includes(lowerQuery)
      );

      return titleMatch || descMatch || tagMatch || subtaskMatch;
    });

    return matches.slice(0, limit);
  }

  /**
   * Search within subtasks
   */
  private async searchTasks(
    userId: string,
    query: string
  ): Promise<SearchResult[]> {
    const quests = await this.db.quests
      .where("ownerId")
      .equals(userId)
      .toArray();

    const results: SearchResult[] = [];

    for (const quest of quests) {
      for (const subtask of quest.subtasks || []) {
        const match = subtask.title.toLowerCase().includes(query);

        if (match) {
          results.push({
            id: subtask.id,
            type: "task",
            title: subtask.title,
            questId: quest.questId,
            questTitle: quest.title,
            relevanceScore: subtask.isComplete ? 3 : 8, // Boost incomplete
          });
        }
      }
    }

    return results;
  }
}


===== FILE: ./src\worker\services\seed.service.ts =====

/**
 * SeedService
 * Creates test data for development
 * Runs once on first load, prevented by localStorage flag
 */

import { getDB } from '../db/indexed-db';
import type { UserProfile } from '../models/UserProfile';
import type { Quest } from '../models/Quest';

export class SeedService {
  private db = getDB();
  private readonly SEED_FLAG_KEY = 'ascend_seeded';
  private readonly TEST_USER_ID = 'test-user-001';

  /**
   * Check if database has been seeded
   */
  async isSeeded(): Promise<boolean> {
    // Check localStorage flag
    const flag = localStorage.getItem(this.SEED_FLAG_KEY);
    if (flag === 'true') return true;

    // Double-check: verify test user exists in DB
    const user = await this.db.users.get(this.TEST_USER_ID);
    if (user) {
      localStorage.setItem(this.SEED_FLAG_KEY, 'true');
      return true;
    }

    return false;
  }

  /**
   * Seed database with test data
   */
  async seedDatabase(): Promise<string> {
    const alreadySeeded = await this.isSeeded();
    if (alreadySeeded) {
      console.log('Database already seeded, skipping...');
      return this.TEST_USER_ID;
    }

    console.log('Seeding database with test data...');

    try {
      // Create test user
      const user = await this.createTestUser();
      
      // Create test quests
      await this.createTestQuests(user.userId);
      
      // Mark as seeded
      localStorage.setItem(this.SEED_FLAG_KEY, 'true');
      
      console.log('‚úÖ Database seeded successfully');
      return user.userId;
    } catch (error) {
      console.error('Failed to seed database:', error);
      throw error;
    }
  }

  /**
   * Create test user profile
   */
  private async createTestUser(): Promise<UserProfile> {
    const user: UserProfile = {
      userId: this.TEST_USER_ID,
      username: 'TestWarrior',
      totalLevel: 12,
      experiencePoints: 5420,
      isPublic: true,
      joinDate: new Date(Date.now() - 30 * 86400000).toISOString(), // 30 days ago
      specializationTrack: 'Architect',
      grade: 'Silver II',
      rankPoints: 1250,
      
      inventory: [
        {
          itemId: 'artifact-001',
          name: 'Ring of Consistent Focus',
          type: 'Artifact',
          effect: '+3 minutes to Pomodoro duration',
          rarity: 'Rare',
          usesRemaining: null,
          durability: null,
          slotType: 'Accessory',
          isEquipped: true,
          acquiredAt: new Date(Date.now() - 15 * 86400000).toISOString()
        },
        {
          itemId: 'rune-001',
          name: 'Rune of Temporal Acceleration',
          type: 'Rune',
          effect: '√ó2 XP multiplier',
          rarity: 'Epic',
          usesRemaining: 3,
          durability: null,
          slotType: null,
          isEquipped: false,
          acquiredAt: new Date(Date.now() - 7 * 86400000).toISOString()
        }
      ],
      
      equippedArtifacts: {
        weapon: null,
        armor: null,
        accessory: 'artifact-001'
      },
      
      activeBuffs: [
        {
          buffId: 'buff-streak-7',
          name: '7-Day Streak',
          source: 'streak',
          effect: { xpBonus: 0.05 },
          multiplier: 1.05,
          expiresAt: null
        }
      ],
      
      activeDebuffs: [],
      
      agentProfile: {
        motivationalStyle: 'neutral',
        preferredDifficulty: 'medium',
        trustLevel: 75
      },
      
      streakData: {
        currentStreak: 7,
        longestStreak: 14,
        lastActivityDate: new Date().toISOString().split('T')[0],
        streakStartDate: new Date(Date.now() - 7 * 86400000).toISOString().split('T')[0]
      },
      
      consistencyScore: 78,
      achievements: ['first_quest', 'week_streak', 'level_10']
    };

    await this.db.users.add(user);
    console.log('‚úÖ Created test user:', user.username);
    return user;
  }

  /**
   * Create test quests with subtasks
   */
  private async createTestQuests(userId: string): Promise<void> {
    const quests: Quest[] = [
      // Quest 1: Active daily quest
      {
        questId: 'quest-001',
        ownerId: userId,
        title: 'Master React Hooks',
        description: 'Deep dive into advanced React hooks patterns and best practices',
        type: 'Quest',
        isDungeon: false,
        isPublic: true,
        tags: ['react', 'frontend', 'learning'],
        hidden: false,
        priority: 'A',
        
        difficulty: {
          userAssigned: 'Medium',
          gmValidated: 'Medium',
          isLocked: true,
          validatedAt: new Date(Date.now() - 5 * 86400000).toISOString(),
          xpPerPomodoro: 200
        },
        
        schedule: {
          frequency: 'Daily',
          targetCompletionsPerCycle: 2,
          pomodoroDurationMin: 25,
          breakDurationMin: 5,
          preferredTimeSlots: ['09:00', '14:00']
        },
        
        subtasks: [
          {
            id: 'subtask-001',
            title: 'Study useReducer patterns',
            estimatePomodoros: 3,
            isComplete: true,
            completedAt: new Date(Date.now() - 2 * 86400000).toISOString(),
            revisionCount: 0
          },
          {
            id: 'subtask-002',
            title: 'Build custom hook for API calls',
            estimatePomodoros: 4,
            isComplete: false,
            completedAt: null,
            revisionCount: 1
          },
          {
            id: 'subtask-003',
            title: 'Implement useContext optimization',
            estimatePomodoros: 3,
            isComplete: false,
            completedAt: null,
            revisionCount: 0
          }
        ],
        
        watchers: [],
        members: [],
        isTrackAligned: true,
        dueDate: new Date(Date.now() + 7 * 86400000).toISOString(), // 7 days from now
        isCompleted: false,
        completedAt: null,
        
        activeBuffs: [],
        
        gamification: {
          currentLevel: 5,
          currentExp: 1200,
          expToNextLevel: 1875
        },
        
        progressHistory: [
          {
            date: new Date(Date.now() - 2 * 86400000).toISOString().split('T')[0],
            completions: 2,
            expEarned: 400,
            timeSpentMin: 50,
            isMilestone: false,
            sessionsCompleted: 2
          },
          {
            date: new Date(Date.now() - 1 * 86400000).toISOString().split('T')[0],
            completions: 1,
            expEarned: 200,
            timeSpentMin: 25,
            isMilestone: false,
            sessionsCompleted: 1
          }
        ],
        
        tracking: {
          totalTrackedTime: 300, // 5 hours
          velocity: 240, // 1200 XP / 5 hours
          averageSessionQuality: 82,
          lastSessionAt: new Date(Date.now() - 86400000).toISOString()
        },
        
        registeredAt: new Date(Date.now() - 10 * 86400000).toISOString(),
        createdAt: new Date(Date.now() - 10 * 86400000).toISOString(),
        updatedAt: new Date(Date.now() - 86400000).toISOString()
      },

      // Quest 2: Weekly project quest
      {
        questId: 'quest-002',
        ownerId: userId,
        title: 'Build Productivity Dashboard',
        description: 'Create a comprehensive analytics dashboard for the Ascend app',
        type: 'Quest',
        isDungeon: false,
        isPublic: false,
        tags: ['project', 'dashboard', 'analytics'],
        hidden: false,
        priority: 'A',
        
        difficulty: {
          userAssigned: 'Hard',
          gmValidated: null,
          isLocked: false,
          validatedAt: null,
          xpPerPomodoro: 300
        },
        
        schedule: {
          frequency: 'Weekly',
          targetCompletionsPerCycle: 10,
          pomodoroDurationMin: 25,
          breakDurationMin: 5,
          preferredTimeSlots: ['10:00', '15:00', '20:00']
        },
        
        subtasks: [
          {
            id: 'subtask-004',
            title: 'Design dashboard wireframes',
            estimatePomodoros: 2,
            isComplete: true,
            completedAt: new Date(Date.now() - 3 * 86400000).toISOString(),
            revisionCount: 0
          },
          {
            id: 'subtask-005',
            title: 'Implement heatmap component',
            estimatePomodoros: 5,
            isComplete: false,
            completedAt: null,
            revisionCount: 0
          },
          {
            id: 'subtask-006',
            title: 'Add velocity chart',
            estimatePomodoros: 4,
            isComplete: false,
            completedAt: null,
            revisionCount: 0
          },
          {
            id: 'subtask-007',
            title: 'Connect to IndexedDB',
            estimatePomodoros: 3,
            isComplete: false,
            completedAt: null,
            revisionCount: 0
          }
        ],
        
        watchers: [],
        members: [],
        isTrackAligned: true,
        dueDate: new Date(Date.now() + 14 * 86400000).toISOString(),
        isCompleted: false,
        completedAt: null,
        
        activeBuffs: [],
        
        gamification: {
          currentLevel: 2,
          currentExp: 300,
          expToNextLevel: 1125
        },
        
        progressHistory: [
          {
            date: new Date(Date.now() - 3 * 86400000).toISOString().split('T')[0],
            completions: 1,
            expEarned: 300,
            timeSpentMin: 50,
            isMilestone: false,
            sessionsCompleted: 2
          }
        ],
        
        tracking: {
          totalTrackedTime: 50,
          velocity: 360, // 300 XP / 0.83 hours
          averageSessionQuality: 88,
          lastSessionAt: new Date(Date.now() - 3 * 86400000).toISOString()
        },
        
        registeredAt: new Date(Date.now() - 5 * 86400000).toISOString(),
        createdAt: new Date(Date.now() - 5 * 86400000).toISOString(),
        updatedAt: new Date(Date.now() - 3 * 86400000).toISOString()
      },

      // Quest 3: Todo Quest
      {
        questId: 'quest-003',
        ownerId: userId,
        title: 'Daily Admin Tasks',
        description: 'Miscellaneous small tasks and administrative work',
        type: 'TodoQuest',
        isDungeon: false,
        isPublic: false,
        tags: ['admin', 'quick-tasks'],
        hidden: false,
        priority: 'C',
        
        difficulty: {
          userAssigned: 'Trivial',
          gmValidated: 'Trivial',
          isLocked: true,
          validatedAt: new Date(Date.now() - 1 * 86400000).toISOString(),
          xpPerPomodoro: 50
        },
        
        schedule: {
          frequency: 'Daily',
          targetCompletionsPerCycle: 1,
          pomodoroDurationMin: 25,
          breakDurationMin: 5,
          preferredTimeSlots: ['08:00']
        },
        
        subtasks: [
          {
            id: 'subtask-008',
            title: 'Check and respond to emails',
            estimatePomodoros: 1,
            isComplete: true,
            completedAt: new Date().toISOString(),
            revisionCount: 0
          },
          {
            id: 'subtask-009',
            title: 'Update project documentation',
            estimatePomodoros: 1,
            isComplete: false,
            completedAt: null,
            revisionCount: 0
          },
          {
            id: 'subtask-010',
            title: 'Review pull requests',
            estimatePomodoros: 1,
            isComplete: false,
            completedAt: null,
            revisionCount: 0
          }
        ],
        
        watchers: [],
        members: [],
        isTrackAligned: false,
        dueDate: null,
        isCompleted: false,
        completedAt: null,
        
        activeBuffs: [],
        
        gamification: {
          currentLevel: 8,
          currentExp: 450,
          expToNextLevel: 2531
        },
        
        progressHistory: [],
        
        tracking: {
          totalTrackedTime: 150,
          velocity: 100, // 50 XP flat rate
          averageSessionQuality: 65,
          lastSessionAt: new Date().toISOString()
        },
        
        registeredAt: new Date(Date.now() - 20 * 86400000).toISOString(),
        createdAt: new Date(Date.now() - 20 * 86400000).toISOString(),
        updatedAt: new Date().toISOString()
      },

      // Quest 4: Overdue quest for testing
      {
        questId: 'quest-004',
        ownerId: userId,
        title: 'Learn TypeScript Advanced Types',
        description: 'Master conditional types, mapped types, and template literal types',
        type: 'Quest',
        isDungeon: false,
        isPublic: true,
        tags: ['typescript', 'learning'],
        hidden: false,
        priority: 'B',
        
        difficulty: {
          userAssigned: 'Medium',
          gmValidated: 'Medium',
          isLocked: true,
          validatedAt: new Date(Date.now() - 8 * 86400000).toISOString(),
          xpPerPomodoro: 200
        },
        
        schedule: {
          frequency: 'Weekly',
          targetCompletionsPerCycle: 5,
          pomodoroDurationMin: 25,
          breakDurationMin: 5,
          preferredTimeSlots: ['11:00', '16:00']
        },
        
        subtasks: [
          {
            id: 'subtask-011',
            title: 'Study conditional types',
            estimatePomodoros: 3,
            isComplete: false,
            completedAt: null,
            revisionCount: 0
          },
          {
            id: 'subtask-012',
            title: 'Practice mapped types',
            estimatePomodoros: 3,
            isComplete: false,
            completedAt: null,
            revisionCount: 0
          }
        ],
        
        watchers: [],
        members: [],
        isTrackAligned: true,
        dueDate: new Date(Date.now() - 2 * 86400000).toISOString(), // OVERDUE!
        isCompleted: false,
        completedAt: null,
        
        activeBuffs: [],
        
        gamification: {
          currentLevel: 1,
          currentExp: 0,
          expToNextLevel: 750
        },
        
        progressHistory: [],
        
        tracking: {
          totalTrackedTime: 0,
          velocity: 0,
          averageSessionQuality: 0,
          lastSessionAt: null
        },
        
        registeredAt: new Date(Date.now() - 15 * 86400000).toISOString(),
        createdAt: new Date(Date.now() - 15 * 86400000).toISOString(),
        updatedAt: new Date(Date.now() - 15 * 86400000).toISOString()
      }
    ];

    // Add all quests to database
    for (const quest of quests) {
      await this.db.quests.add(quest);
      console.log(`‚úÖ Created quest: ${quest.title}`);
    }

    // Create some historical sessions for heatmap visualization
    await this.createHistoricalSessions(userId, quests);
  }

  /**
   * Create historical sessions for heatmap data
   */
  private async createHistoricalSessions(userId: string, quests: Quest[]): Promise<void> {
    const sessionsToCreate = [
      // 7 days ago - 2 sessions
      { daysAgo: 7, count: 2, questId: quests[0].questId, xp: 200 },
      // 6 days ago - 1 session
      { daysAgo: 6, count: 1, questId: quests[1].questId, xp: 300 },
      // 5 days ago - 3 sessions
      { daysAgo: 5, count: 3, questId: quests[0].questId, xp: 200 },
      // 4 days ago - 2 sessions
      { daysAgo: 4, count: 2, questId: quests[1].questId, xp: 300 },
      // 3 days ago - 1 session
      { daysAgo: 3, count: 1, questId: quests[2].questId, xp: 50 },
      // 2 days ago - 4 sessions (high activity)
      { daysAgo: 2, count: 4, questId: quests[0].questId, xp: 200 },
      // 1 day ago - 2 sessions
      { daysAgo: 1, count: 2, questId: quests[1].questId, xp: 300 },
      // Today - 1 session
      { daysAgo: 0, count: 1, questId: quests[2].questId, xp: 50 }
    ];

    for (const { daysAgo, count, questId, xp } of sessionsToCreate) {
      for (let i = 0; i < count; i++) {
        const sessionDate = new Date(Date.now() - daysAgo * 86400000);
        
        const session = {
          sessionId: `session-${daysAgo}-${i}-${Date.now()}`,
          userId,
          questId,
          subtaskId: null,
          startTime: new Date(sessionDate.getTime() + i * 3600000).toISOString(), // Spread throughout day
          endTime: new Date(sessionDate.getTime() + i * 3600000 + 1500000).toISOString(), // 25 min later
          plannedDurationMin: 25,
          actualDurationMin: 25,
          status: 'completed' as const,
          pauseEvents: [],
          interruptions: [],
          quality: {
            score: 75 + Math.floor(Math.random() * 20),
            factors: {
              completionRate: 100,
              interruptionPenalty: 0,
              overtimeBonus: 0,
              consistencyBonus: 5
            }
          },
          xpEarned: xp,
          xpMultipliers: [
            { source: 'difficulty' as const, value: 1.0 }
          ],
          notes: null,
          tags: []
        };

        await this.db.sessions.add(session);
      }
    }

    console.log('‚úÖ Created historical sessions for heatmap');
  }

  /**
   * Clear all data and reseed (for testing)
   */
  async reseedDatabase(): Promise<string> {
    console.log('Clearing database...');
    await this.db.clearAll();
    localStorage.removeItem(this.SEED_FLAG_KEY);
    
    console.log('Reseeding database...');
    return await this.seedDatabase();
  }
}

===== FILE: ./src\worker\services\session.service.ts =====

/**
 * SessionService
 * Handles session lifecycle, pause/resume, quality calculation
 */

import { getDB } from '../db/indexed-db';
import type { Session, PauseEvent } from '../models/Session';
import type { UserProfile } from '../models/UserProfile';
import type { Quest } from '../models/Quest';

export class SessionService {
  private db = getDB();

  /**
   * Create new session
   */
  async createSession(
    userId: string,
    questId: string,
    subtaskId: string | null,
    plannedDurationMin: number
  ): Promise<Session> {
    const session: Session = {
      sessionId: crypto.randomUUID(),
      userId,
      questId,
      subtaskId,
      startTime: new Date().toISOString(),
      endTime: null,
      plannedDurationMin,
      actualDurationMin: 0,
      status: 'active',
      pauseEvents: [],
      interruptions: [],
      quality: {
        score: 0,
        factors: {
          completionRate: 0,
          interruptionPenalty: 0,
          overtimeBonus: 0,
          consistencyBonus: 0
        }
      },
      xpEarned: 0,
      xpMultipliers: [],
      notes: null,
      tags: []
    };

    await this.db.sessions.add(session);
    
    // Queue for sync (priority 9 - active session)
    await this.db.queueSync({
      operation: 'create',
      collection: 'sessions',
      documentId: session.sessionId,
      data: session,
      priority: 9
    });

    return session;
  }

  /**
   * Pause active session
   */
  async pauseSession(sessionId: string): Promise<Session> {
    const session = await this.db.sessions.get(sessionId);
    
    if (!session) {
      throw new Error('Session not found');
    }
    
    if (session.status !== 'active') {
      throw new Error('Cannot pause non-active session');
    }

    const pauseEvent: PauseEvent = {
      timestamp: new Date().toISOString(),
      durationSec: 0, // Will be calculated on resume
      reason: null,
      wasAutomatic: false
    };

    session.status = 'paused';
    session.pauseEvents.push(pauseEvent);

    await this.db.sessions.update(sessionId, session);
    
    // Queue for sync (priority 9)
    await this.db.queueSync({
      operation: 'update',
      collection: 'sessions',
      documentId: sessionId,
      data: session,
      priority: 9
    });

    return session;
  }

  /**
   * Resume paused session
   */
  async resumeSession(sessionId: string): Promise<Session> {
    const session = await this.db.sessions.get(sessionId);
    
    if (!session) {
      throw new Error('Session not found');
    }
    
    if (session.status !== 'paused') {
      throw new Error('Cannot resume non-paused session');
    }

    // Calculate pause duration
    const lastPause = session.pauseEvents[session.pauseEvents.length - 1];
    const pauseDuration = Math.floor(
      (Date.now() - new Date(lastPause.timestamp).getTime()) / 1000
    );
    
    lastPause.durationSec = pauseDuration;

    // Add to interruptions
    session.interruptions.push({
      timestamp: lastPause.timestamp,
      durationSec: pauseDuration,
      reason: 'manual_pause'
    });

    session.status = 'active';

    await this.db.sessions.update(sessionId, session);
    
    await this.db.queueSync({
      operation: 'update',
      collection: 'sessions',
      documentId: sessionId,
      data: session,
      priority: 9
    });

    return session;
  }

  /**
   * Complete session and calculate XP
   */
  async completeSession(
    sessionId: string,
    actualDurationMin: number,
    notes?: string
  ): Promise<{
    session: Session;
    xpAwarded: number;
    qualityScore: number;
    levelUp: boolean | { newLevel: number; questId: string };
  }> {
    const session = await this.db.sessions.get(sessionId);
    if (!session) throw new Error('Session not found');

    const userProfile = await this.db.users.get(session.userId);
    if (!userProfile) throw new Error('User not found');

    const quest = await this.db.quests.get(session.questId);
    if (!quest) throw new Error('Quest not found');

    // Calculate quality score
    const qualityScore = this.calculateQuality(
      session,
      actualDurationMin,
      userProfile.streakData.currentStreak
    );

    // Calculate XP with quality multiplier
    const baseXP = quest.difficulty.xpPerPomodoro;
    const qualityMultiplier = qualityScore >= 50 ? 1.0 : 0.5;
    let xpEarned = Math.floor(baseXP * qualityMultiplier);

    // Apply additional multipliers
    if (quest.isTrackAligned) {
      xpEarned = Math.floor(xpEarned * 1.1);
    }
    if (quest.isDungeon) {
      xpEarned = Math.floor(xpEarned * 1.5);
    }

    // Update session
    session.status = 'completed';
    session.endTime = new Date().toISOString();
    session.actualDurationMin = actualDurationMin;
    session.xpEarned = xpEarned;
    session.notes = notes || null;
    session.quality = {
      score: qualityScore,
      factors: {
        completionRate: (actualDurationMin / session.plannedDurationMin) * 100,
        interruptionPenalty: this.calculateInterruptionPenalty(session),
        overtimeBonus: this.calculateOvertimeBonus(session, actualDurationMin),
        consistencyBonus: Math.min(10, (userProfile.streakData.currentStreak / 30) * 10)
      }
    };

    await this.db.sessions.update(sessionId, session);

    // Update quest XP
    quest.gamification.currentExp += xpEarned;
    quest.tracking.totalTrackedTime += actualDurationMin;
    quest.tracking.lastSessionAt = session.endTime;
    
    // Check for level up
    const levelUp = await this.checkQuestLevelUp(quest);

    await this.db.quests.update(quest.questId, quest);

    // Update user total XP
    userProfile.experiencePoints += xpEarned;
    await this.db.users.update(userProfile.userId, userProfile);

    // Queue for sync (priority 10 - completed session)
    await this.db.queueSync({
      operation: 'update',
      collection: 'sessions',
      documentId: sessionId,
      data: session,
      priority: 10
    });

    await this.db.queueSync({
      operation: 'update',
      collection: 'quests',
      documentId: quest.questId,
      data: quest,
      priority: 9
    });

    return {
      session,
      xpAwarded: xpEarned,
      qualityScore,
      levelUp
    };
  }

  /**
   * Calculate session quality score
   * Formula from SRS Section 6.2
   */
  private calculateQuality(
    session: Session,
    actualDurationMin: number,
    userStreak: number
  ): number {
    const { plannedDurationMin, pauseEvents } = session;

    // Base score from completion rate
    const completionRate = Math.min(actualDurationMin / plannedDurationMin, 1.5);
    let baseScore = 100 * completionRate;

    // Interruption penalty
    const totalPauseTime = pauseEvents.reduce((sum, p) => sum + p.durationSec, 0);
    const pauseTimePercent = (totalPauseTime / (plannedDurationMin * 60)) * 100;
    const interruptionPenalty = Math.min(50, pauseTimePercent);
    
    baseScore -= interruptionPenalty;

    // Overtime bonus
    const overtimePercent = Math.max(0, (actualDurationMin - plannedDurationMin) / plannedDurationMin);
    const overtimeBonus = Math.min(10, overtimePercent * 20);
    
    baseScore += overtimeBonus;

    // Consistency bonus
    const consistencyBonus = Math.min(10, (userStreak / 30) * 10);
    baseScore += consistencyBonus;

    // Clamp to 0-100
    return Math.max(0, Math.min(100, Math.round(baseScore)));
  }

  private calculateInterruptionPenalty(session: Session): number {
    const totalPauseTime = session.pauseEvents.reduce((sum, p) => sum + p.durationSec, 0);
    const pauseTimePercent = (totalPauseTime / (session.plannedDurationMin * 60)) * 100;
    return Math.min(50, pauseTimePercent);
  }

  private calculateOvertimeBonus(session: Session, actualDuration: number): number {
    const overtimePercent = Math.max(
      0,
      (actualDuration - session.plannedDurationMin) / session.plannedDurationMin
    );
    return Math.min(10, overtimePercent * 20);
  }

  private async checkQuestLevelUp(quest: Quest): Promise<boolean | { newLevel: number; questId: string }> {
    const { currentLevel, currentExp, expToNextLevel } = quest.gamification;
    
    if (currentExp >= expToNextLevel) {
      const newLevel = currentLevel + 1;
      const remainingExp = currentExp - expToNextLevel;
      
      // Calculate new exp requirement
      const baseExp = 500;
      const newExpToNextLevel = Math.floor(baseExp * Math.pow(1.5, newLevel));
      
      quest.gamification.currentLevel = newLevel;
      quest.gamification.currentExp = remainingExp;
      quest.gamification.expToNextLevel = newExpToNextLevel;
      
      // Log to progress history
      quest.progressHistory.push({
        date: new Date().toISOString().split('T')[0],
        completions: 0,
        expEarned: 0,
        timeSpentMin: 0,
        isMilestone: true,
        sessionsCompleted: 0
      });
      
      return { newLevel, questId: quest.questId };
    }
    
    return false;
  }

  /**
   * Abandon session (stopped early)
   */
  async abandonSession(sessionId: string): Promise<Session> {
    const session = await this.db.sessions.get(sessionId);
    if (!session) throw new Error('Session not found');

    session.status = 'abandoned';
    session.endTime = new Date().toISOString();
    session.xpEarned = 0; // No XP for abandoned sessions

    await this.db.sessions.update(sessionId, session);
    
    await this.db.queueSync({
      operation: 'update',
      collection: 'sessions',
      documentId: sessionId,
      data: session,
      priority: 7
    });

    return session;
  }

  /**
   * Get active session for user
   */
  async getActiveSession(userId: string): Promise<Session | null> {
    const sessions = await this.db.sessions
      .where('userId')
      .equals(userId)
      .and(s => s.status === 'active' || s.status === 'paused')
      .toArray();
    
    return sessions[0] || null;
  }
}


===== FILE: ./src\worker\services\task.service.ts =====

/**
 * TaskService
 * Handles task ordering, smart sorting, bulk operations
 */

import { getDB } from '../db/indexed-db';
import { sortQuestsByPriority } from '../utils/task-sorting.util';
import type { Quest } from '../models/Quest';
import type { TaskOrder } from '../models/TaskOrder';

export class TaskService {
  private db = getDB();

  /**
   * Get today's tasks with smart sorting
   */
  async getTodaysTasks(userId: string): Promise<Quest[]> {
    // Fetch all active quests
    const quests = await this.db.getActiveQuests(userId);
    console.log("In task service. User active quests", quests);
    
    // Apply smart sorting
    const sorted = sortQuestsByPriority(quests);
    
    // Apply user's custom order if exists
    const customOrdered = await this.applyCustomOrder(userId, sorted);
    console.log("leaving get today's tasks", sorted, customOrdered)
    
    return customOrdered;
  }

  /**
   * Apply user's custom task ordering
   */
  private async applyCustomOrder(userId: string, quests: Quest[]): Promise<Quest[]> {
    const taskOrders = await this.db.taskOrders
      .where('userId')
      .equals(userId)
      .toArray();
    
    if (taskOrders.length === 0) {
      return quests;
    }

    // Create map of quest IDs to their custom orders
    const orderMap = new Map<string, number>();
    taskOrders.forEach(to => {
      const quest = quests.find(q => q.questId === to.questId);
      if (quest) {
        // Use task count as ordering weight
        orderMap.set(to.questId, to.taskOrder.length);
      }
    });

    // Sort by custom order where available
    return quests.sort((a, b) => {
      const orderA = orderMap.get(a.questId) || 999;
      const orderB = orderMap.get(b.questId) || 999;
      return orderA - orderB;
    });
  }

  /**
   * Update task order for a quest
   */
  async updateTaskOrder(
    userId: string,
    questId: string,
    taskOrder: string[]
  ): Promise<TaskOrder> {
    // Validate quest exists and user owns it
    const quest = await this.db.quests.get(questId);
    if (!quest || quest.ownerId !== userId) {
      throw new Error('Quest not found or access denied');
    }

    // Validate all task IDs exist in quest
    const validIds = new Set(quest.subtasks.map(st => st.id));
    const invalidIds = taskOrder.filter(id => !validIds.has(id));
    
    if (invalidIds.length > 0) {
      throw new Error(`Invalid subtask IDs: ${invalidIds.join(', ')}`);
    }

    const taskOrderDoc: TaskOrder = {
      userId,
      questId,
      taskOrder,
      lastUpdated: new Date().toISOString()
    };

    await this.db.upsertTaskOrder(taskOrderDoc);
    
    // Queue for sync (priority 8 - high)
    await this.db.queueSync({
      operation: 'update',
      collection: 'taskOrders',
      documentId: `${userId}-${questId}`,
      data: taskOrderDoc,
      priority: 8
    });

    return taskOrderDoc;
  }

  /**
   * Bulk update task completion status
   */
  async bulkUpdateTaskStatus(
    userId: string,
    updates: Array<{
      questId: string;
      subtaskId: string;
      isComplete: boolean;
    }>
  ): Promise<void> {
    for (const update of updates) {
      const quest = await this.db.quests.get(update.questId);
      if (!quest || quest.ownerId !== userId) continue;

      const subtask = quest.subtasks.find(st => st.id === update.subtaskId);
      if (!subtask) continue;

      subtask.isComplete = update.isComplete;
      subtask.completedAt = update.isComplete ? new Date().toISOString() : null;

      await this.db.quests.update(quest.questId, quest);
      
      // Queue for sync (priority 7)
      await this.db.queueSync({
        operation: 'update',
        collection: 'quests',
        documentId: quest.questId,
        data: quest,
        priority: 7
      });
    }
  }

  /**
   * Toggle subtask completion
   */
  async toggleSubtaskCompletion(
    userId: string,
    questId: string,
    subtaskId: string
  ): Promise<Quest> {
    const quest = await this.db.quests.get(questId);
    if (!quest || quest.ownerId !== userId) {
      throw new Error('Quest not found or access denied');
    }

    const subtask = quest.subtasks.find(st => st.id === subtaskId);
    if (!subtask) {
      throw new Error('Subtask not found');
    }

    subtask.isComplete = !subtask.isComplete;
    subtask.completedAt = subtask.isComplete ? new Date().toISOString() : null;

    await this.db.quests.update(questId, quest);
    
    await this.db.queueSync({
      operation: 'update',
      collection: 'quests',
      documentId: questId,
      data: quest,
      priority: 7
    });

    return quest;
  }
}


===== FILE: ./src\worker\sync\sync-queue.ts =====

/**
 * SyncQueue Manager
 * Handles offline operation queueing and background sync
 */

import { getDB } from '../db/indexed-db';
import { RemoteAPI } from '../api/remote-client';
import type { SyncOperation } from '../models/SyncOperation';

export class SyncQueue {
  private db = getDB();
  private remoteAPI: RemoteAPI;
  private isProcessing = false;
  private syncInterval: number | null = null;

  constructor(remoteAPI: RemoteAPI) {
    this.remoteAPI = remoteAPI;
  }

  /**
   * Start background sync (every 5 minutes when online)
   */
  startBackgroundSync(): void {
    if (this.syncInterval) return;

    this.syncInterval = window.setInterval(() => {
      if (navigator.onLine && !this.isProcessing) {
        this.processQueue();
      }
    }, 5 * 60 * 1000); // 5 minutes

    // Also sync on network reconnection
    window.addEventListener('online', () => {
      this.processQueue();
    });
  }

  /**
   * Stop background sync
   */
  stopBackgroundSync(): void {
    if (this.syncInterval) {
      clearInterval(this.syncInterval);
      this.syncInterval = null;
    }
  }

  /**
   * Process sync queue
   */
  async processQueue(): Promise<void> {
    if (this.isProcessing) return;
    if (!navigator.onLine) return;

    this.isProcessing = true;

    try {
      const operations = await this.db.getPendingSyncOps(50);

      for (const op of operations) {
        try {
          await this.syncOperation(op);
          await this.db.removeSyncOp(op.id);
        } catch (error) {
          console.error(`Sync failed for operation ${op.id}:`, error);
          
          // Increment retry count
          op.retries += 1;
          op.error = error instanceof Error ? error.message : 'Unknown error';
          
          if (op.retries >= 5) {
            // Max retries reached, log and remove
            console.error(`Max retries reached for operation ${op.id}`);
            await this.db.removeSyncOp(op.id);
          } else {
            // Update with error info
            await this.db.syncQueue.update(op.id, op);
          }
        }
      }
    } finally {
      this.isProcessing = false;
    }
  }

  /**
   * Sync single operation to remote
   */
  private async syncOperation(op: SyncOperation): Promise<void> {
    switch (op.collection) {
      case 'sessions':
        await this.remoteAPI.syncSession(op.data);
        break;
      
      case 'quests':
        await this.remoteAPI.syncQuest(op.data);
        break;
      
      case 'taskOrders':
        // Task orders are local-only for now
        break;
      
      default:
        console.warn(`Unknown collection: ${op.collection}`);
    }
  }

  /**
   * Get pending operation count
   */
  async getPendingCount(): Promise<number> {
    return await this.db.syncQueue.count();
  }

  /**
   * Clear all queued operations (for testing)
   */
  async clearQueue(): Promise<void> {
    await this.db.syncQueue.clear();
  }
}


===== FILE: ./src\worker\utils\dev-tools.ts =====

/**
 * Development utilities
 * Exposed to window for console access
 */

import { SeedService, AuthService, getDB } from '../index'; // Import from worker index

// Check if we're in development
const isDev = import.meta.env.DEV !== false; // Default to true if undefined

console.log('In dev-tools, isDev', isDev); 

if (isDev) {
  const seedService = new SeedService();
  const authService = new AuthService();
  const db = getDB();

  (window as any).devTools = {
    // Reseed database
    reseed: async () => {
      console.log('üîÑ Reseeding database...');
      try {
        const userId = await seedService.reseedDatabase();
        console.log('‚úÖ Database reseeded. User ID:', userId);
        console.log('üîÑ Reloading page...');
        window.location.reload();
      } catch (error) {
        console.error('‚ùå Reseed failed:', error);
      }
    },

    // Clear all data
    clearAll: async () => {
      console.log('üóëÔ∏è Clearing all data...');
      try {
        await db.clearAll();
        localStorage.clear();
        console.log('‚úÖ All data cleared');
        console.log('üîÑ Reloading page...');
        window.location.reload();
      } catch (error) {
        console.error('‚ùå Clear failed:', error);
      }
    },

    // Get current user
    getUser: async () => {
      try {
        const user = await authService.getCurrentUser();
        console.log('Current user:', user);
        return user;
      } catch (error) {
        console.error('‚ùå Failed to get user:', error);
        return null;
      }
    },

    // View all quests
    getQuests: async () => {
      try {
        const userId = await authService.getCurrentUserId();
        const quests = await db.getActiveQuests(userId);
        console.log('Active quests:', quests);
        return quests;
      } catch (error) {
        console.error('‚ùå Failed to get quests:', error);
        return [];
      }
    },

    // View all sessions
    getSessions: async () => {
      try {
        const userId = await authService.getCurrentUserId();
        const sessions = await db.getTodaySessions(userId);
        console.log("Today's sessions:", sessions);
        return sessions;
      } catch (error) {
        console.error('‚ùå Failed to get sessions:', error);
        return [];
      }
    },

    // Manual seed (if auto-seed didn't work)
    seed: async () => {
      console.log('üå± Manually seeding database...');
      try {
        const userId = await seedService.seedDatabase();
        console.log('‚úÖ Database seeded. User ID:', userId);
        return userId;
      } catch (error) {
        console.error('‚ùå Seed failed:', error);
      }
    }
  };

  console.log('üõ†Ô∏è Dev tools available: window.devTools');
  console.log('Commands:');
  console.log('  - devTools.seed() - Manually seed database');
  console.log('  - devTools.reseed() - Clear and reseed database');
  console.log('  - devTools.clearAll() - Clear all data');
  console.log('  - devTools.getUser() - View current user');
  console.log('  - devTools.getQuests() - View active quests');
  console.log('  - devTools.getSessions() - View today\'s sessions');
}

===== FILE: ./src\worker\utils\task-sorting.util.ts =====

/**
 * Task Sorting Utilities
 * Implements smart sorting algorithm from SRS 11.2
 */

import type { Quest } from '../models/Quest';

/**
 * Calculate task priority based on multiple factors
 * Priority = (dueDate urgency √ó 0.4)
 *          + (schedule frequency √ó 0.3)
 *          + (last worked √ó 0.2)
 *          + (todo flag √ó 0.1)
 */
export function calculateTaskPriority(quest: Quest): number {
  let priority = 0;

  // Due date urgency (0-10)
  if (quest.dueDate) {
    const now = new Date();
    const due = new Date(quest.dueDate);
    const daysUntilDue = (due.getTime() - now.getTime()) / (1000 * 60 * 60 * 24);
    
    let urgency = 0;
    if (daysUntilDue < 0) urgency = 10; // Overdue
    else if (daysUntilDue < 1) urgency = 9;
    else if (daysUntilDue < 3) urgency = 7;
    else if (daysUntilDue < 7) urgency = 5;
    else urgency = 2;
    
    priority += urgency * 0.4;
  }

  // Schedule frequency (0-10)
  if (quest.schedule) {
    const frequencyScore: Record<string, number> = {
      'Daily': 10,
      'Weekly': 6,
      'Custom': 4
    };
    
    priority += (frequencyScore[quest.schedule.frequency] || 2) * 0.3;
  }

  // Last worked recency (0-10)
  if (quest.tracking?.lastSessionAt) {
    const lastWorked = new Date(quest.tracking.lastSessionAt);
    const daysSince = (Date.now() - lastWorked.getTime()) / (1000 * 60 * 60 * 24);
    
    let recencyScore = 0;
    if (daysSince > 7) recencyScore = 10;
    else if (daysSince > 3) recencyScore = 7;
    else if (daysSince > 1) recencyScore = 4;
    else recencyScore = 1;
    
    priority += recencyScore * 0.2;
  }

  // Todo flag boost
  if (quest.type === 'TodoQuest') {
    priority += 3 * 0.1;
  }

  return priority;
}

/**
 * Sort quests by calculated priority
 */
export function sortQuestsByPriority(quests: Quest[]): Quest[] {
  return quests.sort((a, b) => {
    const priorityA = calculateTaskPriority(a);
    const priorityB = calculateTaskPriority(b);
    return priorityB - priorityA; // Descending
  });
}
